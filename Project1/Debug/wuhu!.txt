worldwide as millions of people stay at home to minimise transmission of severe acute respiratory syndrome coronavirus health care workers prepare to do the exact opposite they will go to clinics and hospitals putting themselves at high risk from covid figures from china s national health commission show that more than health care workers have been infected as of early march and according to local media by the end of february at least had died in italy of responding health care workers were infected and some have died reports from medical staff describe physical and mental exhaustion the torment of difficult triage decisions and the pain of losing patients and colleagues all in addition to the infection risk as the pandemic accelerates access to personal protective equipment ppe for health workers is a key concern medical staff are prioritised in many countries but ppe shortages have been described in the most affected facilities some medical staff are waiting for equipment while already seeing patients who may be infected or are supplied with equipment that might not meet requirements alongside concerns for their personal safety health care workers are anxious about passing the infection to their families health care workers who care for elderly parents or young children will be drastically affected by school closures social distancing policies and disruption in the availability of food and other essentials health care systems globally could be operating at more than maximum capacity for many months but health care workers unlike ventilators or wards cannot be urgently manufactured or run at occupancy for long periods it is vital that governments see workers not simply as pawns to be deployed but as human individuals in the global response the safety of health care workers must be ensured adequate provision of ppe is just the first step other practical measures must be considered including cancelling non essential events to prioritise resources provision of food rest and family support and psychological support presently health care workers are every country s most valuable resource summary background we aimed to evaluate and improve the accuracy of the ultrasound scan in estimating gestational age in late pregnancy ie after weeks gestation in low income and middle income countries lmics where access to ultrasound in the first half of pregnancy is rare and where intrauterine growth restriction is prevalent methods this prospective population based cohort study was done in three lmics bangladesh pakistan and tanzania participating in the who alliance for maternal and newborn health improvement study women carrying a live singleton fetus dated by crown rump length crl measurements between weeks of gestation who were willing to return for two additional ultrasound scans and who planned on delivering in the study area were enrolled in the study participants underwent ultrasonography at weeks and at weeks gestation birthweights were measured within h of birth and the proportions of infants who had a small for gestational age birthweight ie a birthweight of the standard birthweight for the infant s gestational age and sex according to the intergrowth st project newborn baby reference standards and appropriate for gestational age birthweights were ascertained estimation of gestational age by standard fetal biometry measurements in addition to transcerebellar diameter tcd measurements was compared with gold standard crl measurements by use of bland altman plots to calculate the mean difference and limits of agreement statistical modelling was done to develop new gestational age prediction formulas for third trimester ultrasonography in lmics findings between feb and jan women were enrolled in the study pregnant women had an ultrasound scan at weeks of gestation and had an ultrasound scan between weeks of gestation of the unique infants whose birthweights were available infants were born with an appropriate for gestational age birthweight and infants were born with a small for gestational age birthweight the accuracy of late pregnancy ultrasound biometry using existing formulas to estimate gestational age in lmics was similar to that in high income settings with standard dating formulas late pregnancy ultrasound at weeks gestation was accurate to within approximately plus or minus weeks of the gold standard crl measurement of gestational age and late pregnancy ultrasound was accurate to within weeks of the crl measurement at weeks gestation in infants who were ultimately born small for gestational age individual parameters systematically underestimated gestational age apart from tcd which showed minimal bias by use of a novel parsimonious model formula that combined tcd with femur length gestational age at the week ultrasound scan was estimated to within days of the crl measurement and estimated to within days of the crl measurement at the week ultrasound scan similar results were observed in infants who were small for gestational age interpretation incorporation of tcd and the use of new formulas in late pregnancy ultrasound scans could improve the accuracy of gestational age estimation in both appropriate for gestational age and small for gestational age infants in lmics given the high rates of small for gestational age infants in lmics these results might be especially relevant validation of this new formula in other lmic populations is needed to establish whether the accuracy of the late pregnancy ultrasound can be narrowed to within approximately weeks funding bill melinda gates foundation view related content for this article research in context evidence before this study the performance of late pregnancy ultrasound for assessing gestational age has been understudied in low income and middle income countries lmics where access to ultrasound for gestational age dating early in pregnancy is rare and where a high proportion of infants are born small for gestational age in high income settings the transcerebellar diameter tcd has shown promise as a biometric parameter that is less affected by intrauterine growth restriction than standard ultrasound biometric measurements but this parameter is not routinely used as most women in high income settings present earlier weeks of gestation for ultrasound confirmation of gestational age added value of this study in this multicountry population based cohort study we compared the performance of standard ultrasound biometric parameters and tcd with the gold standard method of first trimester crown rump length crl measurements for estimating gestational age in late pregnancy ie after weeks gestation the accuracy of ultrasonography in estimating gestational age in late pregnancy in lmics was similar to that reported in high income settings but it was further improved when tcd was included in the combination formulas for gestational age assessment we derived a parsimonious model requiring measurement of only the tcd and the femur length that was accurate to within approximately plus or minus weeks of the gold standard crl measurement of gestational age even among infants who were ultimately born small for gestational age our study was population based enrolling an unselected group of pregnant women rather than a selected group of only the healthiest pregnant women therefore we believe our novel gestational age formula is more generalisable to real world conditions that health care practitioners in lmics face implications of all the available evidence in lmics gestational age in late pregnancy can be reliably assessed to within approximately weeks of the crl measurement by use of only two ultrasound parameters these results were consistent when our gestational age formulas were applied to pregnancies in which the infants were ultimately born small for gestational age our formulas could be most useful when measuring gestational age in pregnant women who present late to receive antenatal care in lmics where the burden of intrauterine growth restriction is high the biometric ultrasound measurements used in our study appear to be attainable by health care providers with limited sonography training accurate gestational age dating can enable providers to identify pregnancies requiring antenatal interventions such as corticosteroids or transfer to a facility that is able to handle premature infants accurate dating will also allow researchers to better estimate the global burden of preterm birth and intrauterine growth restriction introduction pregnancy dating is an essential component of antenatal care accurate estimation of gestational age is needed to optimise provision of obstetric interventions and delivery location for preterm births and it is also a prerequisite to identify and manage fetal growth abnormalities additionally accurate estimation of gestational age is required to provide reasonable global estimates of preterm birth and intrauterine growth restriction in low income and middle income countries lmics where the burden of preterm birth and intrauterine growth restriction is highest assessing gestational age accurately can be challenging because of many factors for instance last menstrual period is often unknown and menstrual cycles can vary in length symphysis fundal height can be a misleading measure of gestational age because of variation in maternal adiposity intrauterine growth restriction uterine fibroids or malpresentation the first trimester ultrasound is considered to be the gold standard method for estimating gestational age in high income settings but ultrasound early in gestation might not be routinely available in lmics in addition pregnant women in lmics might not present for antenatal care in early pregnancy as gestation advances ultrasound biometry becomes less accurate for estimating gestational age given the emergence of natural variation in fetal size and the possibility of pathological growth restriction indeed in lmics where of infants are born small for gestational age the assumption that fetal size predicts gestational age might not be valid studies suggest that measurements of the cerebellum could allow for a more accurate estimation of gestational age late in pregnancy ie from weeks gestation onwards compared with standard biometry measurements cerebellar size appears to be less affected by intrauterine growth restriction than other measures of growth there is also less natural variation in cerebellar size between fetuses transcerebellar diameter tcd nomograms have been published for several populations but they are not in mainstream use in high income settings as most women have early ultrasound scans at weeks gestation when standard biometric measurements biparietal diameter head circumference abdominal circumference and femur length are reported to provide an accurate estimation of gestational age to within plus or minus weeks of the gold standard crown rump length crl measurement of gestational age standard biometry does not perform as well in the third trimester as it does at less than weeks gestation with a reported accuracy of only or more weeks of the crl measurement one study in the usa found a strong correlation between cerebellar size and gestational age in infants born with an appropriate for gestational age birthweight and in those born small for gestational age even though a small number of studies have measured the cerebellum in specific lmics the performance of cerebellar biometry for assessing gestational age has been understudied in settings where its use might be of greater benefit the objective of the who alliance for maternal and newborn health improvement amanhi late pregnancy dating study was to evaluate the accuracy of late pregnancy ie after weeks gestation ultrasound biometry in estimating gestational age in lmic settings with a particular focus on the effect of intrauterine growth restriction on the accuracy and whether cerebellar measurements could improve performance methods study design and participants the who amanhi study cohort was established in to harmonise several large ongoing maternal and neonatal health research studies in sub saharan africa and south asia the study involved five distinct sites sylhet bangladesh karachi pakistan pemba tanzania brong ahafo gahna southern province zambia three of the five amanhi sites sylhet karachi and pemba participated in this prospective multicountry population based cohort substudy known as the who amanhi late pregnancy dating study the remaining two sites brong ahafo and the southern province were ineligible having completed amanhi enrolment amanhi study populations were predominantly rural with low levels of literacy as amanhi was an unselected population based cohort it was inclusive of both appropriately grown and growth restricted infants between feb and jan pregnant women were identified by trained field workers through home visits urine tests for human chorionic gonadotropin were used to confirm pregnancies women were eligible for the study if they were pregnant with a live singleton fetus the pregnancy had been dated by crl measurements between and weeks gestation crl of mm they were willing to return for two additional ultrasounds and they planned on delivering in the study area women pregnant with multiple fetuses or a non viable or anomalous fetus were ineligible fieldworkers obtained written informed consent from participants in their local languages and arranged study ultrasounds to coincide with standard amanhi visits ethics approval was granted by institutional review boards and ethics review committees in the participating countries the host institutions of principal investigators who and partners healthcare the boston based coordinating team procedures we considered the first trimester ultrasound scan to be the gold standard method for estimating gestational age amanhi study sonographers followed standardised procedures to obtain high quality transabdominal crl measurements three crl measurements were obtained for each participant and the median crl value and the intergrowth st equation were used to calculate gestational age first trimester crl measurements established the estimated date of delivery and were considered as the gold standard gestational age at all subsequent study visits study ultrasound procedures were standardised during a day training course in bangladesh for staff from participating amanhi sites and consisted of didactic and practical teaching methods competency was assessed with written and practical post training assessments staff from pakistan were unable to attend because of visa issues and they were therefore trained via skype conferencing no additional sonographers were recruited during the study period two ultrasound scans subsequent to the first trimester ultrasound were done for each participant the first between and weeks gestation and the second between and weeks gestation both coinciding with routine amanhi visits after study initiation the gestational age windows were extended to weeks and weeks to cover a wider range of the third trimester however only the pemba site received ethics approval for this extension before study completion at every ultrasound visit sonographers followed standardised procedures to obtain high quality measurements of the biparietal diameter head circumference abdominal circumference femur length and tcd appendix p sonographers were masked to the gold standard gestational age established by crl measurements ultrasound biometry measurements were obtained without the use of an automated biometry software package so that only absolute measurements were taken two measurements for each biometric parameter were obtained and averaged plausible measurement ranges were defined for each parameter before the analysis crl mm biparietal diameter cm head circumference cm femur length cm abdominal circumference cm and tcd cm for measures outside of these ranges data were checked for data entry errors and were assigned as missing if unresolved gestational age was calculated from each individual biometric parameter by use of standard tables hadlock and colleagues for biparietal diameter femur length and abdominal circumference chavez and colleagues for tcd and intergrowth st project for head circumference gestational age was also calculated by use of previously published formulas that combine more than one parameter hadlock and colleagues and intergrowth st project formulas and the reasonable ranges for individual parameters are detailed in the appendix p an image quality checklist provided objective guidance on appropriate image magnification ideal image plane and correct calliper placement all study images were reviewed by bjw who was masked to the gold standard gestational age values for ongoing quality control with quarterly feedback to the sonographers infants were visited within h of birth birthweights were obtained by use of digital scales small for gestational age was defined as less than of the standard birthweight for the infant s gestational age and sex according to the intergrowth st project newborn baby reference standards statistical analysis study sample size was calculated on the basis of our hypothesis that the gestational age agreement between tcd and crl would be higher than the agreement between standard biometry and crl both among infants with appropriate for gestational age birthweights and among those with small for gestational age birthweights previously published literature and professional society guidelines have shown that late pregnancy biometry combination formulas have a gestational age accuracy of within days of the gold standard first trimester crl measurements by use of overlapping bland altman plots to compare the degree of agreement between tcd versus crl with standard biometry versus crl a sample size of would be adequate to show a mean difference of and limits of agreement loa of within days tcd vs crl versus within days standard biometry vs crl of the crl estimated gestational age we aimed to enrol a minimum of infants with small for gestational age birthweights per site assuming that of infants would be small for gestational age and that of pregnant women would be lost to follow up at delivery we required infants per site therefore we had a conservative target of enrolling participants per study site the stata software programme statacorp stata statistical software release college station tx usa was used for all statistical analyses bland altman plots were used to assess the agreement between gestational age measured by gold standard crl and gestational age measured by late pregnancy ultrasound biometric parameters mean differences bias with cis and loa values were calculated for each comparison for ease of comparison an approximation of the degree of agreement was calculated as the midpoint between the unsigned loa values as an example if the loa was to days the approximation of agreement would be within days of the gestational age as determined by the gold standard first trimester crl measurement for individual biometric parameters or combinations of parameters with bias ie if the ci of the mean difference does not include the gestational age window agreement limits would be skewed in the direction of the bias for infants with available birthweights we stratified the results by infant size to compare the accuracy of late pregnancy biometry measures among infants with appropriate for gestational age birthweights and small for gestational age birthweights statistical modelling was used to develop novel equations to predict gestational age with late pregnancy biometric parameters as covariates generalised linear regression was done by use of the stata glm command accounting for clustering of multiple visits for a participant gold standard gestational age determination by crl measurement was the dependent variable covariates tested in the models included all late pregnancy biometric parameters measured biparietal diameter head circumference femur length abdominal circumference and tcd natural logarithms were used to transform continuous measures given non normal distributions models with individual and combinations of biometric parameters were tested given the performance of tcd as an individual parameter models including tcd as the main predictor were examined adding additional biometric parameters assessing for significance ie if the p value was and improvement in the adjusted r and determining the best fit model according to the akaike information criterion potential models were cross validated to compare the predictive accuracy of the different models and select biometric parameters to be included in the final model two methods were used to cross validate the models in the first method the study dataset was divided into five random subsamples one subsample was withheld and statistical models were generated with the remaining of the data the model was then used to predict gestational age in the withheld subsample and a standardised error term was calculated on the basis of the predicted gestational age calculated as observed gestational age predicted gestational age predicted gestational age this process was repeated with each successive withheld subsample and a summary measure of the prediction error was generated for the entire dataset the model with the lowest prediction error was selected as the final model in the second cross validation method the data from one study site were withheld and statistical models were generated with data from the remaining two sites the model was then fit and used to predict gestational age in the first site that had the data withheld this process was repeated twice and the standardised error was calculated role of the funding source the funder of the study had no role in the study design data collection data analysis data interpretation or writing of the report results between feb and jan pregnant women in three of the five amanhi study sites bangladesh pakistan and tanzania with documented crl assessments between and weeks gestation were enrolled in this late pregnancy ultrasound study of these women completed late pregnancy scans data from nine infants were excluded from the final analysis because of implausible dates that could not be reconciled eg date of birth before date of ultrasound or year of ultrasound or birth recorded incorrectly we determined a priori that a difference of greater than days between the gold standard crl measurement of gestational age and the gestational age predicted by late pregnancy biometry measurements was considered to be implausibly associated with the performance of the ultrasound three such extreme outliers were excluded at weeks gestation and an additional three were excluded at weeks gestation the final analysis included unique mothers of whom underwent an ultrasound scan between and weeks gestation in bangladesh in pakistan and in tanzania and underwent an ultrasound scan between and weeks gestation in bangladesh in pakistan and in tanzania figure figure thumbnail gr figure participant flowchart by ultrasound visit show full caption view large imagefigure viewerdownload hi res imagedownload ppt more than of all attempts at biometric measurements were successful of the ultrasound scans done at weeks gestation values for the biparietal diameter were missing in two scans for head circumference in three scans for femur length in two scans for abdominal circumference in three scans and for tcd in three scans of the ultrasound scans done at weeks gestation missing values for the different parameters were similar to the ultrasound scan at weeks gestation with two values missing for biparietal diameter two for head circumference none for femur length and eight for abdominal circumference even at weeks gestation tcd measurements were successfully obtained from of ultrasound scans summary measures from the individual biometric parameters mean and sd for the cohort and by site are included in the appendix p using the reference nomogram for crl by hadlock and colleagues as an alternative to the intergrowth st project nomogram no significant differences in the distribution of gestational ages estimated from either third trimester ultrasound scan were observed data not shown from the ultrasound scans done at weeks gestation the performance of individual biometric parameters showed fairly similar agreement with gold standard crl measurements approximations ranging from to days of the standard crl measurements table there was little bias as evidenced by a mean difference close to zero for all parameters a representative bland altman plot for tcd versus crl is presented in figure table degree of agreement between late pregnancy ultrasound and gold standard first trimester crown rump length measurement of gestational age ultrasound scan at weeks gestation n ultrasound scan at weeks gestation n mean difference in days ci limits of agreement in days approximation in days mean difference in days ci limits of agreement in days approximation in days individual parameters tcd to to to to bpd to to to to hc to to to to fl to to to to ac to to to to combination formulas hadlock to to to to intergrowth st project to to to to amanhi parsimonious formula to to to to the hadlock formula includes bpd ac and fl measurements intergrowth st project formula includes hc and fl measurements and the amanhi parsimonious method includes tcd and fl measurements tcd transcerebellar diameter bpd biparietal diameter hc head circumference fl femur length ac abdominal circumference amanhi alliance for maternal and newborn health improvement approximation refers to the midpoint between the unsigned limits of agreement and values represent the number of days plus or minus the gold standard first trimester crown rump length measurement of gestational age for biometric parameters or combinations with bias ie if the ci of the mean difference does not include the true value of gestational age compared with the estimated value from third trimester biometry will be skewed in the direction of the bias mean difference open table in a new tab figure thumbnail gr figure bland altman plots comparing agreement of gestational age days determied by tcd measurements with first trimester crl measurements at weeks gestation a and weeks gestation b by study site show full caption view large imagefigure viewerdownload hi res imagedownload ppt from the ultrasound scans done at weeks gestation tcd had narrower loa than the other individual biometric parameters table the agreement between tcd and gold standard crl measurements was approximated to be within days of the crl measurement with little bias mean difference days ci compared with tcd the remaining individual parameters showed less agreement with crl measurements approximations ranged between days a strong negative bias for biparietal diameter days ci to femur length days to and abdominal circumference days to was observed suggesting a systematic underestimation of gestational age by approximately week from the ultrasound scan at weeks gestation the hadlock and intergrowth st project combination formulas outperformed individual parameters by a few days approximations ranged between days and maintained little bias table from the ultrasound scan at weeks gestation tcd alone approximation days showed a similar degree of agreement to crl measurements as the hadlock formula approximation days and slightly narrower agreement with crl measurements than the intergrowth st project formula approximation days notably the hadlock formula had a strong negative bias mean difference days ci to results did not vary substantially by site data not shown and have been presented together stratification of results by infant size was done in women who were less than weeks pregnant when they gave birth with birthweights available and included of women who had an ultrasound scan at weeks gestation of women who had an ultrasound scan at weeks gestation and of all unique infants for whom the birthweights were known of the unique infants were classified as small for gestational age the prevalence of infants who were small for gestational age varied by site and was higher in asian sites of infants in bangladesh and of infants in pakistan than in the african sites of infants in tanzania tcd outperformed the other biometric parameters in predicting gestational age and showed less negative bias ie less underestimation with loa values that were similar at the week and week scans in infants who had appropriate for gestational age birthweights and small for gestational age birthweights table hadlock and intergrowth st project combination formulas had slightly narrower loa values than individual parameters at the week scan in infants who were small for gestational age table although the hadlock formula had substantial negative bias days ci to at the week scan tcd had a similar loa to the combination formulas for infants who were small for gestational age approximation days but with less bias mean difference days than both the hadlock days and intergrowth st project formulas days table table performance of late pregnancy ultrasound in estimating the gestational age of infants with small for gestational age or appropriate for gestational age birthweights birthweight appropriate for gestational age birthweight small for gestational age mean difference in days ci limits of agreement in days approximation in days mean difference in days ci limits of agreement in days approximation in days weeks gestation tcd to to to to bpd to to to to hc to to to to fl to to to to ac to to to to hadlock to to to to intergrowth st project to to to to amanhi parsimonious formula to to to to weeks gestation tcd to to to to bpd to to to to hc to to to to fl to to to to ac to to to to hadlock to to to to intergrowth st project to to to to amanhi parsimonious formula to to to to the hadlock formula includes bpd ac and fl measurements intergrowth st project formula includes hc and fl measurements and the amanhi parsimonious method includes tcd and fl measurements tcd transcerebellar diameter bpd biparietal diameter hc head circumference fl femur length ac abdominal circumference amanhi alliance for maternal and newborn health improvement approximation refers to the midpoint between the unsigned limits of agreement and values represent the number of days plus or minus the gold standard first trimester crown rump length measurement of gestational age for biometric parameters or combinations with bias ie if the ci of the mean difference does not include the true value of gestational age compared with the estimated value from third trimester biometry will be skewed in the direction of the bias mean difference open table in a new tab the four statistical models generated from the amanhi late pregnancy dating study are shown in table model was the most accurate in predicting gestational age and included four biometric parameters model included only tcd and femur length and showed the least prediction error among the three more parsimonious models combining only two parameters after both cross validation approaches were applied appendix p table performance of newly derived alliance for maternal and newborn health improvement combination formulas for determining gestational age after weeks gestation weeks gestation weeks gestation mean difference in days ci limits of agreement in days approximation in days mean difference in days ci limits of agreement in days approximation in days model lntcd lnbpd lnfl and lnac to to to to model lntcd and lnfl to to to to model lntcd and lnbpd to to to to model lntcd and lnac to to to to tcd transcerebellar diameter bpd biparietal diameter fl femur length ac abdominal circumference hc head circumference approximation refers to the midpoint between the unsigned limits of agreement and values represent the number of days plus or minus the gold standard first trimester crown rump length measurement of gestational age for biometric parameters or combinations with bias ie if the ci of the mean difference does not include the true value of gestational age compared with the estimated value from third trimester biometry will be skewed in the direction of the bias mean difference model is the complete alliance for maternal and newborn health improvement model models evaluate combinations of fewer biometric parameters with model chosen as the alliance for maternal and newborn health improvement parsimonious model open table in a new tab the final model was fit by including tcd and femur length in a regression with the entire dataset model table formula in appendix p the prediction error appendix p is on the final model involving the entire cohort data formulas for all candidate models and their out of model prediction errors are shown in the appendix p from the ultrasound scan at weeks gestation our novel amanhi combination formula combining tcd and femur length measurements showed little improvement in the accuracy of estimating gestational age when infants were stratified by birthweight appropriate for gestational age or small for gestational age compared with previous combination formulas improving estimations by only day table however from the ultrasound scan at weeks gestation the amanhi combination formula could more accurately predict gestational age for appropriate for gestational age infants and small for gestational age infants compared with the intergrowth st project combination formula narrowing the loa to approximately weeks and with minimal bias table discussion we have identified several key findings regarding the performance of ultrasound biometry in late pregnancy in a large cohort of pregnant women in three lmic settings first it was reassuring to verify that the accuracy of late pregnancy ultrasound for estimating gestational age in our study was similar to the reported results from higher income settings where sonographer training is lengthier and includes more practical training compared with sonographer training in lmic settings biometric parameters at weeks gestation and weeks gestation alone and in combination were accurate to within approximately weeks of the gold standard crl measurement of gestational age these results are consistent with previous reports of the performance of late pregnancy biometric parameters in our study the accuracy of gestational age dating with individual biometric parameters before weeks was reasonably good approximation days to days of the standard crl measurements improving even further approximation days when individual biometric parameters were combined according to previously published formulas later scans weeks had wider individual loas approximation days as hypothesised the tcd as a single biometric parameter had the narrowest loa approximation days and even outperformed the combination formulas slightly approximation days importantly tcd also performed quite well among infants who were ultimately born small for gestational age with an accuracy of approximately days of the crl measurement of gestational age at weeks and approximately days of the crl measurement at weeks with little bias mean difference of days at both gestational age windows in summary nomograms established for measuring cerebellar size in high resource settings appear to perform well in this lmic population given the initial results showing successful performance of tcd in estimating gestational age we combined tcd with standard biometric parameters and used statistical modelling to investigate the performance of different combination formulas in the lmic study sites where the prevalence of infants born small for gestational age is high our first model combining tcd with biparietal diameter femur length and abdominal circumference narrowed the loa across the two third trimester gestational age windows to less than weeks a second parsimonious model combining only tcd and femur length performed nearly as well as the first model with the added benefit of simplicity in the number of parameters included both the femur and the cerebellum are structures that are fairly easy to identify in addition the measurements of these parameters are linear and therefore require less skill in calliper placement than circumference measurements as evidenced by the observation that these measurements were obtained successfully in of ultrasound scans in our study when compared with other published combination formulas our amanhi parsimonious model formula had the narrowest loa the least bias and performed similarly among infants born appropriate for gestational age and small for gestational age in both gestational age windows as the amanhi formulas were derived from our study population it is not surprising that they performed well even after attempting to separate model development and validation through cross validation exercises our gestational age formulas should therefore be viewed as hypothesis generating and they should be validated in other lmic populations before they are used extensively it is important to emphasise that our study included an unselected and population based cohort from three lmics at the time of enrolment the cohort therefore reflects the range of morbidities associated with pregnancy maternal nutritional status and fetal sizes that would be encountered by a health care practitioner in similar settings our cohort contrasts those used in previous studies such as the intergrowth st project cohort that were designed to measure optimal fetal growth and enrolled only healthy low risk women who were less likely to carry a growth restricted fetus these differences might help to explain why our amanhi parsimonious model outperformed both the hadlock and intergrowth st project formulas among infants who were born small for gestational age even at weeks gestation the loa of our amanhi parsimonious formula was still within days of the crl measurement of gestational age and it performed similarly among infants born with small for gestational age approximation days or appropriate for gestational age approximation days birthweights an estimation of gestational age to within approximately weeks of the standard crl measurement is a remarkable achievement for lmic settings as many women do not have an ultrasonography in the first half of pregnancy if intrauterine growth restriction is suspected measurement of cerebellar size in the third trimester could help to confirm that this is the case our study has several strengths including its large sample size and the determination of gestational age by use of gold standard first trimester crl measurements that were verified by a multilayered quality control process nonetheless there are some limitations of our study we did not evaluate the feasibility of obtaining cerebellum measurements after weeks gestation with advancing gestation shadowing from the calcified skull might preclude the accurate measurement of the tcd margins limiting its use as the pregnancy nears full term the results shown in figure suggest that accurate tcd measurements might be more difficult to obtain as the pregnancy advances as several individual data points fell below the lower loa rather than the upper loa at the week gestational age window this underestimation of gestational age by tcd in this gestational age window could reflect difficulties in measuring the full size of the cerebellar hemispheres in summary if validated in other lmic populations our novel parsimonious model for estimating gestational age in late pregnancy could be useful for research public health surveillance and clinical care our study findings might be clinically relevant for health care providers tasked with determining whether a fetus is small rather than preterm and thus might limit iatrogenic harm from unnecessary preterm delivery two important messages can be concluded from our work first cerebellar measurements using previously established nomograms from high resource settings are a useful adjunct to late pregnancy biometry measurements in lmics where the burden of infants born small for gestational age is high secondly if validated in other lmic populations a parsimonious gestational age formula requiring measurement of only two biometric parameters might narrow accuracy of late pregnancy ultrasound to within approximately weeks contributors this manuscript is the product of the who alliance for maternal and newborn health improvement late pregnancy dating study group bjw rb acl ahb fj and ss acquired funding designed the study developed the protocols and were involved in implementing the study bjw and mn led the ultrasound training and standardisation and provided ongoing ultrasound quality control fj im acl ahb sd ss ud and sa supervised patient enrolment provided oversight of daily study activities and were involved in leading the collection and management of data the daily collection and management of data was done by sb ah sj fk mk um smm and mr ra ni and nn were responsible for daily ultrasound activities and local quality control data was initially analysed and interpreted by bjw acl in sd les mi and rw with additional data interpretation done by rb ahb fj and ss bjw acl les and rb drafted the initial manuscript which was further edited reviewed revised and approved by all authors bjw and rb had full access to all of the data and the final responsibility to submit the manuscript for publication additional study members who had access to the raw data included acl in sd les mi and rw alliance for maternal and newborn health improvement study group members tanzania team collaborators tanzania saikat deb mohammed said mohammed said mohammed ali mohammed hamad juma massoud juma hassan public health laboratory ivo de carneri pemba india saikat deb usha dhingra arup dutta pratibha dixit sunil sazawal centre for public health kinetics new delhi pakistan team collaborators pakistan imran nisar muhammad ilyas usma mehmood farzana kausar shamim jaweed muhammad karim atiya hussain naila nadeem fyezah jehan aga khan university karachi bangladesh team collaborators bangladesh sayedur rahman nasreen islam ruksana azad syed mamun ibne moin salahuddin ahmed johns hopkins university bangladesh dhaka mahmoodur rahman abdul quiayum maternal and child health division international center for diarrheal disease research dhaka usa rasheda khanam abdullah h baqui department of international health johns hopkins bloomberg school of public health baltimore md coordinating team switzerland sachiyo yoshida alexander manu rajiv bahl who geneva usa anne cc lee brigham and women s hospital harvard medical school boston ma lauren e schaeffer rachel whelan brigham and women s hospital boston ma mariam naqvi ceders sinai medical center los angeles ca blair j wylie department of obstetrics and gynecology beth israel deaconess medical center boston ma harvard medical school boston ma declaration of interests ud ss fj aq ra sr mr smm ni am mn les acl and bw report grants from the bill melinda gates foundation during the conduct of the study all other authors declare no competing interests acknowledgments this study was funded by the bill melinda gates foundation opp the funder had no role in study design data collection data analysis data interpretation or writing of the report bjw received funding from the national institutes of health nih k es f d in also received funding from fogarty international centre and nih d tw acl received funding from the national institute of child health and human development k hd the results of the study were presented at the annual meeting of the society for maternal fetal medicine february in dallas tx usa we are particularly grateful to the women who participated in the study and to all research staff across the three study sites who made the project possible invensense inc borregas ave sunnyvale ca u s a tel fax website www invensense com document number ps mpu a revision release date of mpu and mpu product specification revision mpu mpu product specification document number ps mpu a revision release date of contents revision history purpose and scope product overview mpu x o verview applications features g yroscope f eatures a ccelerometer f eatures a dditional f eatures m otion p rocessing c locking electrical characteristics g yroscope s pecifications a ccelerometer s pecifications e lectrical and o ther c ommon s pecifications e lectrical s pecifications c ontinued e lectrical s pecifications c ontinued e lectrical s pecifications c ontinued i c t iming c haracterization spi t iming c haracterization mpu only a bsolute m aximum r atings applications information p in o ut and s ignal d escription t ypical o perating c ircuit b ill of m aterials for e xternal c omponents r ecommended p ower on p rocedure b lock d iagram o verview t hree a xis mems g yroscope with bit adc s and s ignal c onditioning t hree a xis mems a ccelerometer with bit adc s and s ignal c onditioning d igital m otion p rocessor p rimary i c and spi s erial c ommunications i nterfaces a uxiliary i c s erial i nterface mpu mpu product specification document number ps mpu a revision release date of s elf t est mpu x s olution for axis s ensor f usion u sing i c i nterface mpu u sing spi i nterface i nternal c lock g eneration s ensor d ata r egisters fifo i nterrupts d igital o utput t emperature s ensor b ias and ldo c harge p ump programmable interrupts digital interface i c and spi mpu only s erial i nterfaces i c i nterface i c c ommunications p rotocol i c t erms spi i nterface mpu only serial interface considerations mpu mpu s upported i nterfaces l ogic l evels l ogic l evels d iagram for aux vddio assembly o rientation of a xes p ackage d imensions pcb d esign g uidelines a ssembly p recautions s torage s pecifications p ackage m arking s pecification t ape r eel s pecification l abel p ackaging r epresentative s hipping c arton l abel reliability q ualification t est p olicy mpu mpu product specification document number ps mpu a revision release date of q ualification t est p lan environmental compliance mpu mpu product specification document number ps mpu a revision release date of revision history revision date revision description initial release for rev c parts clarified wording in sections edited supply current numbers for different modes section unit of measure for accelerometer sensitivity changed from lsb mg to lsb g updated accelerometer self test specifications in table updated package dimensions section updated pcb design guidelines section for rev d parts updated accelerometer specifications in table updated accelerometer specification note sections updated qualification test plan section edits for clarity changed operating voltage range to v v added accelerometer intelligence function increment value of mg lsb section updated absolute maximum rating for acceleration any axis unpowered from ms to ms section modified absolute maximum rating for latch up to level a and ma section updated self test response specifications for revision d parts dated with date code yyww or later edits for clarity added gyro self test sections added min max limits to accel self test response section updated accelerometer low power mode operating currents section added gyro self test to block diagram section updated packaging labels and descriptions sections updated gyro and accelerometer self test information sections updated latch up information section updated programmable interrupts information section changed shipment information from maximum of reels k units per shipper box to reels k units per shipper box section updated packing shipping and label information sections updated reliability references section updates section mpu mpu product specification document number ps mpu a revision release date of purpose and scope this product specification provides advanced information regarding the electrical specification and design related information for the mpu and mpu motiontracking devices collectively called the mpu x or mpu electrical characteristics are based upon design analysis and simulation results only specifications are subject to change without notice final specifications will be updated based upon characterization of production silicon for references to register map and descriptions of individual registers please refer to the mpu mpu register map and register descriptions document the self test response specifications provided in this document pertain to revision d parts with date codes of yyww or later please see section for package marking description details mpu mpu product specification document number ps mpu a revision release date of product overview mpu x overview motioninterface is becoming a must have function being adopted by smartphone and tablet manufacturers due to the enormous value it adds to the end user experience in smartphones it finds use in applications such as gesture commands for applications and phone control enhanced gaming augmented reality panoramic photo capture and viewing and pedestrian and vehicle navigation with its ability to precisely and accurately track user motions motiontracking technology can convert handsets and tablets into powerful d intelligent devices that can be used in applications ranging from health and fitness monitoring to location based services key requirements for motioninterface enabled devices are small package size low power consumption high accuracy and repeatability high shock tolerance and application specific performance programmability all at a low consumer price point the mpu x is the world s first integrated axis motiontracking device that combines a axis gyroscope axis accelerometer and a digital motion processor dmp all in a small x x mm package with its dedicated i c sensor bus it directly accepts inputs from an external axis compass to provide a complete axis motionfusion output the mpu x motiontracking device with its axis integration on board motionfusion and run time calibration firmware enables manufacturers to eliminate the costly and complex selection qualification and system level integration of discrete devices guaranteeing optimal motion performance for consumers the mpu x is also designed to interface with multiple non inertial digital sensors such as pressure sensors on its auxiliary i c port the mpu x is footprint compatible with the mpu x family the mpu x features three bit analog to digital converters adcs for digitizing the gyroscope outputs and three bit adcs for digitizing the accelerometer outputs for precision tracking of both fast and slow motions the parts feature a user programmable gyroscope full scale range of and sec dps and a user programmable accelerometer full scale range of g g g and g an on chip byte fifo buffer helps lower system power consumption by allowing the system processor to read the sensor data in bursts and then enter a low power mode as the mpu collects more data with all the necessary on chip processing and sensor components required to support many motion based use cases the mpu x uniquely enables low power motioninterface applications in portable applications with reduced processing requirements for the system processor by providing an integrated motionfusion output the dmp in the mpu x offloads the intensive motionprocessing computation requirements from the system processor minimizing the need for frequent polling of the motion sensor output communication with all registers of the device is performed using either i c at khz or spi at mhz mpu only for applications requiring faster communications the sensor and interrupt registers may be read using spi at mhz mpu only additional features include an embedded temperature sensor and an on chip oscillator with variation over the operating temperature range by leveraging its patented and volume proven nasiri fabrication platform which integrates mems wafers with companion cmos electronics through wafer level bonding invensense has driven the mpu x package size down to a revolutionary footprint of x x mm qfn while providing the highest performance lowest noise and the lowest cost semiconductor packaging required for handheld consumer electronic devices the part features a robust g shock tolerance and has programmable low pass filters for the gyroscopes accelerometers and the on chip temperature sensor for power supply flexibility the mpu x operates from vdd power supply voltage range of v v additionally the mpu provides a vlogic reference pin in addition to its analog supply pin vdd which sets the logic levels of its i c interface the vlogic voltage may be v or vdd the mpu and mpu are identical except that the mpu supports the i c serial interface only and has a separate vlogic reference pin the mpu supports both i c and spi interfaces and has a single supply pin vdd which is both the device s logic reference supply and the analog supply for the part the table below outlines these differences mpu mpu product specification document number ps mpu a revision release date of primary differences between mpu and mpu part item mpu mpu vdd v v v v vlogic n a v to vdd serial interfaces supported i c spi i c pin cs vlogic pin ad sdo ad pin scl sclk scl pin sda sdi sda mpu mpu product specification document number ps mpu a revision release date of applications blurfree technology for video still image stabilization airsign technology for security authentication touchanywhere technology for no touch ui application control navigation motioncommand technology for gesture short cuts motion enabled game and application framework instantgesture ig gesture recognition location based services points of interest and dead reckoning handset and portable gaming motion based game controllers d remote controls for internet connected dtvs and set top boxes d mice wearable sensors for health fitness and sports toys mpu mpu product specification document number ps mpu a revision release date of features gyroscope features the triple axis mems gyroscope in the mpu x includes a wide range of features digital output x y and z axis angular rate sensors gyroscopes with a user programmable full scale range of and sec external sync signal connected to the fsync pin supports image video and gps synchronization integrated bit adcs enable simultaneous sampling of gyros enhanced bias and sensitivity temperature stability reduces the need for user calibration improved low frequency noise performance digitally programmable low pass filter gyroscope operating current ma standby current a factory calibrated sensitivity scale factor user self test accelerometer features the triple axis mems accelerometer in mpu x includes a wide range of features digital output triple axis accelerometer with a programmable full scale range of g g g and g integrated bit adcs enable simultaneous sampling of accelerometers while requiring no external multiplexer accelerometer normal operating current a low power accelerometer mode current a at hz a at hz a at hz a at hz orientation detection and signaling tap detection user programmable interrupts high g interrupt user self test additional features the mpu x includes the following additional features axis motionfusion by the on chip digital motion processor dmp auxiliary master i c bus for reading data from external sensors e g magnetometer ma operating current when all motion sensing axes and the dmp are enabled vdd supply voltage range of v v flexible vlogic reference voltage supports multiple i c interface voltages mpu only smallest and thinnest qfn package for portable devices x x mm minimal cross axis sensitivity between the accelerometer and gyroscope axes byte fifo buffer reduces power consumption by allowing host processor to read the data in bursts and then go into a low power mode as the mpu collects more data digital output temperature sensor user programmable digital filters for gyroscope accelerometer and temp sensor g shock tolerant khz fast mode i c for communicating with all registers mhz spi serial interface for communicating with all registers mpu only mhz spi serial interface for reading sensor and interrupt registers mpu only mpu mpu product specification document number ps mpu a revision release date of mems structure hermetically sealed and bonded at wafer level rohs and green compliant motionprocessing internal digital motion processing dmp engine supports d motionprocessing and gesture recognition algorithms the mpu x collects gyroscope and accelerometer data while synchronizing data sampling at a user defined rate the total dataset obtained by the mpu x includes axis gyroscope data axis accelerometer data and temperature data the mpu s calculated output to the system processor can also include heading data from a digital axis third party magnetometer the fifo buffers the complete data set reducing timing requirements on the system processor by allowing the processor burst read the fifo data after burst reading the fifo data the system processor can save power by entering a low power sleep mode while the mpu collects more data programmable interrupt supports features such as gesture recognition panning zooming scrolling tap detection and shake detection digitally programmable low pass filters low power pedometer functionality allows the host processor to sleep while the dmp maintains the step count clocking on chip timing generator frequency variation over full temperature range optional external clock inputs of khz or mhz mpu mpu product specification document number ps mpu a revision release date of electrical characteristics gyroscope specifications vdd v v vlogic mpu only v or vdd t a c parameter conditions min typ max units notes gyroscope sensitivity full scale range fs sel s fs sel s fs sel s fs sel s gyroscope adc word length bits sensitivity scale factor fs sel lsb s fs sel lsb s fs sel lsb s fs sel lsb s sensitivity scale factor tolerance c sensitivity scale factor variation over temperature nonlinearity best fit straight line c cross axis sensitivity gyroscope zero rate output zro initial zro tolerance c s zro variation over temperature c to c s power supply sensitivity hz sine wave mvpp vdd v s power supply sensitivity hz sine wave mvpp vdd v s power supply sensitivity hz khz sine wave mvpp vdd v s linear acceleration sensitivity static s g self test response relative change from factory trim gyroscope noise performance fs sel total rms noise dlpfcfg hz s rms low frequency rms noise bandwidth hz to hz s rms rate noise spectral density at hz s hz gyroscope mechanical frequencies x axis khz y axis khz z axis khz low pass filter response programmable range hz output data rate programmable hz gyroscope start up time dlpfcfg zro settling from power on to s of final ms please refer to the following document for further information on self test mpu mpu register map and descriptions mpu mpu product specification document number ps mpu a revision release date of accelerometer specifications vdd v v vlogic mpu only v or vdd t a c parameter conditions min typ max units notes accelerometer sensitivity full scale range afs sel g afs sel g afs sel g afs sel g adc word length output in two s complement format bits sensitivity scale factor afs sel lsb g afs sel lsb g afs sel lsb g afs sel lsb g initial calibration tolerance sensitivity change vs temperature afs sel c to c c nonlinearity best fit straight line cross axis sensitivity zero g output initial calibration tolerance x and y axes mg z axis mg zero g level change vs temperature x and y axes c to c z axis c to c mg self test response relative change from factory trim noise performance power spectral density hz afs sel odr khz g hz low pass filter response programmable range hz output data rate programmable range hz intelligence function increment mg lsb typical zero g initial calibration tolerance value after msl preconditioning please refer to the following document for further information on self test mpu mpu register map and descriptions mpu mpu product specification document number ps mpu a revision release date of electrical and other common specifications vdd v v vlogic mpu only v or vdd t a c parameter conditions min typ max units notes temperature sensor range to c sensitivity untrimmed lsb c temperature offset o c lsb linearity best fit straight line c to c c vdd power supply operating voltages v normal operating current gyroscope accelerometer dmp ma gyroscope accelerometer dmp disabled ma gyroscope dmp accelerometer disabled ma gyroscope only dmp accelerometer disabled ma accelerometer only dmp gyroscope disabled a accelerometer low power mode current hz update rate a hz update rate a hz update rate a hz update rate a full chip idle mode supply current a power supply ramp rate monotonic ramp ramp rate is to of the final value ms vlogic reference voltage mpu only voltage range vlogic must be vdd at all times vdd v power supply ramp rate monotonic ramp ramp rate is to of the final value ms normal operating current a temperature range specified temperature range performance parameters are not applicable beyond specified temperature range c mpu mpu product specification document number ps mpu a revision release date of electrical specifications continued vdd v v vlogic mpu only v or vdd t a c parameter conditions min typ max units notes serial interface spi operating frequency all registers read write mpu only low speed characterization khz mpu only high speed characterization mhz spi operating frequency sensor and interrupt registers read only mpu only mhz i c operating frequency all registers fast mode khz all registers standard mode khz i c address ad ad digital inputs sdi sda ad sclk scl fsync cs clkin v ih high level input voltage mpu vdd v mpu vlogic v v il low level input voltage mpu vdd v mpu vlogic v c i input capacitance pf digital output sdo int v oh high level output voltage r load m mpu vdd v r load m mpu vlogic v v ol low level output voltage r load m mpu vdd v r load m mpu vlogic v v ol int int low level output voltage open ma sink current v output leakage current open na t int int pulse width latch int en s mpu mpu product specification document number ps mpu a revision release date of electrical specifications continued typical operating circuit of section vdd v v vlogic mpu only v or vdd t a c parameters conditions typical units notes primary i c i o scl sda v il low level input voltage mpu to vdd v v ih high level input voltage mpu vdd to vdd v v v hys hysteresis mpu vdd v vil low level input voltage mpu v to vlogic v vih high level input voltage mpu vlogic to vlogic v v vhys hysteresis mpu vlogic v v ol low level output voltage ma sink current to v i ol low level output current v ol v ma v ol v ma output leakage current na t of output fall time from v ihmax to v ilmax c b bus capacitance in pf c b to ns c i capacitance for each i o pin pf auxiliary i c i o aux cl aux da mpu aux vddio v il low level input voltage v to vlogic v v ih high level input voltage vlogic to vlogic v v v hys hysteresis vlogic v v ol low level output voltage vlogic v ma sink current to v v ol low level output voltage vlogic v ma sink current to vlogic v i ol low level output current v ol v v ol v ma ma output leakage current na t of output fall time from v ihmax to v ilmax c b bus capacitance in pf c b to ns c i capacitance for each i o pin pf mpu mpu product specification document number ps mpu a revision release date of electrical specifications continued typical operating circuit of section vdd v v vlogic mpu only v or vdd t a c parameters conditions min typical max units notes internal clock source clk sel gyroscope sample rate fast dlpfcfg sampleratediv khz gyroscope sample rate slow dlpfcfg or sampleratediv khz accelerometer sample rate khz clock frequency initial tolerance clk sel c clk sel c frequency variation over temperature clk sel to clk sel pll settling time clk sel ms external khz clock clk sel external clock frequency khz external clock allowable jitter cycle to cycle rms to s gyroscope sample rate fast dlpfcfg sampleratediv khz gyroscope sample rate slow dlpfcfg or sampleratediv khz accelerometer sample rate khz pll settling time ms external mhz clock clk sel external clock frequency mhz gyroscope sample rate full programmable range hz gyroscope sample rate fast mode dlpfcfg sampleratediv khz gyroscope sample rate slow mode dlpfcfg or sampleratediv khz accelerometer sample rate khz pll settling time ms mpu mpu product specification document number ps mpu a revision release date of i c timing characterization typical operating circuit of section vdd v v vlogic mpu only v or vdd t a c parameters conditions min typical max units notes i c timing i c fast mode f scl scl clock frequency khz t hd sta repeated start condition hold time s t low scl low period s t high scl high period s t su sta repeated start condition setup time s t hd dat sda data hold time s t su dat sda data setup time ns t r sda and scl rise time c b bus cap from to pf c b ns t f sda and scl fall time c b bus cap from to pf c b ns t su sto stop condition setup time s t buf bus free time between stop and start condition s c b capacitive load for each bus line pf t vd dat data valid time s t vd ack data valid acknowledge time s note timing characteristics apply to both primary and auxiliary i c bus i c bus timing diagram mpu mpu product specification document number ps mpu a revision release date of spi timing characterization mpu only typical operating circuit of section vdd v v vlogic mpu only v or vdd t a c unless otherwise noted parameters conditions min typical max units notes spi timing f sclk sclk clock frequency mhz t low sclk low period ns t high sclk high period ns t su cs cs setup time ns t hd cs cs hold time ns t su sdi sdi setup time ns t hd sdi sdi hold time ns t vd sdo sdo valid time c load pf ns t hd sdo sdo hold time c load pf ns t dis sdo sdo output disable time ns spi bus timing diagram mpu mpu product specification document number ps mpu a revision release date of absolute maximum ratings stress above those listed as absolute maximum ratings may cause permanent damage to the device these are stress ratings only and functional operation of the device at these conditions is not implied exposure to the absolute maximum ratings conditions for extended periods may affect device reliability parameter rating supply voltage vdd v to v vlogic input voltage level mpu v to vdd v regout v to v input voltage level clkin aux da ad fsync int scl sda v to vdd v cpout v vdd v v to v acceleration any axis unpowered g for ms operating temperature range c to c storage temperature range c to c electrostatic discharge esd protection kv hbm v mm latch up jedec class ii c ma mpu mpu product specification document number ps mpu a revision release date of applications information pin out and signal description pin number mpu mpu pin name pin description y y clkin optional external reference clock input connect to gnd if unused y y aux da i c master serial data for connecting to external sensors y y aux cl i c master serial clock for connecting to external sensors y cs spi chip select spi mode y vlogic digital i o supply voltage y ad sdo i c slave address lsb ad spi serial data output sdo y ad i c slave address lsb ad y y regout regulator filter capacitor connection y y fsync frame synchronization digital input connect to gnd if unused y y int interrupt digital output totem pole or open drain y y vdd power supply voltage and digital i o supply voltage y y gnd power supply ground y y resv reserved do not connect y y cpout charge pump capacitor connection y y resv reserved do not connect y scl sclk i c serial clock scl spi serial clock sclk y scl i c serial clock scl y sda sdi i c serial data sda spi serial data input sdi y sda i c serial data sda y y nc not internally connected may be used for pcb trace routing mpu mpu z x y aux cl vlogic ad regout fsync int nc nc nc vdd nc gnd nc nc nc aux da nc clkin resv cpout resv resv scl sda mpu qfn package pin mm x mm x mm orientation of axes of sensitivity and polarity of rotation top view z y x aux cl cs ad sdo regout fsync int nc nc nc vdd nc gnd nc nc nc aux da nc clkin resv cpout resv resv scl sclk sda sdi mpu qfn package pin mm x mm x mm top view mpu mpu product specification document number ps mpu a revision release date of typical operating circuit ad sdo typical operating circuits mpu clkin cs gnd gnd gnd fsync int gnd vdd scl sclk sda sdi c nf c f c f ad mpu clkin gnd gnd gnd fsync int gnd vdd scl sda c nf c f c f gnd vlogic c nf aux cl aux da aux cl aux da bill of materials for external components component label specification quantity regulator filter capacitor pin c ceramic x r f v vdd bypass capacitor pin c ceramic x r f v charge pump capacitor pin c ceramic x r nf v vlogic bypass capacitor pin c ceramic x r nf v mpu only mpu mpu product specification document number ps mpu a revision release date of recommended power on procedure t vlgr vlogic vdd t vddr all voltages at v power up sequencing vlogic amplitude must always be vdd amplitude t vddr is vdd rise time time for vdd to rise from to of its final value t vddr is ms t vlgr is vlogic rise time time for vlogic to rise from to of its final value t vlgr is ms t vlg vdd is the delay from the start of vdd ramp to the start of vlogic rise t vlg vdd is vdd and vlogic must be monotonic ramps t vlg vdd mpu mpu product specification document number ps mpu a revision release date of block diagram clock mpu x charge pump cs ad sdo scl sclk sda sdi temp sensor adc adc z gyro adc y gyro digital motion processor dmp fsync slave i c and spi serial interface master i c serial interface clock cpout serial interface bypass mux aux cl aux da int factory calibration interrupt status register vdd bias ldo gnd regout note pin names in round brackets apply only to mpu pin names in square brackets apply only to mpu z accel y accel x accel adc adc adc clkin clkout adc x gyro signal conditioning fifo config registers sensor registers self test vlogic self test self test self test self test self test overview the mpu x is comprised of the following key blocks and functions three axis mems rate gyroscope sensor with bit adcs and signal conditioning three axis mems accelerometer sensor with bit adcs and signal conditioning digital motion processor dmp engine primary i c and spi mpu only serial communications interfaces auxiliary i c serial interface for rd party magnetometer other sensors clocking sensor data registers fifo interrupts digital output temperature sensor gyroscope accelerometer self test bias and ldo charge pump mpu mpu product specification document number ps mpu a revision release date of three axis mems gyroscope with bit adcs and signal conditioning the mpu x consists of three independent vibratory mems rate gyroscopes which detect rotation about the x y and z axes when the gyros are rotated about any of the sense axes the coriolis effect causes a vibration that is detected by a capacitive pickoff the resulting signal is amplified demodulated and filtered to produce a voltage that is proportional to the angular rate this voltage is digitized using individual on chip bit analog to digital converters adcs to sample each axis the full scale range of the gyro sensors may be digitally programmed to or degrees per second dps the adc sample rate is programmable from samples per second down to samples per second and user selectable low pass filters enable a wide range of cut off frequencies three axis mems accelerometer with bit adcs and signal conditioning the mpu x s axis accelerometer uses separate proof masses for each axis acceleration along a particular axis induces displacement on the corresponding proof mass and capacitive sensors detect the displacement differentially the mpu x s architecture reduces the accelerometers susceptibility to fabrication variations as well as to thermal drift when the device is placed on a flat surface it will measure g on the x and y axes and g on the z axis the accelerometers scale factor is calibrated at the factory and is nominally independent of supply voltage each sensor has a dedicated sigma delta adc for providing digital outputs the full scale range of the digital output can be adjusted to g g g or g digital motion processor the embedded digital motion processor dmp is located within the mpu x and offloads computation of motion processing algorithms from the host processor the dmp acquires data from accelerometers gyroscopes and additional rd party sensors such as magnetometers and processes the data the resulting data can be read from the dmp s registers or can be buffered in a fifo the dmp has access to one of the mpu s external pins which can be used for generating interrupts the purpose of the dmp is to offload both timing requirements and processing power from the host processor typically motion processing algorithms should be run at a high rate often around hz in order to provide accurate results with low latency this is required even if the application updates at a much lower rate for example a low power user interface may update as slowly as hz but the motion processing should still run at hz the dmp can be used as a tool in order to minimize power simplify timing simplify the software architecture and save valuable mips on the host processor for use in the application primary i c and spi serial communications interfaces the mpu x communicates to a system processor using either a spi mpu only or an i c serial interface the mpu x always acts as a slave when communicating to the system processor the lsb of the of the i c slave address is set by pin ad the logic levels for communications between the mpu x and its master are as follows mpu the logic level for communications with the master is set by the voltage on vdd mpu the logic level for communications with the master is set by the voltage on vlogic for further information regarding the logic levels of the mpu please refer to section mpu mpu product specification document number ps mpu a revision release date of auxiliary i c serial interface the mpu x has an auxiliary i c bus for communicating to an off chip axis digital output magnetometer or other sensors this bus has two operating modes i c master mode the mpu x acts as a master to any external sensors connected to the auxiliary i c bus pass through mode the mpu x directly connects the primary and auxiliary i c buses together allowing the system processor to directly communicate with any external sensors auxiliary i c bus modes of operation i c master mode allows the mpu x to directly access the data registers of external digital sensors such as a magnetometer in this mode the mpu x directly obtains data from auxiliary sensors allowing the on chip dmp to generate sensor fusion data without intervention from the system applications processor for example in i c master mode the mpu x can be configured to perform burst reads returning the following data from a magnetometer x magnetometer data bytes y magnetometer data bytes z magnetometer data bytes the i c master can be configured to read up to bytes from up to auxiliary sensors a fifth sensor can be configured to work single byte read write mode pass through mode allows an external system processor to act as master and directly communicate to the external sensors connected to the auxiliary i c bus pins aux da and aux cl in this mode the auxiliary i c bus control logic rd party sensor interface block of the mpu x is disabled and the auxiliary i c pins aux da and aux cl pins and are connected to the main i c bus pins and through analog switches pass through mode is useful for configuring the external sensors or for keeping the mpu x in a low power mode when only the external sensors are used in pass through mode the system processor can still access mpu x data through the i c interface auxiliary i c bus io logic levels mpu the logic level of the auxiliary i c bus is vdd mpu the logic level of the auxiliary i c bus can be programmed to be either vdd or vlogic for further information regarding the mpu s logic levels please refer to section mpu mpu product specification document number ps mpu a revision release date of self test please refer to the mpu mpu register map and register descriptions document for more details on self test self test allows for the testing of the mechanical and electrical portions of the sensors the self test for each measurement axis can be activated by means of the gyroscope and accelerometer self test registers registers to when self test is activated the electronics cause the sensors to be actuated and produce an output signal the output signal is used to observe the self test response the self test response is defined as follows self test response sensor output with self test enabled sensor output without self test enabled the self test response for each accelerometer axis is defined in the accelerometer specification table section while that for each gyroscope axis is defined in the gyroscope specification table section when the value of the self test response is within the min max limits of the product specification the part has passed self test when the self test response exceeds the min max values the part is deemed to have failed self test code for operating self test code is included within the motionapps software provided by invensense mpu mpu product specification document number ps mpu a revision release date of mpu x solution for axis sensor fusion using i c interface in the figure below the system processor is an i c master to the mpu x in addition the mpu x is an i c master to the optional external compass sensor the mpu x has limited capabilities as an i c master and depends on the system processor to manage the initial configuration of any auxiliary sensors the mpu x has an interface bypass multiplexer which connects the system processor i c bus pins and sda and scl directly to the auxiliary sensor i c bus pins and aux da and aux cl once the auxiliary sensors have been configured by the system processor the interface bypass multiplexer should be disabled so that the mpu x auxiliary i c master can take control of the sensor i c bus and gather data from the auxiliary sensors for further information regarding i c master control please refer to section mpu x ad sdo scl sclk sda sdi digital motion processor dmp sensor master i c serial interface aux cl aux da interrupt status register int vdd bias ldo gnd regout fifo config register sensor register factory calibration cs slave i c or spi serial interface compass scl sda system processor interface bypass mux scl sda vdd vdd or gnd i c processor bus for reading all sensor data from mpu and for configuring external sensors i e compass in this example interface bypass mux allows direct configuration of compass by system processor optional sensor i c bus for configuring and reading from external sensors mpu mpu product specification document number ps mpu a revision release date of mpu using spi interface in the figure below the system processor is an spi master to the mpu pins and are used to support the cs sdo sclk and sdi signals for spi communications because these spi pins are shared with the i c slave pins and the system processor cannot access the auxiliary i c bus through the interface bypass multiplexer which connects the processor i c interface pins to the sensor i c interface pins since the mpu has limited capabilities as an i c master and depends on the system processor to manage the initial configuration of any auxiliary sensors another method must be used for programming the sensors on the auxiliary sensor i c bus pins and aux da and aux cl when using spi communications between the mpu and the system processor configuration of devices on the auxiliary i c sensor bus can be achieved by using i c slaves to perform read and write transactions on any device and register on the auxiliary i c bus the i c slave interface can be used to perform only single byte read and write transactions once the external sensors have been configured the mpu can perform single or multi byte reads using the sensor i c bus the read results from the slave controllers can be written to the fifo buffer as well as to the external sensor registers for further information regarding the control of the mpu x s auxiliary i c interface please refer to the mpu mpu register map and register descriptions document mpu ad sdo scl sclk sda sdi digital motion processor dmp sensor master i c serial interface interrupt status register int vdd bias ldo gnd regout fifo config register sensor register factory calibration cs slave i c or spi serial interface system processor interface bypass mux sdi sclk sdo cs processor spi bus for reading all data from mpu and for configuring mpu and external sensors aux cl aux da compass scl sda optional i c master performs read and write transactions on sensor i c bus sensor i c bus for configuring and reading data from external sensors mpu mpu product specification document number ps mpu a revision release date of internal clock generation the mpu x has a flexible clocking scheme allowing a variety of internal or external clock sources to be used for the internal synchronous circuitry this synchronous circuitry includes the signal conditioning and adcs the dmp and various control circuits and registers an on chip pll provides flexibility in the allowable inputs for generating this clock allowable internal sources for generating the internal clock are an internal relaxation oscillator any of the x y or z gyros mems oscillators with a variation of over temperature allowable external clocking sources are khz square wave mhz square wave selection of the source for generating the internal synchronous clock depends on the availability of external sources and the requirements for power consumption and clock accuracy these requirements will most likely vary by mode of operation for example in one mode where the biggest concern is power consumption the user may wish to operate the digital motion processor of the mpu x to process accelerometer data while keeping the gyros off in this case the internal relaxation oscillator is a good clock choice however in another mode where the gyros are active selecting the gyros as the clock source provides for a more accurate clock source clock accuracy is important since timing errors directly affect the distance and angle calculations performed by the digital motion processor and by extension by any processor there are also start up conditions to consider when the mpu x first starts up the device uses its internal clock until programmed to operate from another source this allows the user for example to wait for the mems oscillators to stabilize before they are selected as the clock source sensor data registers the sensor data registers contain the latest gyro accelerometer auxiliary sensor and temperature measurement data they are read only registers and are accessed via the serial interface data from these registers may be read anytime however the interrupt function may be used to determine when new data is available for a table of interrupt sources please refer to section fifo the mpu x contains a byte fifo register that is accessible via the serial interface the fifo configuration register determines which data is written into the fifo possible choices include gyro data accelerometer data temperature readings auxiliary sensor readings and fsync input a fifo counter keeps track of how many bytes of valid data are contained in the fifo the fifo register supports burst reads the interrupt function may be used to determine when new data is available for further information regarding the fifo please refer to the mpu mpu register map and register descriptions document interrupts interrupt functionality is configured via the interrupt configuration register items that are configurable include the int pin configuration the interrupt latching and clearing method and triggers for the interrupt items that can trigger an interrupt are clock generator locked to new reference oscillator used when switching clock mpu mpu product specification document number ps mpu a revision release date of sources new data is available to be read from the fifo and data registers accelerometer event interrupts and the mpu x did not receive an acknowledge from an auxiliary sensor on the secondary i c bus the interrupt status can be read from the interrupt status register for further information regarding interrupts please refer to the mpu x register map and register descriptions document for information regarding the mpu x s accelerometer event interrupts please refer to section digital output temperature sensor an on chip temperature sensor and adc are used to measure the mpu x die temperature the readings from the adc can be read from the fifo or the sensor data registers bias and ldo the bias and ldo section generates the internal supply and the reference voltages and currents required by the mpu x its two inputs are an unregulated vdd of to v and a vlogic logic reference supply voltage of v to vdd mpu only the ldo output is bypassed by a capacitor at regout for further details on the capacitor please refer to the bill of materials for external components section charge pump an on board charge pump generates the high voltage required for the mems oscillators its output is bypassed by a capacitor at cpout for further details on the capacitor please refer to the bill of materials for external components section mpu mpu product specification document number ps mpu a revision release date of programmable interrupts the mpu x has a programmable interrupt system which can generate an interrupt signal on the int pin status flags indicate the source of an interrupt interrupt sources may be enabled and disabled individually table of interrupt sources interrupt name module fifo overflow fifo data ready sensor registers i c master errors lost arbitration nacks i c master i c slave i c master for information regarding the interrupt enable disable registers and flag registers please refer to the mpu mpu register map and register descriptions document some interrupt sources are explained below mpu mpu product specification document number ps mpu a revision release date of digital interface i c and spi mpu only serial interfaces the internal registers and memory of the mpu mpu can be accessed using either i c at khz or spi at mhz mpu only spi operates in four wire mode serial interface pin number mpu mpu pin name pin description y cs spi chip select spi enable y vlogic digital i o supply voltage vlogic must be vdd at all times y ad sdo i c slave address lsb ad spi serial data output sdo y ad i c slave address lsb y scl sclk i c serial clock scl spi serial clock sclk y scl i c serial clock y sda sdi i c serial data sda spi serial data input sdi y sda i c serial data note to prevent switching into i c mode when using spi mpu the i c interface should be disabled by setting the i c if dis configuration bit setting this bit should be performed immediately after waiting for the time specified by the start up time for register read write in section for further information regarding the i c if dis bit please refer to the mpu mpu register map and register descriptions document i c interface i c is a two wire interface comprised of the signals serial data sda and serial clock scl in general the lines are open drain and bi directional in a generalized i c interface implementation attached devices can be a master or a slave the master device puts the slave address on the bus and the slave device with the matching address acknowledges the master the mpu x always operates as a slave device when communicating to the system processor which thus acts as the master sda and scl lines typically need pull up resistors to vdd the maximum bus speed is khz the slave address of the mpu x is b x which is bits long the lsb bit of the bit address is determined by the logic level on pin ad this allows two mpu x s to be connected to the same i c bus when used in this configuration the address of the one of the devices should be b pin ad is logic low and the address of the other should be b pin ad is logic high i c communications protocol start s and stop p conditions communication on the i c bus starts when the master puts the start condition s on the bus which is defined as a high to low transition of the sda line while scl line is high see figure below the bus is considered to be busy until the master puts a stop condition p on the bus which is defined as a low to high transition on the sda line while scl is high see figure below mpu mpu product specification document number ps mpu a revision release date of additionally the bus remains busy if a repeated start sr is generated instead of a stop condition sda scl s start condition stop condition p start and stop conditions data format acknowledge i c data bytes are defined to be bits long there is no restriction to the number of bytes transmitted per data transfer each byte transferred must be followed by an acknowledge ack signal the clock for the acknowledge signal is generated by the master while the receiver generates the actual acknowledge signal by pulling down sda and holding it low during the high portion of the acknowledge clock pulse if a slave is busy and cannot transmit or receive another byte of data until some other task has been performed it can hold scl low thus forcing the master into a wait state normal data transfer resumes when the slave is ready and releases the clock line refer to the following figure data output by transmitter sda data output by receiver sda scl from master start condition clock pulse for acknowledgement acknowledge not acknowledge acknowledge on the i c bus mpu mpu product specification document number ps mpu a revision release date of communications after beginning communications with the start condition s the master sends a bit slave address followed by an th bit the read write bit the read write bit indicates whether the master is receiving data from or is writing to the slave device then the master releases the sda line and waits for the acknowledge signal ack from the slave device each byte transferred must be followed by an acknowledge bit to acknowledge the slave device pulls the sda line low and keeps it low for the high period of the scl line data transmission is always terminated by the master with a stop condition p thus freeing the communications line however the master can generate a repeated start condition sr and address another slave without first generating a stop condition p a low to high transition on the sda line while scl is high defines the stop condition all sda changes should take place when scl is low with the exception of start and stop conditions sda start condition scl address r w ack data ack data ack stop condition s p complete i c data transfer to write the internal mpu x registers the master transmits the start condition s followed by the i c address and the write bit at the th clock cycle when the clock is high the mpu x acknowledges the transfer then the master puts the register address ra on the bus after the mpu x acknowledges the reception of the register address the master puts the register data onto the bus this is followed by the ack signal and data transfer may be concluded by the stop condition p to write multiple bytes after the last ack signal the master can continue outputting data rather than transmitting a stop signal in this case the mpu x automatically increments the register address and loads the data to the appropriate register the following figures show single and two byte write sequences single byte write sequence burst write sequence master s ad w ra data p slave ack ack ack master s ad w ra data data p slave ack ack ack ack mpu mpu product specification document number ps mpu a revision release date of to read the internal mpu x registers the master sends a start condition followed by the i c address and a write bit and then the register address that is going to be read upon receiving the ack signal from the mpu x the master transmits a start signal followed by the slave address and read bit as a result the mpu x sends an ack signal and the data the communication ends with a not acknowledge nack signal and a stop bit from master the nack condition is defined such that the sda line remains high at the th clock cycle the following figures show single and two byte read sequences single byte read sequence burst read sequence i c terms signal description s start condition sda goes from high to low while scl is high ad slave i c address w write bit r read bit ack acknowledge sda line is low while the scl line is high at the th clock cycle nack not acknowledge sda line stays high at the th clock cycle ra mpu x internal register address data transmit or received data p stop condition sda going from low to high while scl is high master s ad w ra s ad r nack p slave ack ack ack data master s ad w ra s ad r ack nack p slave ack ack ack data data mpu mpu product specification document number ps mpu a revision release date of spi interface mpu only spi is a wire synchronous serial interface that uses two control lines and two data lines the mpu always operates as a slave device during standard master slave spi operation with respect to the master the serial clock output sclk the serial data output sdo and the serial data input sdi are shared among the slave devices each spi slave device requires its own chip select cs line from the master cs goes low active at the start of transmission and goes back high inactive at the end only one cs line is active at a time ensuring that only one slave is selected at any given time the cs lines of the non selected slave devices are held high causing their sdo lines to remain in a high impedance high z state so that they do not interfere with any active devices spi operational features data is delivered msb first and lsb last data is latched on the rising edge of sclk data should be transitioned on the falling edge of sclk the maximum frequency of sclk is mhz spi read and write operations are completed in or more clock cycles two or more bytes the first byte contains the spi address and the following byte s contain s the spi data the first bit of the first byte contains the read write bit and indicates the read or write operation the following bits contain the register address in cases of multiple byte read writes data is two or more bytes spi address format msb lsb r w a a a a a a a spi data format msb lsb d d d d d d d d supports single or burst read writes typical spi master slave configuration spi master spi slave spi slave cs cs sclk sdi sdo cs sclk sdi sdo cs mpu mpu product specification document number ps mpu a revision release date of serial interface considerations mpu mpu supported interfaces the mpu supports i c communications on both its primary microprocessor serial interface and its auxiliary interface logic levels the mpu s i o logic levels are set to be vlogic as shown in the table below aux vddio must be set to i o logic levels vs aux vddio aux vddio microprocessor logic levels pins sda scl ad clkin int auxillary logic levels pins aux da aux cl vlogic vlogic note the power on reset value for aux vddio is when aux vddio is set to its power on reset value vlogic is the power supply voltage for both the microprocessor system bus and the auxiliary i c bus as shown in the figure of section mpu mpu product specification document number ps mpu a revision release date of logic levels diagram for aux vddio the figure below depicts a sample circuit with a third party magnetometer attached to the auxiliary i c bus it shows logic levels and voltage connections for aux vddio note actual configuration will depend on the auxiliary sensors used mpu rd party magnetometer sda aux cl scl aux da vdd io vdd sa int int system processor io clkin system bus vlogic vlogic vlogic vdd vlogic v vlogic scl sda int fsync vlogic ad v vlogic v vlogic v vlogic v vlogic v vlogic v vlogic v vlogic v vlogic v vlogic v vlogic v vlogic cs v vlogic vdd io i o levels and connections for aux vddio notes aux vddio determines the io voltage levels of aux da and aux cl set output levels relative to vlogic all other mpu logic ios are referenced to vlogic mpu mpu product specification document number ps mpu a revision release date of assembly this section provides general guidelines for assembling invensense micro electro mechanical systems mems gyros packaged in quad flat no leads package qfn surface mount integrated circuits orientation of axes the diagram below shows the orientation of the axes of sensitivity and the polarity of rotation note the pin identifier in the figure mpu mpu z x y orientation of axes of sensitivity and polarity of rotation z y x mpu mpu product specification document number ps mpu a revision release date of package dimensions lead qfn x x mm nipdau lead frame finish symbols dimensions in millimeters min nom max a a b c ref d d e e e f e b k l l s co d d e pin identifier is a laser marked feature on top e b c a a on corners lead dimensions s s l e l f mpu mpu product specification document number ps mpu a revision release date of pcb design guidelines the pad diagram using a jedec type extension with solder rising on the outer edge is shown below the pad dimensions table shows pad sizing mean dimensions recommended for the mpu x product jedec type extension with solder rising on outer edge pcb layout diagram symbols dimensions in millimeters nom nominal package i o pad dimensions e pad pitch b pad width l pad length l pad length d package width e package length d exposed pad width e exposed pad length i o land design dimensions guidelines d i o pad extent width e i o pad extent length c land width tout outward extension tin inward extension l land length l land length pcb dimensions table for pcb lay out diagram mpu mpu product specification document number ps mpu a revision release date of assembly precautions gyroscope surface mount guidelines invensense mems gyros sense rate of rotation in addition gyroscopes sense mechanical stress coming from the printed circuit board pcb this pcb stress can be minimized by adhering to certain design rules when using mems gyroscope components in plastic packages pcb mounting and assembly can cause package stress this package stress in turn can affect the output offset and its value over a wide range of temperatures this stress is caused by the mismatch between the coefficient of linear thermal expansion cte of the package material and the pcb care must be taken to avoid package stress due to mounting traces connected to pads should be as symmetric as possible maximizing symmetry and balance for pad connection will help component self alignment and will lead to better control of solder paste reduction after reflow any material used in the surface mount assembly process of the mems gyroscope should be free of restricted rohs elements or compounds pb free solders should be used for assembly exposed die pad precautions the mpu x has very low active and standby current consumption the exposed die pad is not required for heat sinking and should not be soldered to the pcb failure to adhere to this rule can induce performance changes due to package thermo mechanical stress there is no electrical connection between the pad and the cmos trace routing routing traces or vias under the gyro package such that they run under the exposed die pad is prohibited routed active signals may harmonically couple with the gyro mems devices compromising gyro response these devices are designed with the drive frequencies as follows x khz y khz and z khz to avoid harmonic coupling don t route active signals in non shielded signal planes directly below or above the gyro package note for best performance design a ground plane under the e pad to reduce pcb signal noise from the board on which the gyro device is mounted if the gyro device is stacked under an adjacent pcb board design a ground plane directly above the gyro device to shield active signals from the adjacent pcb board component placement do not place large insertion components such as keyboard or similar buttons connectors or shielding boxes at a distance of less than mm from the mems gyro maintain generally accepted industry design practices for component placement near the mpu x to prevent noise coupling and thermo mechanical stress pcb mounting and cross axis sensitivity orientation errors of the gyroscope and accelerometer mounted to the printed circuit board can cause cross axis sensitivity in which one gyro or accel responds to rotation or acceleration about another axis respectively for example the x axis gyroscope may respond to rotation about the y or z axes the orientation mounting errors are illustrated in the figure below mpu mpu product specification document number ps mpu a revision release date of package gyro accel axes relative to pcb axes with orientation errors and mpu mpu x y z the table below shows the cross axis sensitivity as a percentage of the gyroscope or accelerometer s sensitivity for a given orientation error respectively cross axis sensitivity vs orientation error orientation error or cross axis sensitivity sin or sin the specifications for cross axis sensitivity in section and section include the effect of the die orientation error with respect to the package mems handling instructions mems micro electro mechanical systems are a time proven robust technology used in hundreds of millions of consumer automotive and industrial products mems devices consist of microscopic moving mechanical structures they differ from conventional ic products even though they can be found in similar packages therefore mems devices require different handling precautions than conventional ics prior to mounting onto printed circuit boards pcbs the mpu x has been qualified to a shock tolerance of g invensense packages its gyroscopes as it deems proper for protection against normal handling and shipping it recommends the following handling precautions to prevent potential damage do not drop individually packaged gyroscopes or trays of gyroscopes onto hard surfaces components placed in trays could be subject to g forces in excess of g if dropped printed circuit boards that incorporate mounted gyroscopes should not be separated by manually snapping apart this could also create g forces in excess of g do not clean mems gyroscopes in ultrasonic baths ultrasonic baths can induce mems damage if the bath energy causes excessive drive motion through resonant frequency coupling esd considerations establish and use esd safe handling precautions when unpacking and handling esd sensitive devices mpu mpu product specification document number ps mpu a revision release date of store esd sensitive devices in esd safe containers until ready for use the tape and reel moisture sealed bag is an esd approved barrier the best practice is to keep the units in the original moisture sealed bags until ready for assembly restrict all device handling to esd protected work areas that measure less than v static charge ensure that all workstations and personnel are properly grounded to prevent esd reflow specification qualification reflow the mpu x was qualified in accordance with ipc jedec j std d this standard classifies proper packaging storage and handling in order to avoid subsequent thermal and mechanical damage during the solder reflow attachment phase of pcb assembly the qualification preconditioning process specifies a sequence consisting of a bake cycle a moisture soak cycle in a temperature humidity oven and three consecutive solder reflow cycles followed by functional device testing the peak solder reflow classification temperature requirement for package qualification is c for lead free soldering of components measuring less than mm in thickness the qualification profile and a table explaining the set points are shown below temperature c time seconds solder reflow profile for qualification lead free ir convection preheat sec t smax t smin t liquidus t pmin t pmax liquidus sec sec t ramp up c sec t ramp down c sec t room pmax sec a b c d e f g h i mpu mpu product specification document number ps mpu a revision release date of temperature set points corresponding to reflow profile above step setting constraints temp c time sec max rate c sec a t room b t smin c t smax t bc d t liquidus r tliquidus tpmax e t pmin c c r tliquidus tpmax f t pmax c c t af r tliquidus tpmax g t pmin c c t eg r tpmax tliquidus h t liquidus t dh i t room notes customers must never exceed the classification temperature t pmax c all temperatures refer to the topside of the qfn package as measured on the package body surface production reflow check the recommendations of your solder manufacturer for optimum results use lead free solders that have lower specified temperature profiles tp max c also use lower ramp up and ramp down rates than those used in the qualification profile never exceed the maximum conditions that we used for qualification as these represent the maximum tolerable ratings for the device storage specifications the storage specification of the mpu x conforms to ipc jedec j std d moisture sensitivity level msl calculated shelf life in moisture sealed bag months storage conditions c and rh after opening moisture sealed bag hours storage conditions ambient c at rh package marking specification invensense mpu x x x x x x x x x x y y w w x lot traceability code foundry code package vendor code rev code y y year code w w work week top view part number invensense mpu x x x x x x x x x x y y w w x top view package marking specification mpu mpu product specification document number ps mpu a revision release date of tape reel specification tape dimensions reel outline drawing reel dimensions and package size package size reel mm l v w z x mpu mpu product specification document number ps mpu a revision release date of tape and reel specification reel specifications quantity per reel reels per box boxes per carton max pcs carton max label barcode label location of label on reel label reel cover tape anti static carrier tape anti static terminal tape user direction of feed invensense invensense invensense invensense pin package orientation i n ve n s ens e p b f r e e ca teg o ry e hf de v ic e p m pu p o h u b r e el qty q l ot t q r f d c d qty q lo t t q v g d c d q t y q reel d ate qc st a m p mpu mpu product specification document number ps mpu a revision release date of packaging reel with barcode vacuum sealed moisture msl label caution labels barrier bag with esd msl caution and barcode labels caution label esd label inner bubble wrap pizza box pizza boxes placed in foam outer shipper label lined shipper box mpu mpu product specification document number ps mpu a revision release date of representative shipping carton label mpu mpu product specification document number ps mpu a revision release date of reliability qualification test policy invensense s products complete a qualification test plan before being released to production the qualification test plan for the mpu x followed the jesd i standards stress test driven qualification of integrated circuits with the individual tests described below qualification test plan accelerated life tests test method condition lot quantity sample lot acc reject criteria htol lfr high temperature operating life jedec jesd a d dynamic v biased tj c read points hours hast highly accelerated stress test jedec jesd a a condition a c rh psia unbiased read point hours hts high temperature storage life jedec jesd a d cond a c non bias bake read points hours device component level tests test method condition lot quantity sample lot acc reject criteria esd hbm esd human body model jedec js kv esd mm esd machine model jedec jesd a c v lu latch up jedec jesd d class ii c ma ms mechanical shock jedec jesd b c mil std method cond e g s ms x y z directions times direction vib vibration jedec jesd b b variable frequency random cond b hz x y z times direction tc temperature cycling jedec jesd a d condition g c to c soak mode cycles board level tests test method condition lot quantity sample lot acc reject criteria bms board mechanical shock jedec jesd b c mil std method cond e g s ms x y z directions times direction btc board temperature cycling jedec jesd a d condition g c to c soak mode cycles tests are preceded by msl preconditioning in accordance with jedec jesd a f mpu mpu product specification document number ps mpu a revision release date of environmental compliance the mpu mpu is rohs and green compliant the mpu mpu is in full environmental compliance as evidenced in report hs mpu materials declaration data sheet environmental declaration disclaimer invensense believes this environmental information to be correct but cannot guarantee accuracy or completeness conformity documents for the above component constitutes are on file invensense subcontracts manufacturing and the information contained herein is based on data received from vendors and suppliers which has not been validated by invensense this information furnished by invensense is believed to be accurate and reliable however no responsibility is assumed by invensense for its use or for any infringements of patents or other rights of third parties that may result from its use specifications are subject to change without notice invensense reserves the right to make changes to this product including its circuits and software in order to improve its design and or performance without prior notice invensense makes no warranties neither expressed nor implied regarding the information and specifications contained in this document invensense assumes no responsibility for any claims or damages arising from information contained in this document or from the use of products and services detailed therein this includes but is not limited to claims or damages based on the infringement of patents copyrights mask work and or other intellectual property rights certain intellectual property owned by invensense and described in this document is patent protected no license is granted by implication or otherwise under any patent or patent rights of invensense this publication supersedes and replaces all information previously supplied trademarks that are registered trademarks are the property of their respective companies invensense sensors should not be used or sold in the development storage production or utilization of any conventional or mass destructive weapons or for any other weapons or life threatening applications as well as in any other life critical applications such as medical equipment transportation aerospace and nuclear instruments undersea equipment power plant equipment disaster prevention and crime prevention equipment invensense is a registered trademark of invensense inc mpu tm mpu tm mpu tm mpu x tm digital motion processor dmp motion processing unit motionfusion motioninterface motiontracking and motionapps are trademarks of invensense inc invensense inc all rights reserved worldwide as millions of people stay at home to minimise transmission of severe acute respiratory syndrome coronavirus health care workers prepare to do the exact opposite they will go to clinics and hospitals putting themselves at high risk from covid figures from china s national health commission show that more than health care workers have been infected as of early march and according to local media by the end of february at least had died in italy of responding health care workers were infected and some have died reports from medical staff describe physical and mental exhaustion the torment of difficult triage decisions and the pain of losing patients and colleagues all in addition to the infection risk as the pandemic accelerates access to personal protective equipment ppe for health workers is a key concern medical staff are prioritised in many countries but ppe shortages have been described in the most affected facilities some medical staff are waiting for equipment while already seeing patients who may be infected or are supplied with equipment that might not meet requirements alongside concerns for their personal safety health care workers are anxious about passing the infection to their families health care workers who care for elderly parents or young children will be drastically affected by school closures social distancing policies and disruption in the availability of food and other essentials health care systems globally could be operating at more than maximum capacity for many months but health care workers unlike ventilators or wards cannot be urgently manufactured or run at occupancy for long periods it is vital that governments see workers not simply as pawns to be deployed but as human individuals in the global response the safety of health care workers must be ensured adequate provision of ppe is just the first step other practical measures must be considered including cancelling non essential events to prioritise resources provision of food rest and family support and psychological support presently health care workers are every country s most valuable resource summary background we aimed to evaluate and improve the accuracy of the ultrasound scan in estimating gestational age in late pregnancy ie after weeks gestation in low income and middle income countries lmics where access to ultrasound in the first half of pregnancy is rare and where intrauterine growth restriction is prevalent methods this prospective population based cohort study was done in three lmics bangladesh pakistan and tanzania participating in the who alliance for maternal and newborn health improvement study women carrying a live singleton fetus dated by crown rump length crl measurements between weeks of gestation who were willing to return for two additional ultrasound scans and who planned on delivering in the study area were enrolled in the study participants underwent ultrasonography at weeks and at weeks gestation birthweights were measured within h of birth and the proportions of infants who had a small for gestational age birthweight ie a birthweight of the standard birthweight for the infant s gestational age and sex according to the intergrowth st project newborn baby reference standards and appropriate for gestational age birthweights were ascertained estimation of gestational age by standard fetal biometry measurements in addition to transcerebellar diameter tcd measurements was compared with gold standard crl measurements by use of bland altman plots to calculate the mean difference and limits of agreement statistical modelling was done to develop new gestational age prediction formulas for third trimester ultrasonography in lmics findings between feb and jan women were enrolled in the study pregnant women had an ultrasound scan at weeks of gestation and had an ultrasound scan between weeks of gestation of the unique infants whose birthweights were available infants were born with an appropriate for gestational age birthweight and infants were born with a small for gestational age birthweight the accuracy of late pregnancy ultrasound biometry using existing formulas to estimate gestational age in lmics was similar to that in high income settings with standard dating formulas late pregnancy ultrasound at weeks gestation was accurate to within approximately plus or minus weeks of the gold standard crl measurement of gestational age and late pregnancy ultrasound was accurate to within weeks of the crl measurement at weeks gestation in infants who were ultimately born small for gestational age individual parameters systematically underestimated gestational age apart from tcd which showed minimal bias by use of a novel parsimonious model formula that combined tcd with femur length gestational age at the week ultrasound scan was estimated to within days of the crl measurement and estimated to within days of the crl measurement at the week ultrasound scan similar results were observed in infants who were small for gestational age interpretation incorporation of tcd and the use of new formulas in late pregnancy ultrasound scans could improve the accuracy of gestational age estimation in both appropriate for gestational age and small for gestational age infants in lmics given the high rates of small for gestational age infants in lmics these results might be especially relevant validation of this new formula in other lmic populations is needed to establish whether the accuracy of the late pregnancy ultrasound can be narrowed to within approximately weeks funding bill melinda gates foundation view related content for this article research in context evidence before this study the performance of late pregnancy ultrasound for assessing gestational age has been understudied in low income and middle income countries lmics where access to ultrasound for gestational age dating early in pregnancy is rare and where a high proportion of infants are born small for gestational age in high income settings the transcerebellar diameter tcd has shown promise as a biometric parameter that is less affected by intrauterine growth restriction than standard ultrasound biometric measurements but this parameter is not routinely used as most women in high income settings present earlier weeks of gestation for ultrasound confirmation of gestational age added value of this study in this multicountry population based cohort study we compared the performance of standard ultrasound biometric parameters and tcd with the gold standard method of first trimester crown rump length crl measurements for estimating gestational age in late pregnancy ie after weeks gestation the accuracy of ultrasonography in estimating gestational age in late pregnancy in lmics was similar to that reported in high income settings but it was further improved when tcd was included in the combination formulas for gestational age assessment we derived a parsimonious model requiring measurement of only the tcd and the femur length that was accurate to within approximately plus or minus weeks of the gold standard crl measurement of gestational age even among infants who were ultimately born small for gestational age our study was population based enrolling an unselected group of pregnant women rather than a selected group of only the healthiest pregnant women therefore we believe our novel gestational age formula is more generalisable to real world conditions that health care practitioners in lmics face implications of all the available evidence in lmics gestational age in late pregnancy can be reliably assessed to within approximately weeks of the crl measurement by use of only two ultrasound parameters these results were consistent when our gestational age formulas were applied to pregnancies in which the infants were ultimately born small for gestational age our formulas could be most useful when measuring gestational age in pregnant women who present late to receive antenatal care in lmics where the burden of intrauterine growth restriction is high the biometric ultrasound measurements used in our study appear to be attainable by health care providers with limited sonography training accurate gestational age dating can enable providers to identify pregnancies requiring antenatal interventions such as corticosteroids or transfer to a facility that is able to handle premature infants accurate dating will also allow researchers to better estimate the global burden of preterm birth and intrauterine growth restriction introduction pregnancy dating is an essential component of antenatal care accurate estimation of gestational age is needed to optimise provision of obstetric interventions and delivery location for preterm births and it is also a prerequisite to identify and manage fetal growth abnormalities additionally accurate estimation of gestational age is required to provide reasonable global estimates of preterm birth and intrauterine growth restriction in low income and middle income countries lmics where the burden of preterm birth and intrauterine growth restriction is highest assessing gestational age accurately can be challenging because of many factors for instance last menstrual period is often unknown and menstrual cycles can vary in length symphysis fundal height can be a misleading measure of gestational age because of variation in maternal adiposity intrauterine growth restriction uterine fibroids or malpresentation the first trimester ultrasound is considered to be the gold standard method for estimating gestational age in high income settings but ultrasound early in gestation might not be routinely available in lmics in addition pregnant women in lmics might not present for antenatal care in early pregnancy as gestation advances ultrasound biometry becomes less accurate for estimating gestational age given the emergence of natural variation in fetal size and the possibility of pathological growth restriction indeed in lmics where of infants are born small for gestational age the assumption that fetal size predicts gestational age might not be valid studies suggest that measurements of the cerebellum could allow for a more accurate estimation of gestational age late in pregnancy ie from weeks gestation onwards compared with standard biometry measurements cerebellar size appears to be less affected by intrauterine growth restriction than other measures of growth there is also less natural variation in cerebellar size between fetuses transcerebellar diameter tcd nomograms have been published for several populations but they are not in mainstream use in high income settings as most women have early ultrasound scans at weeks gestation when standard biometric measurements biparietal diameter head circumference abdominal circumference and femur length are reported to provide an accurate estimation of gestational age to within plus or minus weeks of the gold standard crown rump length crl measurement of gestational age standard biometry does not perform as well in the third trimester as it does at less than weeks gestation with a reported accuracy of only or more weeks of the crl measurement one study in the usa found a strong correlation between cerebellar size and gestational age in infants born with an appropriate for gestational age birthweight and in those born small for gestational age even though a small number of studies have measured the cerebellum in specific lmics the performance of cerebellar biometry for assessing gestational age has been understudied in settings where its use might be of greater benefit the objective of the who alliance for maternal and newborn health improvement amanhi late pregnancy dating study was to evaluate the accuracy of late pregnancy ie after weeks gestation ultrasound biometry in estimating gestational age in lmic settings with a particular focus on the effect of intrauterine growth restriction on the accuracy and whether cerebellar measurements could improve performance methods study design and participants the who amanhi study cohort was established in to harmonise several large ongoing maternal and neonatal health research studies in sub saharan africa and south asia the study involved five distinct sites sylhet bangladesh karachi pakistan pemba tanzania brong ahafo gahna southern province zambia three of the five amanhi sites sylhet karachi and pemba participated in this prospective multicountry population based cohort substudy known as the who amanhi late pregnancy dating study the remaining two sites brong ahafo and the southern province were ineligible having completed amanhi enrolment amanhi study populations were predominantly rural with low levels of literacy as amanhi was an unselected population based cohort it was inclusive of both appropriately grown and growth restricted infants between feb and jan pregnant women were identified by trained field workers through home visits urine tests for human chorionic gonadotropin were used to confirm pregnancies women were eligible for the study if they were pregnant with a live singleton fetus the pregnancy had been dated by crl measurements between and weeks gestation crl of mm they were willing to return for two additional ultrasounds and they planned on delivering in the study area women pregnant with multiple fetuses or a non viable or anomalous fetus were ineligible fieldworkers obtained written informed consent from participants in their local languages and arranged study ultrasounds to coincide with standard amanhi visits ethics approval was granted by institutional review boards and ethics review committees in the participating countries the host institutions of principal investigators who and partners healthcare the boston based coordinating team procedures we considered the first trimester ultrasound scan to be the gold standard method for estimating gestational age amanhi study sonographers followed standardised procedures to obtain high quality transabdominal crl measurements three crl measurements were obtained for each participant and the median crl value and the intergrowth st equation were used to calculate gestational age first trimester crl measurements established the estimated date of delivery and were considered as the gold standard gestational age at all subsequent study visits study ultrasound procedures were standardised during a day training course in bangladesh for staff from participating amanhi sites and consisted of didactic and practical teaching methods competency was assessed with written and practical post training assessments staff from pakistan were unable to attend because of visa issues and they were therefore trained via skype conferencing no additional sonographers were recruited during the study period two ultrasound scans subsequent to the first trimester ultrasound were done for each participant the first between and weeks gestation and the second between and weeks gestation both coinciding with routine amanhi visits after study initiation the gestational age windows were extended to weeks and weeks to cover a wider range of the third trimester however only the pemba site received ethics approval for this extension before study completion at every ultrasound visit sonographers followed standardised procedures to obtain high quality measurements of the biparietal diameter head circumference abdominal circumference femur length and tcd appendix p sonographers were masked to the gold standard gestational age established by crl measurements ultrasound biometry measurements were obtained without the use of an automated biometry software package so that only absolute measurements were taken two measurements for each biometric parameter were obtained and averaged plausible measurement ranges were defined for each parameter before the analysis crl mm biparietal diameter cm head circumference cm femur length cm abdominal circumference cm and tcd cm for measures outside of these ranges data were checked for data entry errors and were assigned as missing if unresolved gestational age was calculated from each individual biometric parameter by use of standard tables hadlock and colleagues for biparietal diameter femur length and abdominal circumference chavez and colleagues for tcd and intergrowth st project for head circumference gestational age was also calculated by use of previously published formulas that combine more than one parameter hadlock and colleagues and intergrowth st project formulas and the reasonable ranges for individual parameters are detailed in the appendix p an image quality checklist provided objective guidance on appropriate image magnification ideal image plane and correct calliper placement all study images were reviewed by bjw who was masked to the gold standard gestational age values for ongoing quality control with quarterly feedback to the sonographers infants were visited within h of birth birthweights were obtained by use of digital scales small for gestational age was defined as less than of the standard birthweight for the infant s gestational age and sex according to the intergrowth st project newborn baby reference standards statistical analysis study sample size was calculated on the basis of our hypothesis that the gestational age agreement between tcd and crl would be higher than the agreement between standard biometry and crl both among infants with appropriate for gestational age birthweights and among those with small for gestational age birthweights previously published literature and professional society guidelines have shown that late pregnancy biometry combination formulas have a gestational age accuracy of within days of the gold standard first trimester crl measurements by use of overlapping bland altman plots to compare the degree of agreement between tcd versus crl with standard biometry versus crl a sample size of would be adequate to show a mean difference of and limits of agreement loa of within days tcd vs crl versus within days standard biometry vs crl of the crl estimated gestational age we aimed to enrol a minimum of infants with small for gestational age birthweights per site assuming that of infants would be small for gestational age and that of pregnant women would be lost to follow up at delivery we required infants per site therefore we had a conservative target of enrolling participants per study site the stata software programme statacorp stata statistical software release college station tx usa was used for all statistical analyses bland altman plots were used to assess the agreement between gestational age measured by gold standard crl and gestational age measured by late pregnancy ultrasound biometric parameters mean differences bias with cis and loa values were calculated for each comparison for ease of comparison an approximation of the degree of agreement was calculated as the midpoint between the unsigned loa values as an example if the loa was to days the approximation of agreement would be within days of the gestational age as determined by the gold standard first trimester crl measurement for individual biometric parameters or combinations of parameters with bias ie if the ci of the mean difference does not include the gestational age window agreement limits would be skewed in the direction of the bias for infants with available birthweights we stratified the results by infant size to compare the accuracy of late pregnancy biometry measures among infants with appropriate for gestational age birthweights and small for gestational age birthweights statistical modelling was used to develop novel equations to predict gestational age with late pregnancy biometric parameters as covariates generalised linear regression was done by use of the stata glm command accounting for clustering of multiple visits for a participant gold standard gestational age determination by crl measurement was the dependent variable covariates tested in the models included all late pregnancy biometric parameters measured biparietal diameter head circumference femur length abdominal circumference and tcd natural logarithms were used to transform continuous measures given non normal distributions models with individual and combinations of biometric parameters were tested given the performance of tcd as an individual parameter models including tcd as the main predictor were examined adding additional biometric parameters assessing for significance ie if the p value was and improvement in the adjusted r and determining the best fit model according to the akaike information criterion potential models were cross validated to compare the predictive accuracy of the different models and select biometric parameters to be included in the final model two methods were used to cross validate the models in the first method the study dataset was divided into five random subsamples one subsample was withheld and statistical models were generated with the remaining of the data the model was then used to predict gestational age in the withheld subsample and a standardised error term was calculated on the basis of the predicted gestational age calculated as observed gestational age predicted gestational age predicted gestational age this process was repeated with each successive withheld subsample and a summary measure of the prediction error was generated for the entire dataset the model with the lowest prediction error was selected as the final model in the second cross validation method the data from one study site were withheld and statistical models were generated with data from the remaining two sites the model was then fit and used to predict gestational age in the first site that had the data withheld this process was repeated twice and the standardised error was calculated role of the funding source the funder of the study had no role in the study design data collection data analysis data interpretation or writing of the report results between feb and jan pregnant women in three of the five amanhi study sites bangladesh pakistan and tanzania with documented crl assessments between and weeks gestation were enrolled in this late pregnancy ultrasound study of these women completed late pregnancy scans data from nine infants were excluded from the final analysis because of implausible dates that could not be reconciled eg date of birth before date of ultrasound or year of ultrasound or birth recorded incorrectly we determined a priori that a difference of greater than days between the gold standard crl measurement of gestational age and the gestational age predicted by late pregnancy biometry measurements was considered to be implausibly associated with the performance of the ultrasound three such extreme outliers were excluded at weeks gestation and an additional three were excluded at weeks gestation the final analysis included unique mothers of whom underwent an ultrasound scan between and weeks gestation in bangladesh in pakistan and in tanzania and underwent an ultrasound scan between and weeks gestation in bangladesh in pakistan and in tanzania figure figure thumbnail gr figure participant flowchart by ultrasound visit show full caption view large imagefigure viewerdownload hi res imagedownload ppt more than of all attempts at biometric measurements were successful of the ultrasound scans done at weeks gestation values for the biparietal diameter were missing in two scans for head circumference in three scans for femur length in two scans for abdominal circumference in three scans and for tcd in three scans of the ultrasound scans done at weeks gestation missing values for the different parameters were similar to the ultrasound scan at weeks gestation with two values missing for biparietal diameter two for head circumference none for femur length and eight for abdominal circumference even at weeks gestation tcd measurements were successfully obtained from of ultrasound scans summary measures from the individual biometric parameters mean and sd for the cohort and by site are included in the appendix p using the reference nomogram for crl by hadlock and colleagues as an alternative to the intergrowth st project nomogram no significant differences in the distribution of gestational ages estimated from either third trimester ultrasound scan were observed data not shown from the ultrasound scans done at weeks gestation the performance of individual biometric parameters showed fairly similar agreement with gold standard crl measurements approximations ranging from to days of the standard crl measurements table there was little bias as evidenced by a mean difference close to zero for all parameters a representative bland altman plot for tcd versus crl is presented in figure table degree of agreement between late pregnancy ultrasound and gold standard first trimester crown rump length measurement of gestational age ultrasound scan at weeks gestation n ultrasound scan at weeks gestation n mean difference in days ci limits of agreement in days approximation in days mean difference in days ci limits of agreement in days approximation in days individual parameters tcd to to to to bpd to to to to hc to to to to fl to to to to ac to to to to combination formulas hadlock to to to to intergrowth st project to to to to amanhi parsimonious formula to to to to the hadlock formula includes bpd ac and fl measurements intergrowth st project formula includes hc and fl measurements and the amanhi parsimonious method includes tcd and fl measurements tcd transcerebellar diameter bpd biparietal diameter hc head circumference fl femur length ac abdominal circumference amanhi alliance for maternal and newborn health improvement approximation refers to the midpoint between the unsigned limits of agreement and values represent the number of days plus or minus the gold standard first trimester crown rump length measurement of gestational age for biometric parameters or combinations with bias ie if the ci of the mean difference does not include the true value of gestational age compared with the estimated value from third trimester biometry will be skewed in the direction of the bias mean difference open table in a new tab figure thumbnail gr figure bland altman plots comparing agreement of gestational age days determied by tcd measurements with first trimester crl measurements at weeks gestation a and weeks gestation b by study site show full caption view large imagefigure viewerdownload hi res imagedownload ppt from the ultrasound scans done at weeks gestation tcd had narrower loa than the other individual biometric parameters table the agreement between tcd and gold standard crl measurements was approximated to be within days of the crl measurement with little bias mean difference days ci compared with tcd the remaining individual parameters showed less agreement with crl measurements approximations ranged between days a strong negative bias for biparietal diameter days ci to femur length days to and abdominal circumference days to was observed suggesting a systematic underestimation of gestational age by approximately week from the ultrasound scan at weeks gestation the hadlock and intergrowth st project combination formulas outperformed individual parameters by a few days approximations ranged between days and maintained little bias table from the ultrasound scan at weeks gestation tcd alone approximation days showed a similar degree of agreement to crl measurements as the hadlock formula approximation days and slightly narrower agreement with crl measurements than the intergrowth st project formula approximation days notably the hadlock formula had a strong negative bias mean difference days ci to results did not vary substantially by site data not shown and have been presented together stratification of results by infant size was done in women who were less than weeks pregnant when they gave birth with birthweights available and included of women who had an ultrasound scan at weeks gestation of women who had an ultrasound scan at weeks gestation and of all unique infants for whom the birthweights were known of the unique infants were classified as small for gestational age the prevalence of infants who were small for gestational age varied by site and was higher in asian sites of infants in bangladesh and of infants in pakistan than in the african sites of infants in tanzania tcd outperformed the other biometric parameters in predicting gestational age and showed less negative bias ie less underestimation with loa values that were similar at the week and week scans in infants who had appropriate for gestational age birthweights and small for gestational age birthweights table hadlock and intergrowth st project combination formulas had slightly narrower loa values than individual parameters at the week scan in infants who were small for gestational age table although the hadlock formula had substantial negative bias days ci to at the week scan tcd had a similar loa to the combination formulas for infants who were small for gestational age approximation days but with less bias mean difference days than both the hadlock days and intergrowth st project formulas days table table performance of late pregnancy ultrasound in estimating the gestational age of infants with small for gestational age or appropriate for gestational age birthweights birthweight appropriate for gestational age birthweight small for gestational age mean difference in days ci limits of agreement in days approximation in days mean difference in days ci limits of agreement in days approximation in days weeks gestation tcd to to to to bpd to to to to hc to to to to fl to to to to ac to to to to hadlock to to to to intergrowth st project to to to to amanhi parsimonious formula to to to to weeks gestation tcd to to to to bpd to to to to hc to to to to fl to to to to ac to to to to hadlock to to to to intergrowth st project to to to to amanhi parsimonious formula to to to to the hadlock formula includes bpd ac and fl measurements intergrowth st project formula includes hc and fl measurements and the amanhi parsimonious method includes tcd and fl measurements tcd transcerebellar diameter bpd biparietal diameter hc head circumference fl femur length ac abdominal circumference amanhi alliance for maternal and newborn health improvement approximation refers to the midpoint between the unsigned limits of agreement and values represent the number of days plus or minus the gold standard first trimester crown rump length measurement of gestational age for biometric parameters or combinations with bias ie if the ci of the mean difference does not include the true value of gestational age compared with the estimated value from third trimester biometry will be skewed in the direction of the bias mean difference open table in a new tab the four statistical models generated from the amanhi late pregnancy dating study are shown in table model was the most accurate in predicting gestational age and included four biometric parameters model included only tcd and femur length and showed the least prediction error among the three more parsimonious models combining only two parameters after both cross validation approaches were applied appendix p table performance of newly derived alliance for maternal and newborn health improvement combination formulas for determining gestational age after weeks gestation weeks gestation weeks gestation mean difference in days ci limits of agreement in days approximation in days mean difference in days ci limits of agreement in days approximation in days model lntcd lnbpd lnfl and lnac to to to to model lntcd and lnfl to to to to model lntcd and lnbpd to to to to model lntcd and lnac to to to to tcd transcerebellar diameter bpd biparietal diameter fl femur length ac abdominal circumference hc head circumference approximation refers to the midpoint between the unsigned limits of agreement and values represent the number of days plus or minus the gold standard first trimester crown rump length measurement of gestational age for biometric parameters or combinations with bias ie if the ci of the mean difference does not include the true value of gestational age compared with the estimated value from third trimester biometry will be skewed in the direction of the bias mean difference model is the complete alliance for maternal and newborn health improvement model models evaluate combinations of fewer biometric parameters with model chosen as the alliance for maternal and newborn health improvement parsimonious model open table in a new tab the final model was fit by including tcd and femur length in a regression with the entire dataset model table formula in appendix p the prediction error appendix p is on the final model involving the entire cohort data formulas for all candidate models and their out of model prediction errors are shown in the appendix p from the ultrasound scan at weeks gestation our novel amanhi combination formula combining tcd and femur length measurements showed little improvement in the accuracy of estimating gestational age when infants were stratified by birthweight appropriate for gestational age or small for gestational age compared with previous combination formulas improving estimations by only day table however from the ultrasound scan at weeks gestation the amanhi combination formula could more accurately predict gestational age for appropriate for gestational age infants and small for gestational age infants compared with the intergrowth st project combination formula narrowing the loa to approximately weeks and with minimal bias table discussion we have identified several key findings regarding the performance of ultrasound biometry in late pregnancy in a large cohort of pregnant women in three lmic settings first it was reassuring to verify that the accuracy of late pregnancy ultrasound for estimating gestational age in our study was similar to the reported results from higher income settings where sonographer training is lengthier and includes more practical training compared with sonographer training in lmic settings biometric parameters at weeks gestation and weeks gestation alone and in combination were accurate to within approximately weeks of the gold standard crl measurement of gestational age these results are consistent with previous reports of the performance of late pregnancy biometric parameters in our study the accuracy of gestational age dating with individual biometric parameters before weeks was reasonably good approximation days to days of the standard crl measurements improving even further approximation days when individual biometric parameters were combined according to previously published formulas later scans weeks had wider individual loas approximation days as hypothesised the tcd as a single biometric parameter had the narrowest loa approximation days and even outperformed the combination formulas slightly approximation days importantly tcd also performed quite well among infants who were ultimately born small for gestational age with an accuracy of approximately days of the crl measurement of gestational age at weeks and approximately days of the crl measurement at weeks with little bias mean difference of days at both gestational age windows in summary nomograms established for measuring cerebellar size in high resource settings appear to perform well in this lmic population given the initial results showing successful performance of tcd in estimating gestational age we combined tcd with standard biometric parameters and used statistical modelling to investigate the performance of different combination formulas in the lmic study sites where the prevalence of infants born small for gestational age is high our first model combining tcd with biparietal diameter femur length and abdominal circumference narrowed the loa across the two third trimester gestational age windows to less than weeks a second parsimonious model combining only tcd and femur length performed nearly as well as the first model with the added benefit of simplicity in the number of parameters included both the femur and the cerebellum are structures that are fairly easy to identify in addition the measurements of these parameters are linear and therefore require less skill in calliper placement than circumference measurements as evidenced by the observation that these measurements were obtained successfully in of ultrasound scans in our study when compared with other published combination formulas our amanhi parsimonious model formula had the narrowest loa the least bias and performed similarly among infants born appropriate for gestational age and small for gestational age in both gestational age windows as the amanhi formulas were derived from our study population it is not surprising that they performed well even after attempting to separate model development and validation through cross validation exercises our gestational age formulas should therefore be viewed as hypothesis generating and they should be validated in other lmic populations before they are used extensively it is important to emphasise that our study included an unselected and population based cohort from three lmics at the time of enrolment the cohort therefore reflects the range of morbidities associated with pregnancy maternal nutritional status and fetal sizes that would be encountered by a health care practitioner in similar settings our cohort contrasts those used in previous studies such as the intergrowth st project cohort that were designed to measure optimal fetal growth and enrolled only healthy low risk women who were less likely to carry a growth restricted fetus these differences might help to explain why our amanhi parsimonious model outperformed both the hadlock and intergrowth st project formulas among infants who were born small for gestational age even at weeks gestation the loa of our amanhi parsimonious formula was still within days of the crl measurement of gestational age and it performed similarly among infants born with small for gestational age approximation days or appropriate for gestational age approximation days birthweights an estimation of gestational age to within approximately weeks of the standard crl measurement is a remarkable achievement for lmic settings as many women do not have an ultrasonography in the first half of pregnancy if intrauterine growth restriction is suspected measurement of cerebellar size in the third trimester could help to confirm that this is the case our study has several strengths including its large sample size and the determination of gestational age by use of gold standard first trimester crl measurements that were verified by a multilayered quality control process nonetheless there are some limitations of our study we did not evaluate the feasibility of obtaining cerebellum measurements after weeks gestation with advancing gestation shadowing from the calcified skull might preclude the accurate measurement of the tcd margins limiting its use as the pregnancy nears full term the results shown in figure suggest that accurate tcd measurements might be more difficult to obtain as the pregnancy advances as several individual data points fell below the lower loa rather than the upper loa at the week gestational age window this underestimation of gestational age by tcd in this gestational age window could reflect difficulties in measuring the full size of the cerebellar hemispheres in summary if validated in other lmic populations our novel parsimonious model for estimating gestational age in late pregnancy could be useful for research public health surveillance and clinical care our study findings might be clinically relevant for health care providers tasked with determining whether a fetus is small rather than preterm and thus might limit iatrogenic harm from unnecessary preterm delivery two important messages can be concluded from our work first cerebellar measurements using previously established nomograms from high resource settings are a useful adjunct to late pregnancy biometry measurements in lmics where the burden of infants born small for gestational age is high secondly if validated in other lmic populations a parsimonious gestational age formula requiring measurement of only two biometric parameters might narrow accuracy of late pregnancy ultrasound to within approximately weeks contributors this manuscript is the product of the who alliance for maternal and newborn health improvement late pregnancy dating study group bjw rb acl ahb fj and ss acquired funding designed the study developed the protocols and were involved in implementing the study bjw and mn led the ultrasound training and standardisation and provided ongoing ultrasound quality control fj im acl ahb sd ss ud and sa supervised patient enrolment provided oversight of daily study activities and were involved in leading the collection and management of data the daily collection and management of data was done by sb ah sj fk mk um smm and mr ra ni and nn were responsible for daily ultrasound activities and local quality control data was initially analysed and interpreted by bjw acl in sd les mi and rw with additional data interpretation done by rb ahb fj and ss bjw acl les and rb drafted the initial manuscript which was further edited reviewed revised and approved by all authors bjw and rb had full access to all of the data and the final responsibility to submit the manuscript for publication additional study members who had access to the raw data included acl in sd les mi and rw alliance for maternal and newborn health improvement study group members tanzania team collaborators tanzania saikat deb mohammed said mohammed said mohammed ali mohammed hamad juma massoud juma hassan public health laboratory ivo de carneri pemba india saikat deb usha dhingra arup dutta pratibha dixit sunil sazawal centre for public health kinetics new delhi pakistan team collaborators pakistan imran nisar muhammad ilyas usma mehmood farzana kausar shamim jaweed muhammad karim atiya hussain naila nadeem fyezah jehan aga khan university karachi bangladesh team collaborators bangladesh sayedur rahman nasreen islam ruksana azad syed mamun ibne moin salahuddin ahmed johns hopkins university bangladesh dhaka mahmoodur rahman abdul quiayum maternal and child health division international center for diarrheal disease research dhaka usa rasheda khanam abdullah h baqui department of international health johns hopkins bloomberg school of public health baltimore md coordinating team switzerland sachiyo yoshida alexander manu rajiv bahl who geneva usa anne cc lee brigham and women s hospital harvard medical school boston ma lauren e schaeffer rachel whelan brigham and women s hospital boston ma mariam naqvi ceders sinai medical center los angeles ca blair j wylie department of obstetrics and gynecology beth israel deaconess medical center boston ma harvard medical school boston ma declaration of interests ud ss fj aq ra sr mr smm ni am mn les acl and bw report grants from the bill melinda gates foundation during the conduct of the study all other authors declare no competing interests acknowledgments this study was funded by the bill melinda gates foundation opp the funder had no role in study design data collection data analysis data interpretation or writing of the report bjw received funding from the national institutes of health nih k es f d in also received funding from fogarty international centre and nih d tw acl received funding from the national institute of child health and human development k hd the results of the study were presented at the annual meeting of the society for maternal fetal medicine february in dallas tx usa we are particularly grateful to the women who participated in the study and to all research staff across the three study sites who made the project possible invensense inc borregas ave sunnyvale ca u s a tel fax website www invensense com document number ps mpu a revision release date of mpu and mpu product specification revision mpu mpu product specification document number ps mpu a revision release date of contents revision history purpose and scope product overview mpu x o verview applications features g yroscope f eatures a ccelerometer f eatures a dditional f eatures m otion p rocessing c locking electrical characteristics g yroscope s pecifications a ccelerometer s pecifications e lectrical and o ther c ommon s pecifications e lectrical s pecifications c ontinued e lectrical s pecifications c ontinued e lectrical s pecifications c ontinued i c t iming c haracterization spi t iming c haracterization mpu only a bsolute m aximum r atings applications information p in o ut and s ignal d escription t ypical o perating c ircuit b ill of m aterials for e xternal c omponents r ecommended p ower on p rocedure b lock d iagram o verview t hree a xis mems g yroscope with bit adc s and s ignal c onditioning t hree a xis mems a ccelerometer with bit adc s and s ignal c onditioning d igital m otion p rocessor p rimary i c and spi s erial c ommunications i nterfaces a uxiliary i c s erial i nterface mpu mpu product specification document number ps mpu a revision release date of s elf t est mpu x s olution for axis s ensor f usion u sing i c i nterface mpu u sing spi i nterface i nternal c lock g eneration s ensor d ata r egisters fifo i nterrupts d igital o utput t emperature s ensor b ias and ldo c harge p ump programmable interrupts digital interface i c and spi mpu only s erial i nterfaces i c i nterface i c c ommunications p rotocol i c t erms spi i nterface mpu only serial interface considerations mpu mpu s upported i nterfaces l ogic l evels l ogic l evels d iagram for aux vddio assembly o rientation of a xes p ackage d imensions pcb d esign g uidelines a ssembly p recautions s torage s pecifications p ackage m arking s pecification t ape r eel s pecification l abel p ackaging r epresentative s hipping c arton l abel reliability q ualification t est p olicy mpu mpu product specification document number ps mpu a revision release date of q ualification t est p lan environmental compliance mpu mpu product specification document number ps mpu a revision release date of revision history revision date revision description initial release for rev c parts clarified wording in sections edited supply current numbers for different modes section unit of measure for accelerometer sensitivity changed from lsb mg to lsb g updated accelerometer self test specifications in table updated package dimensions section updated pcb design guidelines section for rev d parts updated accelerometer specifications in table updated accelerometer specification note sections updated qualification test plan section edits for clarity changed operating voltage range to v v added accelerometer intelligence function increment value of mg lsb section updated absolute maximum rating for acceleration any axis unpowered from ms to ms section modified absolute maximum rating for latch up to level a and ma section updated self test response specifications for revision d parts dated with date code yyww or later edits for clarity added gyro self test sections added min max limits to accel self test response section updated accelerometer low power mode operating currents section added gyro self test to block diagram section updated packaging labels and descriptions sections updated gyro and accelerometer self test information sections updated latch up information section updated programmable interrupts information section changed shipment information from maximum of reels k units per shipper box to reels k units per shipper box section updated packing shipping and label information sections updated reliability references section updates section mpu mpu product specification document number ps mpu a revision release date of purpose and scope this product specification provides advanced information regarding the electrical specification and design related information for the mpu and mpu motiontracking devices collectively called the mpu x or mpu electrical characteristics are based upon design analysis and simulation results only specifications are subject to change without notice final specifications will be updated based upon characterization of production silicon for references to register map and descriptions of individual registers please refer to the mpu mpu register map and register descriptions document the self test response specifications provided in this document pertain to revision d parts with date codes of yyww or later please see section for package marking description details mpu mpu product specification document number ps mpu a revision release date of product overview mpu x overview motioninterface is becoming a must have function being adopted by smartphone and tablet manufacturers due to the enormous value it adds to the end user experience in smartphones it finds use in applications such as gesture commands for applications and phone control enhanced gaming augmented reality panoramic photo capture and viewing and pedestrian and vehicle navigation with its ability to precisely and accurately track user motions motiontracking technology can convert handsets and tablets into powerful d intelligent devices that can be used in applications ranging from health and fitness monitoring to location based services key requirements for motioninterface enabled devices are small package size low power consumption high accuracy and repeatability high shock tolerance and application specific performance programmability all at a low consumer price point the mpu x is the world s first integrated axis motiontracking device that combines a axis gyroscope axis accelerometer and a digital motion processor dmp all in a small x x mm package with its dedicated i c sensor bus it directly accepts inputs from an external axis compass to provide a complete axis motionfusion output the mpu x motiontracking device with its axis integration on board motionfusion and run time calibration firmware enables manufacturers to eliminate the costly and complex selection qualification and system level integration of discrete devices guaranteeing optimal motion performance for consumers the mpu x is also designed to interface with multiple non inertial digital sensors such as pressure sensors on its auxiliary i c port the mpu x is footprint compatible with the mpu x family the mpu x features three bit analog to digital converters adcs for digitizing the gyroscope outputs and three bit adcs for digitizing the accelerometer outputs for precision tracking of both fast and slow motions the parts feature a user programmable gyroscope full scale range of and sec dps and a user programmable accelerometer full scale range of g g g and g an on chip byte fifo buffer helps lower system power consumption by allowing the system processor to read the sensor data in bursts and then enter a low power mode as the mpu collects more data with all the necessary on chip processing and sensor components required to support many motion based use cases the mpu x uniquely enables low power motioninterface applications in portable applications with reduced processing requirements for the system processor by providing an integrated motionfusion output the dmp in the mpu x offloads the intensive motionprocessing computation requirements from the system processor minimizing the need for frequent polling of the motion sensor output communication with all registers of the device is performed using either i c at khz or spi at mhz mpu only for applications requiring faster communications the sensor and interrupt registers may be read using spi at mhz mpu only additional features include an embedded temperature sensor and an on chip oscillator with variation over the operating temperature range by leveraging its patented and volume proven nasiri fabrication platform which integrates mems wafers with companion cmos electronics through wafer level bonding invensense has driven the mpu x package size down to a revolutionary footprint of x x mm qfn while providing the highest performance lowest noise and the lowest cost semiconductor packaging required for handheld consumer electronic devices the part features a robust g shock tolerance and has programmable low pass filters for the gyroscopes accelerometers and the on chip temperature sensor for power supply flexibility the mpu x operates from vdd power supply voltage range of v v additionally the mpu provides a vlogic reference pin in addition to its analog supply pin vdd which sets the logic levels of its i c interface the vlogic voltage may be v or vdd the mpu and mpu are identical except that the mpu supports the i c serial interface only and has a separate vlogic reference pin the mpu supports both i c and spi interfaces and has a single supply pin vdd which is both the device s logic reference supply and the analog supply for the part the table below outlines these differences mpu mpu product specification document number ps mpu a revision release date of primary differences between mpu and mpu part item mpu mpu vdd v v v v vlogic n a v to vdd serial interfaces supported i c spi i c pin cs vlogic pin ad sdo ad pin scl sclk scl pin sda sdi sda mpu mpu product specification document number ps mpu a revision release date of applications blurfree technology for video still image stabilization airsign technology for security authentication touchanywhere technology for no touch ui application control navigation motioncommand technology for gesture short cuts motion enabled game and application framework instantgesture ig gesture recognition location based services points of interest and dead reckoning handset and portable gaming motion based game controllers d remote controls for internet connected dtvs and set top boxes d mice wearable sensors for health fitness and sports toys mpu mpu product specification document number ps mpu a revision release date of features gyroscope features the triple axis mems gyroscope in the mpu x includes a wide range of features digital output x y and z axis angular rate sensors gyroscopes with a user programmable full scale range of and sec external sync signal connected to the fsync pin supports image video and gps synchronization integrated bit adcs enable simultaneous sampling of gyros enhanced bias and sensitivity temperature stability reduces the need for user calibration improved low frequency noise performance digitally programmable low pass filter gyroscope operating current ma standby current a factory calibrated sensitivity scale factor user self test accelerometer features the triple axis mems accelerometer in mpu x includes a wide range of features digital output triple axis accelerometer with a programmable full scale range of g g g and g integrated bit adcs enable simultaneous sampling of accelerometers while requiring no external multiplexer accelerometer normal operating current a low power accelerometer mode current a at hz a at hz a at hz a at hz orientation detection and signaling tap detection user programmable interrupts high g interrupt user self test additional features the mpu x includes the following additional features axis motionfusion by the on chip digital motion processor dmp auxiliary master i c bus for reading data from external sensors e g magnetometer ma operating current when all motion sensing axes and the dmp are enabled vdd supply voltage range of v v flexible vlogic reference voltage supports multiple i c interface voltages mpu only smallest and thinnest qfn package for portable devices x x mm minimal cross axis sensitivity between the accelerometer and gyroscope axes byte fifo buffer reduces power consumption by allowing host processor to read the data in bursts and then go into a low power mode as the mpu collects more data digital output temperature sensor user programmable digital filters for gyroscope accelerometer and temp sensor g shock tolerant khz fast mode i c for communicating with all registers mhz spi serial interface for communicating with all registers mpu only mhz spi serial interface for reading sensor and interrupt registers mpu only mpu mpu product specification document number ps mpu a revision release date of mems structure hermetically sealed and bonded at wafer level rohs and green compliant motionprocessing internal digital motion processing dmp engine supports d motionprocessing and gesture recognition algorithms the mpu x collects gyroscope and accelerometer data while synchronizing data sampling at a user defined rate the total dataset obtained by the mpu x includes axis gyroscope data axis accelerometer data and temperature data the mpu s calculated output to the system processor can also include heading data from a digital axis third party magnetometer the fifo buffers the complete data set reducing timing requirements on the system processor by allowing the processor burst read the fifo data after burst reading the fifo data the system processor can save power by entering a low power sleep mode while the mpu collects more data programmable interrupt supports features such as gesture recognition panning zooming scrolling tap detection and shake detection digitally programmable low pass filters low power pedometer functionality allows the host processor to sleep while the dmp maintains the step count clocking on chip timing generator frequency variation over full temperature range optional external clock inputs of khz or mhz mpu mpu product specification document number ps mpu a revision release date of electrical characteristics gyroscope specifications vdd v v vlogic mpu only v or vdd t a c parameter conditions min typ max units notes gyroscope sensitivity full scale range fs sel s fs sel s fs sel s fs sel s gyroscope adc word length bits sensitivity scale factor fs sel lsb s fs sel lsb s fs sel lsb s fs sel lsb s sensitivity scale factor tolerance c sensitivity scale factor variation over temperature nonlinearity best fit straight line c cross axis sensitivity gyroscope zero rate output zro initial zro tolerance c s zro variation over temperature c to c s power supply sensitivity hz sine wave mvpp vdd v s power supply sensitivity hz sine wave mvpp vdd v s power supply sensitivity hz khz sine wave mvpp vdd v s linear acceleration sensitivity static s g self test response relative change from factory trim gyroscope noise performance fs sel total rms noise dlpfcfg hz s rms low frequency rms noise bandwidth hz to hz s rms rate noise spectral density at hz s hz gyroscope mechanical frequencies x axis khz y axis khz z axis khz low pass filter response programmable range hz output data rate programmable hz gyroscope start up time dlpfcfg zro settling from power on to s of final ms please refer to the following document for further information on self test mpu mpu register map and descriptions mpu mpu product specification document number ps mpu a revision release date of accelerometer specifications vdd v v vlogic mpu only v or vdd t a c parameter conditions min typ max units notes accelerometer sensitivity full scale range afs sel g afs sel g afs sel g afs sel g adc word length output in two s complement format bits sensitivity scale factor afs sel lsb g afs sel lsb g afs sel lsb g afs sel lsb g initial calibration tolerance sensitivity change vs temperature afs sel c to c c nonlinearity best fit straight line cross axis sensitivity zero g output initial calibration tolerance x and y axes mg z axis mg zero g level change vs temperature x and y axes c to c z axis c to c mg self test response relative change from factory trim noise performance power spectral density hz afs sel odr khz g hz low pass filter response programmable range hz output data rate programmable range hz intelligence function increment mg lsb typical zero g initial calibration tolerance value after msl preconditioning please refer to the following document for further information on self test mpu mpu register map and descriptions mpu mpu product specification document number ps mpu a revision release date of electrical and other common specifications vdd v v vlogic mpu only v or vdd t a c parameter conditions min typ max units notes temperature sensor range to c sensitivity untrimmed lsb c temperature offset o c lsb linearity best fit straight line c to c c vdd power supply operating voltages v normal operating current gyroscope accelerometer dmp ma gyroscope accelerometer dmp disabled ma gyroscope dmp accelerometer disabled ma gyroscope only dmp accelerometer disabled ma accelerometer only dmp gyroscope disabled a accelerometer low power mode current hz update rate a hz update rate a hz update rate a hz update rate a full chip idle mode supply current a power supply ramp rate monotonic ramp ramp rate is to of the final value ms vlogic reference voltage mpu only voltage range vlogic must be vdd at all times vdd v power supply ramp rate monotonic ramp ramp rate is to of the final value ms normal operating current a temperature range specified temperature range performance parameters are not applicable beyond specified temperature range c mpu mpu product specification document number ps mpu a revision release date of electrical specifications continued vdd v v vlogic mpu only v or vdd t a c parameter conditions min typ max units notes serial interface spi operating frequency all registers read write mpu only low speed characterization khz mpu only high speed characterization mhz spi operating frequency sensor and interrupt registers read only mpu only mhz i c operating frequency all registers fast mode khz all registers standard mode khz i c address ad ad digital inputs sdi sda ad sclk scl fsync cs clkin v ih high level input voltage mpu vdd v mpu vlogic v v il low level input voltage mpu vdd v mpu vlogic v c i input capacitance pf digital output sdo int v oh high level output voltage r load m mpu vdd v r load m mpu vlogic v v ol low level output voltage r load m mpu vdd v r load m mpu vlogic v v ol int int low level output voltage open ma sink current v output leakage current open na t int int pulse width latch int en s mpu mpu product specification document number ps mpu a revision release date of electrical specifications continued typical operating circuit of section vdd v v vlogic mpu only v or vdd t a c parameters conditions typical units notes primary i c i o scl sda v il low level input voltage mpu to vdd v v ih high level input voltage mpu vdd to vdd v v v hys hysteresis mpu vdd v vil low level input voltage mpu v to vlogic v vih high level input voltage mpu vlogic to vlogic v v vhys hysteresis mpu vlogic v v ol low level output voltage ma sink current to v i ol low level output current v ol v ma v ol v ma output leakage current na t of output fall time from v ihmax to v ilmax c b bus capacitance in pf c b to ns c i capacitance for each i o pin pf auxiliary i c i o aux cl aux da mpu aux vddio v il low level input voltage v to vlogic v v ih high level input voltage vlogic to vlogic v v v hys hysteresis vlogic v v ol low level output voltage vlogic v ma sink current to v v ol low level output voltage vlogic v ma sink current to vlogic v i ol low level output current v ol v v ol v ma ma output leakage current na t of output fall time from v ihmax to v ilmax c b bus capacitance in pf c b to ns c i capacitance for each i o pin pf mpu mpu product specification document number ps mpu a revision release date of electrical specifications continued typical operating circuit of section vdd v v vlogic mpu only v or vdd t a c parameters conditions min typical max units notes internal clock source clk sel gyroscope sample rate fast dlpfcfg sampleratediv khz gyroscope sample rate slow dlpfcfg or sampleratediv khz accelerometer sample rate khz clock frequency initial tolerance clk sel c clk sel c frequency variation over temperature clk sel to clk sel pll settling time clk sel ms external khz clock clk sel external clock frequency khz external clock allowable jitter cycle to cycle rms to s gyroscope sample rate fast dlpfcfg sampleratediv khz gyroscope sample rate slow dlpfcfg or sampleratediv khz accelerometer sample rate khz pll settling time ms external mhz clock clk sel external clock frequency mhz gyroscope sample rate full programmable range hz gyroscope sample rate fast mode dlpfcfg sampleratediv khz gyroscope sample rate slow mode dlpfcfg or sampleratediv khz accelerometer sample rate khz pll settling time ms mpu mpu product specification document number ps mpu a revision release date of i c timing characterization typical operating circuit of section vdd v v vlogic mpu only v or vdd t a c parameters conditions min typical max units notes i c timing i c fast mode f scl scl clock frequency khz t hd sta repeated start condition hold time s t low scl low period s t high scl high period s t su sta repeated start condition setup time s t hd dat sda data hold time s t su dat sda data setup time ns t r sda and scl rise time c b bus cap from to pf c b ns t f sda and scl fall time c b bus cap from to pf c b ns t su sto stop condition setup time s t buf bus free time between stop and start condition s c b capacitive load for each bus line pf t vd dat data valid time s t vd ack data valid acknowledge time s note timing characteristics apply to both primary and auxiliary i c bus i c bus timing diagram mpu mpu product specification document number ps mpu a revision release date of spi timing characterization mpu only typical operating circuit of section vdd v v vlogic mpu only v or vdd t a c unless otherwise noted parameters conditions min typical max units notes spi timing f sclk sclk clock frequency mhz t low sclk low period ns t high sclk high period ns t su cs cs setup time ns t hd cs cs hold time ns t su sdi sdi setup time ns t hd sdi sdi hold time ns t vd sdo sdo valid time c load pf ns t hd sdo sdo hold time c load pf ns t dis sdo sdo output disable time ns spi bus timing diagram mpu mpu product specification document number ps mpu a revision release date of absolute maximum ratings stress above those listed as absolute maximum ratings may cause permanent damage to the device these are stress ratings only and functional operation of the device at these conditions is not implied exposure to the absolute maximum ratings conditions for extended periods may affect device reliability parameter rating supply voltage vdd v to v vlogic input voltage level mpu v to vdd v regout v to v input voltage level clkin aux da ad fsync int scl sda v to vdd v cpout v vdd v v to v acceleration any axis unpowered g for ms operating temperature range c to c storage temperature range c to c electrostatic discharge esd protection kv hbm v mm latch up jedec class ii c ma mpu mpu product specification document number ps mpu a revision release date of applications information pin out and signal description pin number mpu mpu pin name pin description y y clkin optional external reference clock input connect to gnd if unused y y aux da i c master serial data for connecting to external sensors y y aux cl i c master serial clock for connecting to external sensors y cs spi chip select spi mode y vlogic digital i o supply voltage y ad sdo i c slave address lsb ad spi serial data output sdo y ad i c slave address lsb ad y y regout regulator filter capacitor connection y y fsync frame synchronization digital input connect to gnd if unused y y int interrupt digital output totem pole or open drain y y vdd power supply voltage and digital i o supply voltage y y gnd power supply ground y y resv reserved do not connect y y cpout charge pump capacitor connection y y resv reserved do not connect y scl sclk i c serial clock scl spi serial clock sclk y scl i c serial clock scl y sda sdi i c serial data sda spi serial data input sdi y sda i c serial data sda y y nc not internally connected may be used for pcb trace routing mpu mpu z x y aux cl vlogic ad regout fsync int nc nc nc vdd nc gnd nc nc nc aux da nc clkin resv cpout resv resv scl sda mpu qfn package pin mm x mm x mm orientation of axes of sensitivity and polarity of rotation top view z y x aux cl cs ad sdo regout fsync int nc nc nc vdd nc gnd nc nc nc aux da nc clkin resv cpout resv resv scl sclk sda sdi mpu qfn package pin mm x mm x mm top view mpu mpu product specification document number ps mpu a revision release date of typical operating circuit ad sdo typical operating circuits mpu clkin cs gnd gnd gnd fsync int gnd vdd scl sclk sda sdi c nf c f c f ad mpu clkin gnd gnd gnd fsync int gnd vdd scl sda c nf c f c f gnd vlogic c nf aux cl aux da aux cl aux da bill of materials for external components component label specification quantity regulator filter capacitor pin c ceramic x r f v vdd bypass capacitor pin c ceramic x r f v charge pump capacitor pin c ceramic x r nf v vlogic bypass capacitor pin c ceramic x r nf v mpu only mpu mpu product specification document number ps mpu a revision release date of recommended power on procedure t vlgr vlogic vdd t vddr all voltages at v power up sequencing vlogic amplitude must always be vdd amplitude t vddr is vdd rise time time for vdd to rise from to of its final value t vddr is ms t vlgr is vlogic rise time time for vlogic to rise from to of its final value t vlgr is ms t vlg vdd is the delay from the start of vdd ramp to the start of vlogic rise t vlg vdd is vdd and vlogic must be monotonic ramps t vlg vdd mpu mpu product specification document number ps mpu a revision release date of block diagram clock mpu x charge pump cs ad sdo scl sclk sda sdi temp sensor adc adc z gyro adc y gyro digital motion processor dmp fsync slave i c and spi serial interface master i c serial interface clock cpout serial interface bypass mux aux cl aux da int factory calibration interrupt status register vdd bias ldo gnd regout note pin names in round brackets apply only to mpu pin names in square brackets apply only to mpu z accel y accel x accel adc adc adc clkin clkout adc x gyro signal conditioning fifo config registers sensor registers self test vlogic self test self test self test self test self test overview the mpu x is comprised of the following key blocks and functions three axis mems rate gyroscope sensor with bit adcs and signal conditioning three axis mems accelerometer sensor with bit adcs and signal conditioning digital motion processor dmp engine primary i c and spi mpu only serial communications interfaces auxiliary i c serial interface for rd party magnetometer other sensors clocking sensor data registers fifo interrupts digital output temperature sensor gyroscope accelerometer self test bias and ldo charge pump mpu mpu product specification document number ps mpu a revision release date of three axis mems gyroscope with bit adcs and signal conditioning the mpu x consists of three independent vibratory mems rate gyroscopes which detect rotation about the x y and z axes when the gyros are rotated about any of the sense axes the coriolis effect causes a vibration that is detected by a capacitive pickoff the resulting signal is amplified demodulated and filtered to produce a voltage that is proportional to the angular rate this voltage is digitized using individual on chip bit analog to digital converters adcs to sample each axis the full scale range of the gyro sensors may be digitally programmed to or degrees per second dps the adc sample rate is programmable from samples per second down to samples per second and user selectable low pass filters enable a wide range of cut off frequencies three axis mems accelerometer with bit adcs and signal conditioning the mpu x s axis accelerometer uses separate proof masses for each axis acceleration along a particular axis induces displacement on the corresponding proof mass and capacitive sensors detect the displacement differentially the mpu x s architecture reduces the accelerometers susceptibility to fabrication variations as well as to thermal drift when the device is placed on a flat surface it will measure g on the x and y axes and g on the z axis the accelerometers scale factor is calibrated at the factory and is nominally independent of supply voltage each sensor has a dedicated sigma delta adc for providing digital outputs the full scale range of the digital output can be adjusted to g g g or g digital motion processor the embedded digital motion processor dmp is located within the mpu x and offloads computation of motion processing algorithms from the host processor the dmp acquires data from accelerometers gyroscopes and additional rd party sensors such as magnetometers and processes the data the resulting data can be read from the dmp s registers or can be buffered in a fifo the dmp has access to one of the mpu s external pins which can be used for generating interrupts the purpose of the dmp is to offload both timing requirements and processing power from the host processor typically motion processing algorithms should be run at a high rate often around hz in order to provide accurate results with low latency this is required even if the application updates at a much lower rate for example a low power user interface may update as slowly as hz but the motion processing should still run at hz the dmp can be used as a tool in order to minimize power simplify timing simplify the software architecture and save valuable mips on the host processor for use in the application primary i c and spi serial communications interfaces the mpu x communicates to a system processor using either a spi mpu only or an i c serial interface the mpu x always acts as a slave when communicating to the system processor the lsb of the of the i c slave address is set by pin ad the logic levels for communications between the mpu x and its master are as follows mpu the logic level for communications with the master is set by the voltage on vdd mpu the logic level for communications with the master is set by the voltage on vlogic for further information regarding the logic levels of the mpu please refer to section mpu mpu product specification document number ps mpu a revision release date of auxiliary i c serial interface the mpu x has an auxiliary i c bus for communicating to an off chip axis digital output magnetometer or other sensors this bus has two operating modes i c master mode the mpu x acts as a master to any external sensors connected to the auxiliary i c bus pass through mode the mpu x directly connects the primary and auxiliary i c buses together allowing the system processor to directly communicate with any external sensors auxiliary i c bus modes of operation i c master mode allows the mpu x to directly access the data registers of external digital sensors such as a magnetometer in this mode the mpu x directly obtains data from auxiliary sensors allowing the on chip dmp to generate sensor fusion data without intervention from the system applications processor for example in i c master mode the mpu x can be configured to perform burst reads returning the following data from a magnetometer x magnetometer data bytes y magnetometer data bytes z magnetometer data bytes the i c master can be configured to read up to bytes from up to auxiliary sensors a fifth sensor can be configured to work single byte read write mode pass through mode allows an external system processor to act as master and directly communicate to the external sensors connected to the auxiliary i c bus pins aux da and aux cl in this mode the auxiliary i c bus control logic rd party sensor interface block of the mpu x is disabled and the auxiliary i c pins aux da and aux cl pins and are connected to the main i c bus pins and through analog switches pass through mode is useful for configuring the external sensors or for keeping the mpu x in a low power mode when only the external sensors are used in pass through mode the system processor can still access mpu x data through the i c interface auxiliary i c bus io logic levels mpu the logic level of the auxiliary i c bus is vdd mpu the logic level of the auxiliary i c bus can be programmed to be either vdd or vlogic for further information regarding the mpu s logic levels please refer to section mpu mpu product specification document number ps mpu a revision release date of self test please refer to the mpu mpu register map and register descriptions document for more details on self test self test allows for the testing of the mechanical and electrical portions of the sensors the self test for each measurement axis can be activated by means of the gyroscope and accelerometer self test registers registers to when self test is activated the electronics cause the sensors to be actuated and produce an output signal the output signal is used to observe the self test response the self test response is defined as follows self test response sensor output with self test enabled sensor output without self test enabled the self test response for each accelerometer axis is defined in the accelerometer specification table section while that for each gyroscope axis is defined in the gyroscope specification table section when the value of the self test response is within the min max limits of the product specification the part has passed self test when the self test response exceeds the min max values the part is deemed to have failed self test code for operating self test code is included within the motionapps software provided by invensense mpu mpu product specification document number ps mpu a revision release date of mpu x solution for axis sensor fusion using i c interface in the figure below the system processor is an i c master to the mpu x in addition the mpu x is an i c master to the optional external compass sensor the mpu x has limited capabilities as an i c master and depends on the system processor to manage the initial configuration of any auxiliary sensors the mpu x has an interface bypass multiplexer which connects the system processor i c bus pins and sda and scl directly to the auxiliary sensor i c bus pins and aux da and aux cl once the auxiliary sensors have been configured by the system processor the interface bypass multiplexer should be disabled so that the mpu x auxiliary i c master can take control of the sensor i c bus and gather data from the auxiliary sensors for further information regarding i c master control please refer to section mpu x ad sdo scl sclk sda sdi digital motion processor dmp sensor master i c serial interface aux cl aux da interrupt status register int vdd bias ldo gnd regout fifo config register sensor register factory calibration cs slave i c or spi serial interface compass scl sda system processor interface bypass mux scl sda vdd vdd or gnd i c processor bus for reading all sensor data from mpu and for configuring external sensors i e compass in this example interface bypass mux allows direct configuration of compass by system processor optional sensor i c bus for configuring and reading from external sensors mpu mpu product specification document number ps mpu a revision release date of mpu using spi interface in the figure below the system processor is an spi master to the mpu pins and are used to support the cs sdo sclk and sdi signals for spi communications because these spi pins are shared with the i c slave pins and the system processor cannot access the auxiliary i c bus through the interface bypass multiplexer which connects the processor i c interface pins to the sensor i c interface pins since the mpu has limited capabilities as an i c master and depends on the system processor to manage the initial configuration of any auxiliary sensors another method must be used for programming the sensors on the auxiliary sensor i c bus pins and aux da and aux cl when using spi communications between the mpu and the system processor configuration of devices on the auxiliary i c sensor bus can be achieved by using i c slaves to perform read and write transactions on any device and register on the auxiliary i c bus the i c slave interface can be used to perform only single byte read and write transactions once the external sensors have been configured the mpu can perform single or multi byte reads using the sensor i c bus the read results from the slave controllers can be written to the fifo buffer as well as to the external sensor registers for further information regarding the control of the mpu x s auxiliary i c interface please refer to the mpu mpu register map and register descriptions document mpu ad sdo scl sclk sda sdi digital motion processor dmp sensor master i c serial interface interrupt status register int vdd bias ldo gnd regout fifo config register sensor register factory calibration cs slave i c or spi serial interface system processor interface bypass mux sdi sclk sdo cs processor spi bus for reading all data from mpu and for configuring mpu and external sensors aux cl aux da compass scl sda optional i c master performs read and write transactions on sensor i c bus sensor i c bus for configuring and reading data from external sensors mpu mpu product specification document number ps mpu a revision release date of internal clock generation the mpu x has a flexible clocking scheme allowing a variety of internal or external clock sources to be used for the internal synchronous circuitry this synchronous circuitry includes the signal conditioning and adcs the dmp and various control circuits and registers an on chip pll provides flexibility in the allowable inputs for generating this clock allowable internal sources for generating the internal clock are an internal relaxation oscillator any of the x y or z gyros mems oscillators with a variation of over temperature allowable external clocking sources are khz square wave mhz square wave selection of the source for generating the internal synchronous clock depends on the availability of external sources and the requirements for power consumption and clock accuracy these requirements will most likely vary by mode of operation for example in one mode where the biggest concern is power consumption the user may wish to operate the digital motion processor of the mpu x to process accelerometer data while keeping the gyros off in this case the internal relaxation oscillator is a good clock choice however in another mode where the gyros are active selecting the gyros as the clock source provides for a more accurate clock source clock accuracy is important since timing errors directly affect the distance and angle calculations performed by the digital motion processor and by extension by any processor there are also start up conditions to consider when the mpu x first starts up the device uses its internal clock until programmed to operate from another source this allows the user for example to wait for the mems oscillators to stabilize before they are selected as the clock source sensor data registers the sensor data registers contain the latest gyro accelerometer auxiliary sensor and temperature measurement data they are read only registers and are accessed via the serial interface data from these registers may be read anytime however the interrupt function may be used to determine when new data is available for a table of interrupt sources please refer to section fifo the mpu x contains a byte fifo register that is accessible via the serial interface the fifo configuration register determines which data is written into the fifo possible choices include gyro data accelerometer data temperature readings auxiliary sensor readings and fsync input a fifo counter keeps track of how many bytes of valid data are contained in the fifo the fifo register supports burst reads the interrupt function may be used to determine when new data is available for further information regarding the fifo please refer to the mpu mpu register map and register descriptions document interrupts interrupt functionality is configured via the interrupt configuration register items that are configurable include the int pin configuration the interrupt latching and clearing method and triggers for the interrupt items that can trigger an interrupt are clock generator locked to new reference oscillator used when switching clock mpu mpu product specification document number ps mpu a revision release date of sources new data is available to be read from the fifo and data registers accelerometer event interrupts and the mpu x did not receive an acknowledge from an auxiliary sensor on the secondary i c bus the interrupt status can be read from the interrupt status register for further information regarding interrupts please refer to the mpu x register map and register descriptions document for information regarding the mpu x s accelerometer event interrupts please refer to section digital output temperature sensor an on chip temperature sensor and adc are used to measure the mpu x die temperature the readings from the adc can be read from the fifo or the sensor data registers bias and ldo the bias and ldo section generates the internal supply and the reference voltages and currents required by the mpu x its two inputs are an unregulated vdd of to v and a vlogic logic reference supply voltage of v to vdd mpu only the ldo output is bypassed by a capacitor at regout for further details on the capacitor please refer to the bill of materials for external components section charge pump an on board charge pump generates the high voltage required for the mems oscillators its output is bypassed by a capacitor at cpout for further details on the capacitor please refer to the bill of materials for external components section mpu mpu product specification document number ps mpu a revision release date of programmable interrupts the mpu x has a programmable interrupt system which can generate an interrupt signal on the int pin status flags indicate the source of an interrupt interrupt sources may be enabled and disabled individually table of interrupt sources interrupt name module fifo overflow fifo data ready sensor registers i c master errors lost arbitration nacks i c master i c slave i c master for information regarding the interrupt enable disable registers and flag registers please refer to the mpu mpu register map and register descriptions document some interrupt sources are explained below mpu mpu product specification document number ps mpu a revision release date of digital interface i c and spi mpu only serial interfaces the internal registers and memory of the mpu mpu can be accessed using either i c at khz or spi at mhz mpu only spi operates in four wire mode serial interface pin number mpu mpu pin name pin description y cs spi chip select spi enable y vlogic digital i o supply voltage vlogic must be vdd at all times y ad sdo i c slave address lsb ad spi serial data output sdo y ad i c slave address lsb y scl sclk i c serial clock scl spi serial clock sclk y scl i c serial clock y sda sdi i c serial data sda spi serial data input sdi y sda i c serial data note to prevent switching into i c mode when using spi mpu the i c interface should be disabled by setting the i c if dis configuration bit setting this bit should be performed immediately after waiting for the time specified by the start up time for register read write in section for further information regarding the i c if dis bit please refer to the mpu mpu register map and register descriptions document i c interface i c is a two wire interface comprised of the signals serial data sda and serial clock scl in general the lines are open drain and bi directional in a generalized i c interface implementation attached devices can be a master or a slave the master device puts the slave address on the bus and the slave device with the matching address acknowledges the master the mpu x always operates as a slave device when communicating to the system processor which thus acts as the master sda and scl lines typically need pull up resistors to vdd the maximum bus speed is khz the slave address of the mpu x is b x which is bits long the lsb bit of the bit address is determined by the logic level on pin ad this allows two mpu x s to be connected to the same i c bus when used in this configuration the address of the one of the devices should be b pin ad is logic low and the address of the other should be b pin ad is logic high i c communications protocol start s and stop p conditions communication on the i c bus starts when the master puts the start condition s on the bus which is defined as a high to low transition of the sda line while scl line is high see figure below the bus is considered to be busy until the master puts a stop condition p on the bus which is defined as a low to high transition on the sda line while scl is high see figure below mpu mpu product specification document number ps mpu a revision release date of additionally the bus remains busy if a repeated start sr is generated instead of a stop condition sda scl s start condition stop condition p start and stop conditions data format acknowledge i c data bytes are defined to be bits long there is no restriction to the number of bytes transmitted per data transfer each byte transferred must be followed by an acknowledge ack signal the clock for the acknowledge signal is generated by the master while the receiver generates the actual acknowledge signal by pulling down sda and holding it low during the high portion of the acknowledge clock pulse if a slave is busy and cannot transmit or receive another byte of data until some other task has been performed it can hold scl low thus forcing the master into a wait state normal data transfer resumes when the slave is ready and releases the clock line refer to the following figure data output by transmitter sda data output by receiver sda scl from master start condition clock pulse for acknowledgement acknowledge not acknowledge acknowledge on the i c bus mpu mpu product specification document number ps mpu a revision release date of communications after beginning communications with the start condition s the master sends a bit slave address followed by an th bit the read write bit the read write bit indicates whether the master is receiving data from or is writing to the slave device then the master releases the sda line and waits for the acknowledge signal ack from the slave device each byte transferred must be followed by an acknowledge bit to acknowledge the slave device pulls the sda line low and keeps it low for the high period of the scl line data transmission is always terminated by the master with a stop condition p thus freeing the communications line however the master can generate a repeated start condition sr and address another slave without first generating a stop condition p a low to high transition on the sda line while scl is high defines the stop condition all sda changes should take place when scl is low with the exception of start and stop conditions sda start condition scl address r w ack data ack data ack stop condition s p complete i c data transfer to write the internal mpu x registers the master transmits the start condition s followed by the i c address and the write bit at the th clock cycle when the clock is high the mpu x acknowledges the transfer then the master puts the register address ra on the bus after the mpu x acknowledges the reception of the register address the master puts the register data onto the bus this is followed by the ack signal and data transfer may be concluded by the stop condition p to write multiple bytes after the last ack signal the master can continue outputting data rather than transmitting a stop signal in this case the mpu x automatically increments the register address and loads the data to the appropriate register the following figures show single and two byte write sequences single byte write sequence burst write sequence master s ad w ra data p slave ack ack ack master s ad w ra data data p slave ack ack ack ack mpu mpu product specification document number ps mpu a revision release date of to read the internal mpu x registers the master sends a start condition followed by the i c address and a write bit and then the register address that is going to be read upon receiving the ack signal from the mpu x the master transmits a start signal followed by the slave address and read bit as a result the mpu x sends an ack signal and the data the communication ends with a not acknowledge nack signal and a stop bit from master the nack condition is defined such that the sda line remains high at the th clock cycle the following figures show single and two byte read sequences single byte read sequence burst read sequence i c terms signal description s start condition sda goes from high to low while scl is high ad slave i c address w write bit r read bit ack acknowledge sda line is low while the scl line is high at the th clock cycle nack not acknowledge sda line stays high at the th clock cycle ra mpu x internal register address data transmit or received data p stop condition sda going from low to high while scl is high master s ad w ra s ad r nack p slave ack ack ack data master s ad w ra s ad r ack nack p slave ack ack ack data data mpu mpu product specification document number ps mpu a revision release date of spi interface mpu only spi is a wire synchronous serial interface that uses two control lines and two data lines the mpu always operates as a slave device during standard master slave spi operation with respect to the master the serial clock output sclk the serial data output sdo and the serial data input sdi are shared among the slave devices each spi slave device requires its own chip select cs line from the master cs goes low active at the start of transmission and goes back high inactive at the end only one cs line is active at a time ensuring that only one slave is selected at any given time the cs lines of the non selected slave devices are held high causing their sdo lines to remain in a high impedance high z state so that they do not interfere with any active devices spi operational features data is delivered msb first and lsb last data is latched on the rising edge of sclk data should be transitioned on the falling edge of sclk the maximum frequency of sclk is mhz spi read and write operations are completed in or more clock cycles two or more bytes the first byte contains the spi address and the following byte s contain s the spi data the first bit of the first byte contains the read write bit and indicates the read or write operation the following bits contain the register address in cases of multiple byte read writes data is two or more bytes spi address format msb lsb r w a a a a a a a spi data format msb lsb d d d d d d d d supports single or burst read writes typical spi master slave configuration spi master spi slave spi slave cs cs sclk sdi sdo cs sclk sdi sdo cs mpu mpu product specification document number ps mpu a revision release date of serial interface considerations mpu mpu supported interfaces the mpu supports i c communications on both its primary microprocessor serial interface and its auxiliary interface logic levels the mpu s i o logic levels are set to be vlogic as shown in the table below aux vddio must be set to i o logic levels vs aux vddio aux vddio microprocessor logic levels pins sda scl ad clkin int auxillary logic levels pins aux da aux cl vlogic vlogic note the power on reset value for aux vddio is when aux vddio is set to its power on reset value vlogic is the power supply voltage for both the microprocessor system bus and the auxiliary i c bus as shown in the figure of section mpu mpu product specification document number ps mpu a revision release date of logic levels diagram for aux vddio the figure below depicts a sample circuit with a third party magnetometer attached to the auxiliary i c bus it shows logic levels and voltage connections for aux vddio note actual configuration will depend on the auxiliary sensors used mpu rd party magnetometer sda aux cl scl aux da vdd io vdd sa int int system processor io clkin system bus vlogic vlogic vlogic vdd vlogic v vlogic scl sda int fsync vlogic ad v vlogic v vlogic v vlogic v vlogic v vlogic v vlogic v vlogic v vlogic v vlogic v vlogic v vlogic cs v vlogic vdd io i o levels and connections for aux vddio notes aux vddio determines the io voltage levels of aux da and aux cl set output levels relative to vlogic all other mpu logic ios are referenced to vlogic mpu mpu product specification document number ps mpu a revision release date of assembly this section provides general guidelines for assembling invensense micro electro mechanical systems mems gyros packaged in quad flat no leads package qfn surface mount integrated circuits orientation of axes the diagram below shows the orientation of the axes of sensitivity and the polarity of rotation note the pin identifier in the figure mpu mpu z x y orientation of axes of sensitivity and polarity of rotation z y x mpu mpu product specification document number ps mpu a revision release date of package dimensions lead qfn x x mm nipdau lead frame finish symbols dimensions in millimeters min nom max a a b c ref d d e e e f e b k l l s co d d e pin identifier is a laser marked feature on top e b c a a on corners lead dimensions s s l e l f mpu mpu product specification document number ps mpu a revision release date of pcb design guidelines the pad diagram using a jedec type extension with solder rising on the outer edge is shown below the pad dimensions table shows pad sizing mean dimensions recommended for the mpu x product jedec type extension with solder rising on outer edge pcb layout diagram symbols dimensions in millimeters nom nominal package i o pad dimensions e pad pitch b pad width l pad length l pad length d package width e package length d exposed pad width e exposed pad length i o land design dimensions guidelines d i o pad extent width e i o pad extent length c land width tout outward extension tin inward extension l land length l land length pcb dimensions table for pcb lay out diagram mpu mpu product specification document number ps mpu a revision release date of assembly precautions gyroscope surface mount guidelines invensense mems gyros sense rate of rotation in addition gyroscopes sense mechanical stress coming from the printed circuit board pcb this pcb stress can be minimized by adhering to certain design rules when using mems gyroscope components in plastic packages pcb mounting and assembly can cause package stress this package stress in turn can affect the output offset and its value over a wide range of temperatures this stress is caused by the mismatch between the coefficient of linear thermal expansion cte of the package material and the pcb care must be taken to avoid package stress due to mounting traces connected to pads should be as symmetric as possible maximizing symmetry and balance for pad connection will help component self alignment and will lead to better control of solder paste reduction after reflow any material used in the surface mount assembly process of the mems gyroscope should be free of restricted rohs elements or compounds pb free solders should be used for assembly exposed die pad precautions the mpu x has very low active and standby current consumption the exposed die pad is not required for heat sinking and should not be soldered to the pcb failure to adhere to this rule can induce performance changes due to package thermo mechanical stress there is no electrical connection between the pad and the cmos trace routing routing traces or vias under the gyro package such that they run under the exposed die pad is prohibited routed active signals may harmonically couple with the gyro mems devices compromising gyro response these devices are designed with the drive frequencies as follows x khz y khz and z khz to avoid harmonic coupling don t route active signals in non shielded signal planes directly below or above the gyro package note for best performance design a ground plane under the e pad to reduce pcb signal noise from the board on which the gyro device is mounted if the gyro device is stacked under an adjacent pcb board design a ground plane directly above the gyro device to shield active signals from the adjacent pcb board component placement do not place large insertion components such as keyboard or similar buttons connectors or shielding boxes at a distance of less than mm from the mems gyro maintain generally accepted industry design practices for component placement near the mpu x to prevent noise coupling and thermo mechanical stress pcb mounting and cross axis sensitivity orientation errors of the gyroscope and accelerometer mounted to the printed circuit board can cause cross axis sensitivity in which one gyro or accel responds to rotation or acceleration about another axis respectively for example the x axis gyroscope may respond to rotation about the y or z axes the orientation mounting errors are illustrated in the figure below mpu mpu product specification document number ps mpu a revision release date of package gyro accel axes relative to pcb axes with orientation errors and mpu mpu x y z the table below shows the cross axis sensitivity as a percentage of the gyroscope or accelerometer s sensitivity for a given orientation error respectively cross axis sensitivity vs orientation error orientation error or cross axis sensitivity sin or sin the specifications for cross axis sensitivity in section and section include the effect of the die orientation error with respect to the package mems handling instructions mems micro electro mechanical systems are a time proven robust technology used in hundreds of millions of consumer automotive and industrial products mems devices consist of microscopic moving mechanical structures they differ from conventional ic products even though they can be found in similar packages therefore mems devices require different handling precautions than conventional ics prior to mounting onto printed circuit boards pcbs the mpu x has been qualified to a shock tolerance of g invensense packages its gyroscopes as it deems proper for protection against normal handling and shipping it recommends the following handling precautions to prevent potential damage do not drop individually packaged gyroscopes or trays of gyroscopes onto hard surfaces components placed in trays could be subject to g forces in excess of g if dropped printed circuit boards that incorporate mounted gyroscopes should not be separated by manually snapping apart this could also create g forces in excess of g do not clean mems gyroscopes in ultrasonic baths ultrasonic baths can induce mems damage if the bath energy causes excessive drive motion through resonant frequency coupling esd considerations establish and use esd safe handling precautions when unpacking and handling esd sensitive devices mpu mpu product specification document number ps mpu a revision release date of store esd sensitive devices in esd safe containers until ready for use the tape and reel moisture sealed bag is an esd approved barrier the best practice is to keep the units in the original moisture sealed bags until ready for assembly restrict all device handling to esd protected work areas that measure less than v static charge ensure that all workstations and personnel are properly grounded to prevent esd reflow specification qualification reflow the mpu x was qualified in accordance with ipc jedec j std d this standard classifies proper packaging storage and handling in order to avoid subsequent thermal and mechanical damage during the solder reflow attachment phase of pcb assembly the qualification preconditioning process specifies a sequence consisting of a bake cycle a moisture soak cycle in a temperature humidity oven and three consecutive solder reflow cycles followed by functional device testing the peak solder reflow classification temperature requirement for package qualification is c for lead free soldering of components measuring less than mm in thickness the qualification profile and a table explaining the set points are shown below temperature c time seconds solder reflow profile for qualification lead free ir convection preheat sec t smax t smin t liquidus t pmin t pmax liquidus sec sec t ramp up c sec t ramp down c sec t room pmax sec a b c d e f g h i mpu mpu product specification document number ps mpu a revision release date of temperature set points corresponding to reflow profile above step setting constraints temp c time sec max rate c sec a t room b t smin c t smax t bc d t liquidus r tliquidus tpmax e t pmin c c r tliquidus tpmax f t pmax c c t af r tliquidus tpmax g t pmin c c t eg r tpmax tliquidus h t liquidus t dh i t room notes customers must never exceed the classification temperature t pmax c all temperatures refer to the topside of the qfn package as measured on the package body surface production reflow check the recommendations of your solder manufacturer for optimum results use lead free solders that have lower specified temperature profiles tp max c also use lower ramp up and ramp down rates than those used in the qualification profile never exceed the maximum conditions that we used for qualification as these represent the maximum tolerable ratings for the device storage specifications the storage specification of the mpu x conforms to ipc jedec j std d moisture sensitivity level msl calculated shelf life in moisture sealed bag months storage conditions c and rh after opening moisture sealed bag hours storage conditions ambient c at rh package marking specification invensense mpu x x x x x x x x x x y y w w x lot traceability code foundry code package vendor code rev code y y year code w w work week top view part number invensense mpu x x x x x x x x x x y y w w x top view package marking specification mpu mpu product specification document number ps mpu a revision release date of tape reel specification tape dimensions reel outline drawing reel dimensions and package size package size reel mm l v w z x mpu mpu product specification document number ps mpu a revision release date of tape and reel specification reel specifications quantity per reel reels per box boxes per carton max pcs carton max label barcode label location of label on reel label reel cover tape anti static carrier tape anti static terminal tape user direction of feed invensense invensense invensense invensense pin package orientation i n ve n s ens e p b f r e e ca teg o ry e hf de v ic e p m pu p o h u b r e el qty q l ot t q r f d c d qty q lo t t q v g d c d q t y q reel d ate qc st a m p mpu mpu product specification document number ps mpu a revision release date of packaging reel with barcode vacuum sealed moisture msl label caution labels barrier bag with esd msl caution and barcode labels caution label esd label inner bubble wrap pizza box pizza boxes placed in foam outer shipper label lined shipper box mpu mpu product specification document number ps mpu a revision release date of representative shipping carton label mpu mpu product specification document number ps mpu a revision release date of reliability qualification test policy invensense s products complete a qualification test plan before being released to production the qualification test plan for the mpu x followed the jesd i standards stress test driven qualification of integrated circuits with the individual tests described below qualification test plan accelerated life tests test method condition lot quantity sample lot acc reject criteria htol lfr high temperature operating life jedec jesd a d dynamic v biased tj c read points hours hast highly accelerated stress test jedec jesd a a condition a c rh psia unbiased read point hours hts high temperature storage life jedec jesd a d cond a c non bias bake read points hours device component level tests test method condition lot quantity sample lot acc reject criteria esd hbm esd human body model jedec js kv esd mm esd machine model jedec jesd a c v lu latch up jedec jesd d class ii c ma ms mechanical shock jedec jesd b c mil std method cond e g s ms x y z directions times direction vib vibration jedec jesd b b variable frequency random cond b hz x y z times direction tc temperature cycling jedec jesd a d condition g c to c soak mode cycles board level tests test method condition lot quantity sample lot acc reject criteria bms board mechanical shock jedec jesd b c mil std method cond e g s ms x y z directions times direction btc board temperature cycling jedec jesd a d condition g c to c soak mode cycles tests are preceded by msl preconditioning in accordance with jedec jesd a f mpu mpu product specification document number ps mpu a revision release date of environmental compliance the mpu mpu is rohs and green compliant the mpu mpu is in full environmental compliance as evidenced in report hs mpu materials declaration data sheet environmental declaration disclaimer invensense believes this environmental information to be correct but cannot guarantee accuracy or completeness conformity documents for the above component constitutes are on file invensense subcontracts manufacturing and the information contained herein is based on data received from vendors and suppliers which has not been validated by invensense this information furnished by invensense is believed to be accurate and reliable however no responsibility is assumed by invensense for its use or for any infringements of patents or other rights of third parties that may result from its use specifications are subject to change without notice invensense reserves the right to make changes to this product including its circuits and software in order to improve its design and or performance without prior notice invensense makes no warranties neither expressed nor implied regarding the information and specifications contained in this document invensense assumes no responsibility for any claims or damages arising from information contained in this document or from the use of products and services detailed therein this includes but is not limited to claims or damages based on the infringement of patents copyrights mask work and or other intellectual property rights certain intellectual property owned by invensense and described in this document is patent protected no license is granted by implication or otherwise under any patent or patent rights of invensense this publication supersedes and replaces all information previously supplied trademarks that are registered trademarks are the property of their respective companies invensense sensors should not be used or sold in the development storage production or utilization of any conventional or mass destructive weapons or for any other weapons or life threatening applications as well as in any other life critical applications such as medical equipment transportation aerospace and nuclear instruments undersea equipment power plant equipment disaster prevention and crime prevention equipment invensense is a registered trademark of invensense inc mpu tm mpu tm mpu tm mpu x tm digital motion processor dmp motion processing unit motionfusion motioninterface motiontracking and motionapps are trademarks of invensense inc invensense inc all rights reserved worldwide as millions of people stay at home to minimise transmission of severe acute respiratory syndrome coronavirus health care workers prepare to do the exact opposite they will go to clinics and hospitals putting themselves at high risk from covid figures from china s national health commission show that more than health care workers have been infected as of early march and according to local media by the end of february at least had died in italy of responding health care workers were infected and some have died reports from medical staff describe physical and mental exhaustion the torment of difficult triage decisions and the pain of losing patients and colleagues all in addition to the infection risk as the pandemic accelerates access to personal protective equipment ppe for health workers is a key concern medical staff are prioritised in many countries but ppe shortages have been described in the most affected facilities some medical staff are waiting for equipment while already seeing patients who may be infected or are supplied with equipment that might not meet requirements alongside concerns for their personal safety health care workers are anxious about passing the infection to their families health care workers who care for elderly parents or young children will be drastically affected by school closures social distancing policies and disruption in the availability of food and other essentials health care systems globally could be operating at more than maximum capacity for many months but health care workers unlike ventilators or wards cannot be urgently manufactured or run at occupancy for long periods it is vital that governments see workers not simply as pawns to be deployed but as human individuals in the global response the safety of health care workers must be ensured adequate provision of ppe is just the first step other practical measures must be considered including cancelling non essential events to prioritise resources provision of food rest and family support and psychological support presently health care workers are every country s most valuable resource summary background we aimed to evaluate and improve the accuracy of the ultrasound scan in estimating gestational age in late pregnancy ie after weeks gestation in low income and middle income countries lmics where access to ultrasound in the first half of pregnancy is rare and where intrauterine growth restriction is prevalent methods this prospective population based cohort study was done in three lmics bangladesh pakistan and tanzania participating in the who alliance for maternal and newborn health improvement study women carrying a live singleton fetus dated by crown rump length crl measurements between weeks of gestation who were willing to return for two additional ultrasound scans and who planned on delivering in the study area were enrolled in the study participants underwent ultrasonography at weeks and at weeks gestation birthweights were measured within h of birth and the proportions of infants who had a small for gestational age birthweight ie a birthweight of the standard birthweight for the infant s gestational age and sex according to the intergrowth st project newborn baby reference standards and appropriate for gestational age birthweights were ascertained estimation of gestational age by standard fetal biometry measurements in addition to transcerebellar diameter tcd measurements was compared with gold standard crl measurements by use of bland altman plots to calculate the mean difference and limits of agreement statistical modelling was done to develop new gestational age prediction formulas for third trimester ultrasonography in lmics findings between feb and jan women were enrolled in the study pregnant women had an ultrasound scan at weeks of gestation and had an ultrasound scan between weeks of gestation of the unique infants whose birthweights were available infants were born with an appropriate for gestational age birthweight and infants were born with a small for gestational age birthweight the accuracy of late pregnancy ultrasound biometry using existing formulas to estimate gestational age in lmics was similar to that in high income settings with standard dating formulas late pregnancy ultrasound at weeks gestation was accurate to within approximately plus or minus weeks of the gold standard crl measurement of gestational age and late pregnancy ultrasound was accurate to within weeks of the crl measurement at weeks gestation in infants who were ultimately born small for gestational age individual parameters systematically underestimated gestational age apart from tcd which showed minimal bias by use of a novel parsimonious model formula that combined tcd with femur length gestational age at the week ultrasound scan was estimated to within days of the crl measurement and estimated to within days of the crl measurement at the week ultrasound scan similar results were observed in infants who were small for gestational age interpretation incorporation of tcd and the use of new formulas in late pregnancy ultrasound scans could improve the accuracy of gestational age estimation in both appropriate for gestational age and small for gestational age infants in lmics given the high rates of small for gestational age infants in lmics these results might be especially relevant validation of this new formula in other lmic populations is needed to establish whether the accuracy of the late pregnancy ultrasound can be narrowed to within approximately weeks funding bill melinda gates foundation view related content for this article research in context evidence before this study the performance of late pregnancy ultrasound for assessing gestational age has been understudied in low income and middle income countries lmics where access to ultrasound for gestational age dating early in pregnancy is rare and where a high proportion of infants are born small for gestational age in high income settings the transcerebellar diameter tcd has shown promise as a biometric parameter that is less affected by intrauterine growth restriction than standard ultrasound biometric measurements but this parameter is not routinely used as most women in high income settings present earlier weeks of gestation for ultrasound confirmation of gestational age added value of this study in this multicountry population based cohort study we compared the performance of standard ultrasound biometric parameters and tcd with the gold standard method of first trimester crown rump length crl measurements for estimating gestational age in late pregnancy ie after weeks gestation the accuracy of ultrasonography in estimating gestational age in late pregnancy in lmics was similar to that reported in high income settings but it was further improved when tcd was included in the combination formulas for gestational age assessment we derived a parsimonious model requiring measurement of only the tcd and the femur length that was accurate to within approximately plus or minus weeks of the gold standard crl measurement of gestational age even among infants who were ultimately born small for gestational age our study was population based enrolling an unselected group of pregnant women rather than a selected group of only the healthiest pregnant women therefore we believe our novel gestational age formula is more generalisable to real world conditions that health care practitioners in lmics face implications of all the available evidence in lmics gestational age in late pregnancy can be reliably assessed to within approximately weeks of the crl measurement by use of only two ultrasound parameters these results were consistent when our gestational age formulas were applied to pregnancies in which the infants were ultimately born small for gestational age our formulas could be most useful when measuring gestational age in pregnant women who present late to receive antenatal care in lmics where the burden of intrauterine growth restriction is high the biometric ultrasound measurements used in our study appear to be attainable by health care providers with limited sonography training accurate gestational age dating can enable providers to identify pregnancies requiring antenatal interventions such as corticosteroids or transfer to a facility that is able to handle premature infants accurate dating will also allow researchers to better estimate the global burden of preterm birth and intrauterine growth restriction introduction pregnancy dating is an essential component of antenatal care accurate estimation of gestational age is needed to optimise provision of obstetric interventions and delivery location for preterm births and it is also a prerequisite to identify and manage fetal growth abnormalities additionally accurate estimation of gestational age is required to provide reasonable global estimates of preterm birth and intrauterine growth restriction in low income and middle income countries lmics where the burden of preterm birth and intrauterine growth restriction is highest assessing gestational age accurately can be challenging because of many factors for instance last menstrual period is often unknown and menstrual cycles can vary in length symphysis fundal height can be a misleading measure of gestational age because of variation in maternal adiposity intrauterine growth restriction uterine fibroids or malpresentation the first trimester ultrasound is considered to be the gold standard method for estimating gestational age in high income settings but ultrasound early in gestation might not be routinely available in lmics in addition pregnant women in lmics might not present for antenatal care in early pregnancy as gestation advances ultrasound biometry becomes less accurate for estimating gestational age given the emergence of natural variation in fetal size and the possibility of pathological growth restriction indeed in lmics where of infants are born small for gestational age the assumption that fetal size predicts gestational age might not be valid studies suggest that measurements of the cerebellum could allow for a more accurate estimation of gestational age late in pregnancy ie from weeks gestation onwards compared with standard biometry measurements cerebellar size appears to be less affected by intrauterine growth restriction than other measures of growth there is also less natural variation in cerebellar size between fetuses transcerebellar diameter tcd nomograms have been published for several populations but they are not in mainstream use in high income settings as most women have early ultrasound scans at weeks gestation when standard biometric measurements biparietal diameter head circumference abdominal circumference and femur length are reported to provide an accurate estimation of gestational age to within plus or minus weeks of the gold standard crown rump length crl measurement of gestational age standard biometry does not perform as well in the third trimester as it does at less than weeks gestation with a reported accuracy of only or more weeks of the crl measurement one study in the usa found a strong correlation between cerebellar size and gestational age in infants born with an appropriate for gestational age birthweight and in those born small for gestational age even though a small number of studies have measured the cerebellum in specific lmics the performance of cerebellar biometry for assessing gestational age has been understudied in settings where its use might be of greater benefit the objective of the who alliance for maternal and newborn health improvement amanhi late pregnancy dating study was to evaluate the accuracy of late pregnancy ie after weeks gestation ultrasound biometry in estimating gestational age in lmic settings with a particular focus on the effect of intrauterine growth restriction on the accuracy and whether cerebellar measurements could improve performance methods study design and participants the who amanhi study cohort was established in to harmonise several large ongoing maternal and neonatal health research studies in sub saharan africa and south asia the study involved five distinct sites sylhet bangladesh karachi pakistan pemba tanzania brong ahafo gahna southern province zambia three of the five amanhi sites sylhet karachi and pemba participated in this prospective multicountry population based cohort substudy known as the who amanhi late pregnancy dating study the remaining two sites brong ahafo and the southern province were ineligible having completed amanhi enrolment amanhi study populations were predominantly rural with low levels of literacy as amanhi was an unselected population based cohort it was inclusive of both appropriately grown and growth restricted infants between feb and jan pregnant women were identified by trained field workers through home visits urine tests for human chorionic gonadotropin were used to confirm pregnancies women were eligible for the study if they were pregnant with a live singleton fetus the pregnancy had been dated by crl measurements between and weeks gestation crl of mm they were willing to return for two additional ultrasounds and they planned on delivering in the study area women pregnant with multiple fetuses or a non viable or anomalous fetus were ineligible fieldworkers obtained written informed consent from participants in their local languages and arranged study ultrasounds to coincide with standard amanhi visits ethics approval was granted by institutional review boards and ethics review committees in the participating countries the host institutions of principal investigators who and partners healthcare the boston based coordinating team procedures we considered the first trimester ultrasound scan to be the gold standard method for estimating gestational age amanhi study sonographers followed standardised procedures to obtain high quality transabdominal crl measurements three crl measurements were obtained for each participant and the median crl value and the intergrowth st equation were used to calculate gestational age first trimester crl measurements established the estimated date of delivery and were considered as the gold standard gestational age at all subsequent study visits study ultrasound procedures were standardised during a day training course in bangladesh for staff from participating amanhi sites and consisted of didactic and practical teaching methods competency was assessed with written and practical post training assessments staff from pakistan were unable to attend because of visa issues and they were therefore trained via skype conferencing no additional sonographers were recruited during the study period two ultrasound scans subsequent to the first trimester ultrasound were done for each participant the first between and weeks gestation and the second between and weeks gestation both coinciding with routine amanhi visits after study initiation the gestational age windows were extended to weeks and weeks to cover a wider range of the third trimester however only the pemba site received ethics approval for this extension before study completion at every ultrasound visit sonographers followed standardised procedures to obtain high quality measurements of the biparietal diameter head circumference abdominal circumference femur length and tcd appendix p sonographers were masked to the gold standard gestational age established by crl measurements ultrasound biometry measurements were obtained without the use of an automated biometry software package so that only absolute measurements were taken two measurements for each biometric parameter were obtained and averaged plausible measurement ranges were defined for each parameter before the analysis crl mm biparietal diameter cm head circumference cm femur length cm abdominal circumference cm and tcd cm for measures outside of these ranges data were checked for data entry errors and were assigned as missing if unresolved gestational age was calculated from each individual biometric parameter by use of standard tables hadlock and colleagues for biparietal diameter femur length and abdominal circumference chavez and colleagues for tcd and intergrowth st project for head circumference gestational age was also calculated by use of previously published formulas that combine more than one parameter hadlock and colleagues and intergrowth st project formulas and the reasonable ranges for individual parameters are detailed in the appendix p an image quality checklist provided objective guidance on appropriate image magnification ideal image plane and correct calliper placement all study images were reviewed by bjw who was masked to the gold standard gestational age values for ongoing quality control with quarterly feedback to the sonographers infants were visited within h of birth birthweights were obtained by use of digital scales small for gestational age was defined as less than of the standard birthweight for the infant s gestational age and sex according to the intergrowth st project newborn baby reference standards statistical analysis study sample size was calculated on the basis of our hypothesis that the gestational age agreement between tcd and crl would be higher than the agreement between standard biometry and crl both among infants with appropriate for gestational age birthweights and among those with small for gestational age birthweights previously published literature and professional society guidelines have shown that late pregnancy biometry combination formulas have a gestational age accuracy of within days of the gold standard first trimester crl measurements by use of overlapping bland altman plots to compare the degree of agreement between tcd versus crl with standard biometry versus crl a sample size of would be adequate to show a mean difference of and limits of agreement loa of within days tcd vs crl versus within days standard biometry vs crl of the crl estimated gestational age we aimed to enrol a minimum of infants with small for gestational age birthweights per site assuming that of infants would be small for gestational age and that of pregnant women would be lost to follow up at delivery we required infants per site therefore we had a conservative target of enrolling participants per study site the stata software programme statacorp stata statistical software release college station tx usa was used for all statistical analyses bland altman plots were used to assess the agreement between gestational age measured by gold standard crl and gestational age measured by late pregnancy ultrasound biometric parameters mean differences bias with cis and loa values were calculated for each comparison for ease of comparison an approximation of the degree of agreement was calculated as the midpoint between the unsigned loa values as an example if the loa was to days the approximation of agreement would be within days of the gestational age as determined by the gold standard first trimester crl measurement for individual biometric parameters or combinations of parameters with bias ie if the ci of the mean difference does not include the gestational age window agreement limits would be skewed in the direction of the bias for infants with available birthweights we stratified the results by infant size to compare the accuracy of late pregnancy biometry measures among infants with appropriate for gestational age birthweights and small for gestational age birthweights statistical modelling was used to develop novel equations to predict gestational age with late pregnancy biometric parameters as covariates generalised linear regression was done by use of the stata glm command accounting for clustering of multiple visits for a participant gold standard gestational age determination by crl measurement was the dependent variable covariates tested in the models included all late pregnancy biometric parameters measured biparietal diameter head circumference femur length abdominal circumference and tcd natural logarithms were used to transform continuous measures given non normal distributions models with individual and combinations of biometric parameters were tested given the performance of tcd as an individual parameter models including tcd as the main predictor were examined adding additional biometric parameters assessing for significance ie if the p value was and improvement in the adjusted r and determining the best fit model according to the akaike information criterion potential models were cross validated to compare the predictive accuracy of the different models and select biometric parameters to be included in the final model two methods were used to cross validate the models in the first method the study dataset was divided into five random subsamples one subsample was withheld and statistical models were generated with the remaining of the data the model was then used to predict gestational age in the withheld subsample and a standardised error term was calculated on the basis of the predicted gestational age calculated as observed gestational age predicted gestational age predicted gestational age this process was repeated with each successive withheld subsample and a summary measure of the prediction error was generated for the entire dataset the model with the lowest prediction error was selected as the final model in the second cross validation method the data from one study site were withheld and statistical models were generated with data from the remaining two sites the model was then fit and used to predict gestational age in the first site that had the data withheld this process was repeated twice and the standardised error was calculated role of the funding source the funder of the study had no role in the study design data collection data analysis data interpretation or writing of the report results between feb and jan pregnant women in three of the five amanhi study sites bangladesh pakistan and tanzania with documented crl assessments between and weeks gestation were enrolled in this late pregnancy ultrasound study of these women completed late pregnancy scans data from nine infants were excluded from the final analysis because of implausible dates that could not be reconciled eg date of birth before date of ultrasound or year of ultrasound or birth recorded incorrectly we determined a priori that a difference of greater than days between the gold standard crl measurement of gestational age and the gestational age predicted by late pregnancy biometry measurements was considered to be implausibly associated with the performance of the ultrasound three such extreme outliers were excluded at weeks gestation and an additional three were excluded at weeks gestation the final analysis included unique mothers of whom underwent an ultrasound scan between and weeks gestation in bangladesh in pakistan and in tanzania and underwent an ultrasound scan between and weeks gestation in bangladesh in pakistan and in tanzania figure figure thumbnail gr figure participant flowchart by ultrasound visit show full caption view large imagefigure viewerdownload hi res imagedownload ppt more than of all attempts at biometric measurements were successful of the ultrasound scans done at weeks gestation values for the biparietal diameter were missing in two scans for head circumference in three scans for femur length in two scans for abdominal circumference in three scans and for tcd in three scans of the ultrasound scans done at weeks gestation missing values for the different parameters were similar to the ultrasound scan at weeks gestation with two values missing for biparietal diameter two for head circumference none for femur length and eight for abdominal circumference even at weeks gestation tcd measurements were successfully obtained from of ultrasound scans summary measures from the individual biometric parameters mean and sd for the cohort and by site are included in the appendix p using the reference nomogram for crl by hadlock and colleagues as an alternative to the intergrowth st project nomogram no significant differences in the distribution of gestational ages estimated from either third trimester ultrasound scan were observed data not shown from the ultrasound scans done at weeks gestation the performance of individual biometric parameters showed fairly similar agreement with gold standard crl measurements approximations ranging from to days of the standard crl measurements table there was little bias as evidenced by a mean difference close to zero for all parameters a representative bland altman plot for tcd versus crl is presented in figure table degree of agreement between late pregnancy ultrasound and gold standard first trimester crown rump length measurement of gestational age ultrasound scan at weeks gestation n ultrasound scan at weeks gestation n mean difference in days ci limits of agreement in days approximation in days mean difference in days ci limits of agreement in days approximation in days individual parameters tcd to to to to bpd to to to to hc to to to to fl to to to to ac to to to to combination formulas hadlock to to to to intergrowth st project to to to to amanhi parsimonious formula to to to to the hadlock formula includes bpd ac and fl measurements intergrowth st project formula includes hc and fl measurements and the amanhi parsimonious method includes tcd and fl measurements tcd transcerebellar diameter bpd biparietal diameter hc head circumference fl femur length ac abdominal circumference amanhi alliance for maternal and newborn health improvement approximation refers to the midpoint between the unsigned limits of agreement and values represent the number of days plus or minus the gold standard first trimester crown rump length measurement of gestational age for biometric parameters or combinations with bias ie if the ci of the mean difference does not include the true value of gestational age compared with the estimated value from third trimester biometry will be skewed in the direction of the bias mean difference open table in a new tab figure thumbnail gr figure bland altman plots comparing agreement of gestational age days determied by tcd measurements with first trimester crl measurements at weeks gestation a and weeks gestation b by study site show full caption view large imagefigure viewerdownload hi res imagedownload ppt from the ultrasound scans done at weeks gestation tcd had narrower loa than the other individual biometric parameters table the agreement between tcd and gold standard crl measurements was approximated to be within days of the crl measurement with little bias mean difference days ci compared with tcd the remaining individual parameters showed less agreement with crl measurements approximations ranged between days a strong negative bias for biparietal diameter days ci to femur length days to and abdominal circumference days to was observed suggesting a systematic underestimation of gestational age by approximately week from the ultrasound scan at weeks gestation the hadlock and intergrowth st project combination formulas outperformed individual parameters by a few days approximations ranged between days and maintained little bias table from the ultrasound scan at weeks gestation tcd alone approximation days showed a similar degree of agreement to crl measurements as the hadlock formula approximation days and slightly narrower agreement with crl measurements than the intergrowth st project formula approximation days notably the hadlock formula had a strong negative bias mean difference days ci to results did not vary substantially by site data not shown and have been presented together stratification of results by infant size was done in women who were less than weeks pregnant when they gave birth with birthweights available and included of women who had an ultrasound scan at weeks gestation of women who had an ultrasound scan at weeks gestation and of all unique infants for whom the birthweights were known of the unique infants were classified as small for gestational age the prevalence of infants who were small for gestational age varied by site and was higher in asian sites of infants in bangladesh and of infants in pakistan than in the african sites of infants in tanzania tcd outperformed the other biometric parameters in predicting gestational age and showed less negative bias ie less underestimation with loa values that were similar at the week and week scans in infants who had appropriate for gestational age birthweights and small for gestational age birthweights table hadlock and intergrowth st project combination formulas had slightly narrower loa values than individual parameters at the week scan in infants who were small for gestational age table although the hadlock formula had substantial negative bias days ci to at the week scan tcd had a similar loa to the combination formulas for infants who were small for gestational age approximation days but with less bias mean difference days than both the hadlock days and intergrowth st project formulas days table table performance of late pregnancy ultrasound in estimating the gestational age of infants with small for gestational age or appropriate for gestational age birthweights birthweight appropriate for gestational age birthweight small for gestational age mean difference in days ci limits of agreement in days approximation in days mean difference in days ci limits of agreement in days approximation in days weeks gestation tcd to to to to bpd to to to to hc to to to to fl to to to to ac to to to to hadlock to to to to intergrowth st project to to to to amanhi parsimonious formula to to to to weeks gestation tcd to to to to bpd to to to to hc to to to to fl to to to to ac to to to to hadlock to to to to intergrowth st project to to to to amanhi parsimonious formula to to to to the hadlock formula includes bpd ac and fl measurements intergrowth st project formula includes hc and fl measurements and the amanhi parsimonious method includes tcd and fl measurements tcd transcerebellar diameter bpd biparietal diameter hc head circumference fl femur length ac abdominal circumference amanhi alliance for maternal and newborn health improvement approximation refers to the midpoint between the unsigned limits of agreement and values represent the number of days plus or minus the gold standard first trimester crown rump length measurement of gestational age for biometric parameters or combinations with bias ie if the ci of the mean difference does not include the true value of gestational age compared with the estimated value from third trimester biometry will be skewed in the direction of the bias mean difference open table in a new tab the four statistical models generated from the amanhi late pregnancy dating study are shown in table model was the most accurate in predicting gestational age and included four biometric parameters model included only tcd and femur length and showed the least prediction error among the three more parsimonious models combining only two parameters after both cross validation approaches were applied appendix p table performance of newly derived alliance for maternal and newborn health improvement combination formulas for determining gestational age after weeks gestation weeks gestation weeks gestation mean difference in days ci limits of agreement in days approximation in days mean difference in days ci limits of agreement in days approximation in days model lntcd lnbpd lnfl and lnac to to to to model lntcd and lnfl to to to to model lntcd and lnbpd to to to to model lntcd and lnac to to to to tcd transcerebellar diameter bpd biparietal diameter fl femur length ac abdominal circumference hc head circumference approximation refers to the midpoint between the unsigned limits of agreement and values represent the number of days plus or minus the gold standard first trimester crown rump length measurement of gestational age for biometric parameters or combinations with bias ie if the ci of the mean difference does not include the true value of gestational age compared with the estimated value from third trimester biometry will be skewed in the direction of the bias mean difference model is the complete alliance for maternal and newborn health improvement model models evaluate combinations of fewer biometric parameters with model chosen as the alliance for maternal and newborn health improvement parsimonious model open table in a new tab the final model was fit by including tcd and femur length in a regression with the entire dataset model table formula in appendix p the prediction error appendix p is on the final model involving the entire cohort data formulas for all candidate models and their out of model prediction errors are shown in the appendix p from the ultrasound scan at weeks gestation our novel amanhi combination formula combining tcd and femur length measurements showed little improvement in the accuracy of estimating gestational age when infants were stratified by birthweight appropriate for gestational age or small for gestational age compared with previous combination formulas improving estimations by only day table however from the ultrasound scan at weeks gestation the amanhi combination formula could more accurately predict gestational age for appropriate for gestational age infants and small for gestational age infants compared with the intergrowth st project combination formula narrowing the loa to approximately weeks and with minimal bias table discussion we have identified several key findings regarding the performance of ultrasound biometry in late pregnancy in a large cohort of pregnant women in three lmic settings first it was reassuring to verify that the accuracy of late pregnancy ultrasound for estimating gestational age in our study was similar to the reported results from higher income settings where sonographer training is lengthier and includes more practical training compared with sonographer training in lmic settings biometric parameters at weeks gestation and weeks gestation alone and in combination were accurate to within approximately weeks of the gold standard crl measurement of gestational age these results are consistent with previous reports of the performance of late pregnancy biometric parameters in our study the accuracy of gestational age dating with individual biometric parameters before weeks was reasonably good approximation days to days of the standard crl measurements improving even further approximation days when individual biometric parameters were combined according to previously published formulas later scans weeks had wider individual loas approximation days as hypothesised the tcd as a single biometric parameter had the narrowest loa approximation days and even outperformed the combination formulas slightly approximation days importantly tcd also performed quite well among infants who were ultimately born small for gestational age with an accuracy of approximately days of the crl measurement of gestational age at weeks and approximately days of the crl measurement at weeks with little bias mean difference of days at both gestational age windows in summary nomograms established for measuring cerebellar size in high resource settings appear to perform well in this lmic population given the initial results showing successful performance of tcd in estimating gestational age we combined tcd with standard biometric parameters and used statistical modelling to investigate the performance of different combination formulas in the lmic study sites where the prevalence of infants born small for gestational age is high our first model combining tcd with biparietal diameter femur length and abdominal circumference narrowed the loa across the two third trimester gestational age windows to less than weeks a second parsimonious model combining only tcd and femur length performed nearly as well as the first model with the added benefit of simplicity in the number of parameters included both the femur and the cerebellum are structures that are fairly easy to identify in addition the measurements of these parameters are linear and therefore require less skill in calliper placement than circumference measurements as evidenced by the observation that these measurements were obtained successfully in of ultrasound scans in our study when compared with other published combination formulas our amanhi parsimonious model formula had the narrowest loa the least bias and performed similarly among infants born appropriate for gestational age and small for gestational age in both gestational age windows as the amanhi formulas were derived from our study population it is not surprising that they performed well even after attempting to separate model development and validation through cross validation exercises our gestational age formulas should therefore be viewed as hypothesis generating and they should be validated in other lmic populations before they are used extensively it is important to emphasise that our study included an unselected and population based cohort from three lmics at the time of enrolment the cohort therefore reflects the range of morbidities associated with pregnancy maternal nutritional status and fetal sizes that would be encountered by a health care practitioner in similar settings our cohort contrasts those used in previous studies such as the intergrowth st project cohort that were designed to measure optimal fetal growth and enrolled only healthy low risk women who were less likely to carry a growth restricted fetus these differences might help to explain why our amanhi parsimonious model outperformed both the hadlock and intergrowth st project formulas among infants who were born small for gestational age even at weeks gestation the loa of our amanhi parsimonious formula was still within days of the crl measurement of gestational age and it performed similarly among infants born with small for gestational age approximation days or appropriate for gestational age approximation days birthweights an estimation of gestational age to within approximately weeks of the standard crl measurement is a remarkable achievement for lmic settings as many women do not have an ultrasonography in the first half of pregnancy if intrauterine growth restriction is suspected measurement of cerebellar size in the third trimester could help to confirm that this is the case our study has several strengths including its large sample size and the determination of gestational age by use of gold standard first trimester crl measurements that were verified by a multilayered quality control process nonetheless there are some limitations of our study we did not evaluate the feasibility of obtaining cerebellum measurements after weeks gestation with advancing gestation shadowing from the calcified skull might preclude the accurate measurement of the tcd margins limiting its use as the pregnancy nears full term the results shown in figure suggest that accurate tcd measurements might be more difficult to obtain as the pregnancy advances as several individual data points fell below the lower loa rather than the upper loa at the week gestational age window this underestimation of gestational age by tcd in this gestational age window could reflect difficulties in measuring the full size of the cerebellar hemispheres in summary if validated in other lmic populations our novel parsimonious model for estimating gestational age in late pregnancy could be useful for research public health surveillance and clinical care our study findings might be clinically relevant for health care providers tasked with determining whether a fetus is small rather than preterm and thus might limit iatrogenic harm from unnecessary preterm delivery two important messages can be concluded from our work first cerebellar measurements using previously established nomograms from high resource settings are a useful adjunct to late pregnancy biometry measurements in lmics where the burden of infants born small for gestational age is high secondly if validated in other lmic populations a parsimonious gestational age formula requiring measurement of only two biometric parameters might narrow accuracy of late pregnancy ultrasound to within approximately weeks contributors this manuscript is the product of the who alliance for maternal and newborn health improvement late pregnancy dating study group bjw rb acl ahb fj and ss acquired funding designed the study developed the protocols and were involved in implementing the study bjw and mn led the ultrasound training and standardisation and provided ongoing ultrasound quality control fj im acl ahb sd ss ud and sa supervised patient enrolment provided oversight of daily study activities and were involved in leading the collection and management of data the daily collection and management of data was done by sb ah sj fk mk um smm and mr ra ni and nn were responsible for daily ultrasound activities and local quality control data was initially analysed and interpreted by bjw acl in sd les mi and rw with additional data interpretation done by rb ahb fj and ss bjw acl les and rb drafted the initial manuscript which was further edited reviewed revised and approved by all authors bjw and rb had full access to all of the data and the final responsibility to submit the manuscript for publication additional study members who had access to the raw data included acl in sd les mi and rw alliance for maternal and newborn health improvement study group members tanzania team collaborators tanzania saikat deb mohammed said mohammed said mohammed ali mohammed hamad juma massoud juma hassan public health laboratory ivo de carneri pemba india saikat deb usha dhingra arup dutta pratibha dixit sunil sazawal centre for public health kinetics new delhi pakistan team collaborators pakistan imran nisar muhammad ilyas usma mehmood farzana kausar shamim jaweed muhammad karim atiya hussain naila nadeem fyezah jehan aga khan university karachi bangladesh team collaborators bangladesh sayedur rahman nasreen islam ruksana azad syed mamun ibne moin salahuddin ahmed johns hopkins university bangladesh dhaka mahmoodur rahman abdul quiayum maternal and child health division international center for diarrheal disease research dhaka usa rasheda khanam abdullah h baqui department of international health johns hopkins bloomberg school of public health baltimore md coordinating team switzerland sachiyo yoshida alexander manu rajiv bahl who geneva usa anne cc lee brigham and women s hospital harvard medical school boston ma lauren e schaeffer rachel whelan brigham and women s hospital boston ma mariam naqvi ceders sinai medical center los angeles ca blair j wylie department of obstetrics and gynecology beth israel deaconess medical center boston ma harvard medical school boston ma declaration of interests ud ss fj aq ra sr mr smm ni am mn les acl and bw report grants from the bill melinda gates foundation during the conduct of the study all other authors declare no competing interests acknowledgments this study was funded by the bill melinda gates foundation opp the funder had no role in study design data collection data analysis data interpretation or writing of the report bjw received funding from the national institutes of health nih k es f d in also received funding from fogarty international centre and nih d tw acl received funding from the national institute of child health and human development k hd the results of the study were presented at the annual meeting of the society for maternal fetal medicine february in dallas tx usa we are particularly grateful to the women who participated in the study and to all research staff across the three study sites who made the project possible invensense inc borregas ave sunnyvale ca u s a tel fax website www invensense com document number ps mpu a revision release date of mpu and mpu product specification revision mpu mpu product specification document number ps mpu a revision release date of contents revision history purpose and scope product overview mpu x o verview applications features g yroscope f eatures a ccelerometer f eatures a dditional f eatures m otion p rocessing c locking electrical characteristics g yroscope s pecifications a ccelerometer s pecifications e lectrical and o ther c ommon s pecifications e lectrical s pecifications c ontinued e lectrical s pecifications c ontinued e lectrical s pecifications c ontinued i c t iming c haracterization spi t iming c haracterization mpu only a bsolute m aximum r atings applications information p in o ut and s ignal d escription t ypical o perating c ircuit b ill of m aterials for e xternal c omponents r ecommended p ower on p rocedure b lock d iagram o verview t hree a xis mems g yroscope with bit adc s and s ignal c onditioning t hree a xis mems a ccelerometer with bit adc s and s ignal c onditioning d igital m otion p rocessor p rimary i c and spi s erial c ommunications i nterfaces a uxiliary i c s erial i nterface mpu mpu product specification document number ps mpu a revision release date of s elf t est mpu x s olution for axis s ensor f usion u sing i c i nterface mpu u sing spi i nterface i nternal c lock g eneration s ensor d ata r egisters fifo i nterrupts d igital o utput t emperature s ensor b ias and ldo c harge p ump programmable interrupts digital interface i c and spi mpu only s erial i nterfaces i c i nterface i c c ommunications p rotocol i c t erms spi i nterface mpu only serial interface considerations mpu mpu s upported i nterfaces l ogic l evels l ogic l evels d iagram for aux vddio assembly o rientation of a xes p ackage d imensions pcb d esign g uidelines a ssembly p recautions s torage s pecifications p ackage m arking s pecification t ape r eel s pecification l abel p ackaging r epresentative s hipping c arton l abel reliability q ualification t est p olicy mpu mpu product specification document number ps mpu a revision release date of q ualification t est p lan environmental compliance mpu mpu product specification document number ps mpu a revision release date of revision history revision date revision description initial release for rev c parts clarified wording in sections edited supply current numbers for different modes section unit of measure for accelerometer sensitivity changed from lsb mg to lsb g updated accelerometer self test specifications in table updated package dimensions section updated pcb design guidelines section for rev d parts updated accelerometer specifications in table updated accelerometer specification note sections updated qualification test plan section edits for clarity changed operating voltage range to v v added accelerometer intelligence function increment value of mg lsb section updated absolute maximum rating for acceleration any axis unpowered from ms to ms section modified absolute maximum rating for latch up to level a and ma section updated self test response specifications for revision d parts dated with date code yyww or later edits for clarity added gyro self test sections added min max limits to accel self test response section updated accelerometer low power mode operating currents section added gyro self test to block diagram section updated packaging labels and descriptions sections updated gyro and accelerometer self test information sections updated latch up information section updated programmable interrupts information section changed shipment information from maximum of reels k units per shipper box to reels k units per shipper box section updated packing shipping and label information sections updated reliability references section updates section mpu mpu product specification document number ps mpu a revision release date of purpose and scope this product specification provides advanced information regarding the electrical specification and design related information for the mpu and mpu motiontracking devices collectively called the mpu x or mpu electrical characteristics are based upon design analysis and simulation results only specifications are subject to change without notice final specifications will be updated based upon characterization of production silicon for references to register map and descriptions of individual registers please refer to the mpu mpu register map and register descriptions document the self test response specifications provided in this document pertain to revision d parts with date codes of yyww or later please see section for package marking description details mpu mpu product specification document number ps mpu a revision release date of product overview mpu x overview motioninterface is becoming a must have function being adopted by smartphone and tablet manufacturers due to the enormous value it adds to the end user experience in smartphones it finds use in applications such as gesture commands for applications and phone control enhanced gaming augmented reality panoramic photo capture and viewing and pedestrian and vehicle navigation with its ability to precisely and accurately track user motions motiontracking technology can convert handsets and tablets into powerful d intelligent devices that can be used in applications ranging from health and fitness monitoring to location based services key requirements for motioninterface enabled devices are small package size low power consumption high accuracy and repeatability high shock tolerance and application specific performance programmability all at a low consumer price point the mpu x is the world s first integrated axis motiontracking device that combines a axis gyroscope axis accelerometer and a digital motion processor dmp all in a small x x mm package with its dedicated i c sensor bus it directly accepts inputs from an external axis compass to provide a complete axis motionfusion output the mpu x motiontracking device with its axis integration on board motionfusion and run time calibration firmware enables manufacturers to eliminate the costly and complex selection qualification and system level integration of discrete devices guaranteeing optimal motion performance for consumers the mpu x is also designed to interface with multiple non inertial digital sensors such as pressure sensors on its auxiliary i c port the mpu x is footprint compatible with the mpu x family the mpu x features three bit analog to digital converters adcs for digitizing the gyroscope outputs and three bit adcs for digitizing the accelerometer outputs for precision tracking of both fast and slow motions the parts feature a user programmable gyroscope full scale range of and sec dps and a user programmable accelerometer full scale range of g g g and g an on chip byte fifo buffer helps lower system power consumption by allowing the system processor to read the sensor data in bursts and then enter a low power mode as the mpu collects more data with all the necessary on chip processing and sensor components required to support many motion based use cases the mpu x uniquely enables low power motioninterface applications in portable applications with reduced processing requirements for the system processor by providing an integrated motionfusion output the dmp in the mpu x offloads the intensive motionprocessing computation requirements from the system processor minimizing the need for frequent polling of the motion sensor output communication with all registers of the device is performed using either i c at khz or spi at mhz mpu only for applications requiring faster communications the sensor and interrupt registers may be read using spi at mhz mpu only additional features include an embedded temperature sensor and an on chip oscillator with variation over the operating temperature range by leveraging its patented and volume proven nasiri fabrication platform which integrates mems wafers with companion cmos electronics through wafer level bonding invensense has driven the mpu x package size down to a revolutionary footprint of x x mm qfn while providing the highest performance lowest noise and the lowest cost semiconductor packaging required for handheld consumer electronic devices the part features a robust g shock tolerance and has programmable low pass filters for the gyroscopes accelerometers and the on chip temperature sensor for power supply flexibility the mpu x operates from vdd power supply voltage range of v v additionally the mpu provides a vlogic reference pin in addition to its analog supply pin vdd which sets the logic levels of its i c interface the vlogic voltage may be v or vdd the mpu and mpu are identical except that the mpu supports the i c serial interface only and has a separate vlogic reference pin the mpu supports both i c and spi interfaces and has a single supply pin vdd which is both the device s logic reference supply and the analog supply for the part the table below outlines these differences mpu mpu product specification document number ps mpu a revision release date of primary differences between mpu and mpu part item mpu mpu vdd v v v v vlogic n a v to vdd serial interfaces supported i c spi i c pin cs vlogic pin ad sdo ad pin scl sclk scl pin sda sdi sda mpu mpu product specification document number ps mpu a revision release date of applications blurfree technology for video still image stabilization airsign technology for security authentication touchanywhere technology for no touch ui application control navigation motioncommand technology for gesture short cuts motion enabled game and application framework instantgesture ig gesture recognition location based services points of interest and dead reckoning handset and portable gaming motion based game controllers d remote controls for internet connected dtvs and set top boxes d mice wearable sensors for health fitness and sports toys mpu mpu product specification document number ps mpu a revision release date of features gyroscope features the triple axis mems gyroscope in the mpu x includes a wide range of features digital output x y and z axis angular rate sensors gyroscopes with a user programmable full scale range of and sec external sync signal connected to the fsync pin supports image video and gps synchronization integrated bit adcs enable simultaneous sampling of gyros enhanced bias and sensitivity temperature stability reduces the need for user calibration improved low frequency noise performance digitally programmable low pass filter gyroscope operating current ma standby current a factory calibrated sensitivity scale factor user self test accelerometer features the triple axis mems accelerometer in mpu x includes a wide range of features digital output triple axis accelerometer with a programmable full scale range of g g g and g integrated bit adcs enable simultaneous sampling of accelerometers while requiring no external multiplexer accelerometer normal operating current a low power accelerometer mode current a at hz a at hz a at hz a at hz orientation detection and signaling tap detection user programmable interrupts high g interrupt user self test additional features the mpu x includes the following additional features axis motionfusion by the on chip digital motion processor dmp auxiliary master i c bus for reading data from external sensors e g magnetometer ma operating current when all motion sensing axes and the dmp are enabled vdd supply voltage range of v v flexible vlogic reference voltage supports multiple i c interface voltages mpu only smallest and thinnest qfn package for portable devices x x mm minimal cross axis sensitivity between the accelerometer and gyroscope axes byte fifo buffer reduces power consumption by allowing host processor to read the data in bursts and then go into a low power mode as the mpu collects more data digital output temperature sensor user programmable digital filters for gyroscope accelerometer and temp sensor g shock tolerant khz fast mode i c for communicating with all registers mhz spi serial interface for communicating with all registers mpu only mhz spi serial interface for reading sensor and interrupt registers mpu only mpu mpu product specification document number ps mpu a revision release date of mems structure hermetically sealed and bonded at wafer level rohs and green compliant motionprocessing internal digital motion processing dmp engine supports d motionprocessing and gesture recognition algorithms the mpu x collects gyroscope and accelerometer data while synchronizing data sampling at a user defined rate the total dataset obtained by the mpu x includes axis gyroscope data axis accelerometer data and temperature data the mpu s calculated output to the system processor can also include heading data from a digital axis third party magnetometer the fifo buffers the complete data set reducing timing requirements on the system processor by allowing the processor burst read the fifo data after burst reading the fifo data the system processor can save power by entering a low power sleep mode while the mpu collects more data programmable interrupt supports features such as gesture recognition panning zooming scrolling tap detection and shake detection digitally programmable low pass filters low power pedometer functionality allows the host processor to sleep while the dmp maintains the step count clocking on chip timing generator frequency variation over full temperature range optional external clock inputs of khz or mhz mpu mpu product specification document number ps mpu a revision release date of electrical characteristics gyroscope specifications vdd v v vlogic mpu only v or vdd t a c parameter conditions min typ max units notes gyroscope sensitivity full scale range fs sel s fs sel s fs sel s fs sel s gyroscope adc word length bits sensitivity scale factor fs sel lsb s fs sel lsb s fs sel lsb s fs sel lsb s sensitivity scale factor tolerance c sensitivity scale factor variation over temperature nonlinearity best fit straight line c cross axis sensitivity gyroscope zero rate output zro initial zro tolerance c s zro variation over temperature c to c s power supply sensitivity hz sine wave mvpp vdd v s power supply sensitivity hz sine wave mvpp vdd v s power supply sensitivity hz khz sine wave mvpp vdd v s linear acceleration sensitivity static s g self test response relative change from factory trim gyroscope noise performance fs sel total rms noise dlpfcfg hz s rms low frequency rms noise bandwidth hz to hz s rms rate noise spectral density at hz s hz gyroscope mechanical frequencies x axis khz y axis khz z axis khz low pass filter response programmable range hz output data rate programmable hz gyroscope start up time dlpfcfg zro settling from power on to s of final ms please refer to the following document for further information on self test mpu mpu register map and descriptions mpu mpu product specification document number ps mpu a revision release date of accelerometer specifications vdd v v vlogic mpu only v or vdd t a c parameter conditions min typ max units notes accelerometer sensitivity full scale range afs sel g afs sel g afs sel g afs sel g adc word length output in two s complement format bits sensitivity scale factor afs sel lsb g afs sel lsb g afs sel lsb g afs sel lsb g initial calibration tolerance sensitivity change vs temperature afs sel c to c c nonlinearity best fit straight line cross axis sensitivity zero g output initial calibration tolerance x and y axes mg z axis mg zero g level change vs temperature x and y axes c to c z axis c to c mg self test response relative change from factory trim noise performance power spectral density hz afs sel odr khz g hz low pass filter response programmable range hz output data rate programmable range hz intelligence function increment mg lsb typical zero g initial calibration tolerance value after msl preconditioning please refer to the following document for further information on self test mpu mpu register map and descriptions mpu mpu product specification document number ps mpu a revision release date of electrical and other common specifications vdd v v vlogic mpu only v or vdd t a c parameter conditions min typ max units notes temperature sensor range to c sensitivity untrimmed lsb c temperature offset o c lsb linearity best fit straight line c to c c vdd power supply operating voltages v normal operating current gyroscope accelerometer dmp ma gyroscope accelerometer dmp disabled ma gyroscope dmp accelerometer disabled ma gyroscope only dmp accelerometer disabled ma accelerometer only dmp gyroscope disabled a accelerometer low power mode current hz update rate a hz update rate a hz update rate a hz update rate a full chip idle mode supply current a power supply ramp rate monotonic ramp ramp rate is to of the final value ms vlogic reference voltage mpu only voltage range vlogic must be vdd at all times vdd v power supply ramp rate monotonic ramp ramp rate is to of the final value ms normal operating current a temperature range specified temperature range performance parameters are not applicable beyond specified temperature range c mpu mpu product specification document number ps mpu a revision release date of electrical specifications continued vdd v v vlogic mpu only v or vdd t a c parameter conditions min typ max units notes serial interface spi operating frequency all registers read write mpu only low speed characterization khz mpu only high speed characterization mhz spi operating frequency sensor and interrupt registers read only mpu only mhz i c operating frequency all registers fast mode khz all registers standard mode khz i c address ad ad digital inputs sdi sda ad sclk scl fsync cs clkin v ih high level input voltage mpu vdd v mpu vlogic v v il low level input voltage mpu vdd v mpu vlogic v c i input capacitance pf digital output sdo int v oh high level output voltage r load m mpu vdd v r load m mpu vlogic v v ol low level output voltage r load m mpu vdd v r load m mpu vlogic v v ol int int low level output voltage open ma sink current v output leakage current open na t int int pulse width latch int en s mpu mpu product specification document number ps mpu a revision release date of electrical specifications continued typical operating circuit of section vdd v v vlogic mpu only v or vdd t a c parameters conditions typical units notes primary i c i o scl sda v il low level input voltage mpu to vdd v v ih high level input voltage mpu vdd to vdd v v v hys hysteresis mpu vdd v vil low level input voltage mpu v to vlogic v vih high level input voltage mpu vlogic to vlogic v v vhys hysteresis mpu vlogic v v ol low level output voltage ma sink current to v i ol low level output current v ol v ma v ol v ma output leakage current na t of output fall time from v ihmax to v ilmax c b bus capacitance in pf c b to ns c i capacitance for each i o pin pf auxiliary i c i o aux cl aux da mpu aux vddio v il low level input voltage v to vlogic v v ih high level input voltage vlogic to vlogic v v v hys hysteresis vlogic v v ol low level output voltage vlogic v ma sink current to v v ol low level output voltage vlogic v ma sink current to vlogic v i ol low level output current v ol v v ol v ma ma output leakage current na t of output fall time from v ihmax to v ilmax c b bus capacitance in pf c b to ns c i capacitance for each i o pin pf mpu mpu product specification document number ps mpu a revision release date of electrical specifications continued typical operating circuit of section vdd v v vlogic mpu only v or vdd t a c parameters conditions min typical max units notes internal clock source clk sel gyroscope sample rate fast dlpfcfg sampleratediv khz gyroscope sample rate slow dlpfcfg or sampleratediv khz accelerometer sample rate khz clock frequency initial tolerance clk sel c clk sel c frequency variation over temperature clk sel to clk sel pll settling time clk sel ms external khz clock clk sel external clock frequency khz external clock allowable jitter cycle to cycle rms to s gyroscope sample rate fast dlpfcfg sampleratediv khz gyroscope sample rate slow dlpfcfg or sampleratediv khz accelerometer sample rate khz pll settling time ms external mhz clock clk sel external clock frequency mhz gyroscope sample rate full programmable range hz gyroscope sample rate fast mode dlpfcfg sampleratediv khz gyroscope sample rate slow mode dlpfcfg or sampleratediv khz accelerometer sample rate khz pll settling time ms mpu mpu product specification document number ps mpu a revision release date of i c timing characterization typical operating circuit of section vdd v v vlogic mpu only v or vdd t a c parameters conditions min typical max units notes i c timing i c fast mode f scl scl clock frequency khz t hd sta repeated start condition hold time s t low scl low period s t high scl high period s t su sta repeated start condition setup time s t hd dat sda data hold time s t su dat sda data setup time ns t r sda and scl rise time c b bus cap from to pf c b ns t f sda and scl fall time c b bus cap from to pf c b ns t su sto stop condition setup time s t buf bus free time between stop and start condition s c b capacitive load for each bus line pf t vd dat data valid time s t vd ack data valid acknowledge time s note timing characteristics apply to both primary and auxiliary i c bus i c bus timing diagram mpu mpu product specification document number ps mpu a revision release date of spi timing characterization mpu only typical operating circuit of section vdd v v vlogic mpu only v or vdd t a c unless otherwise noted parameters conditions min typical max units notes spi timing f sclk sclk clock frequency mhz t low sclk low period ns t high sclk high period ns t su cs cs setup time ns t hd cs cs hold time ns t su sdi sdi setup time ns t hd sdi sdi hold time ns t vd sdo sdo valid time c load pf ns t hd sdo sdo hold time c load pf ns t dis sdo sdo output disable time ns spi bus timing diagram mpu mpu product specification document number ps mpu a revision release date of absolute maximum ratings stress above those listed as absolute maximum ratings may cause permanent damage to the device these are stress ratings only and functional operation of the device at these conditions is not implied exposure to the absolute maximum ratings conditions for extended periods may affect device reliability parameter rating supply voltage vdd v to v vlogic input voltage level mpu v to vdd v regout v to v input voltage level clkin aux da ad fsync int scl sda v to vdd v cpout v vdd v v to v acceleration any axis unpowered g for ms operating temperature range c to c storage temperature range c to c electrostatic discharge esd protection kv hbm v mm latch up jedec class ii c ma mpu mpu product specification document number ps mpu a revision release date of applications information pin out and signal description pin number mpu mpu pin name pin description y y clkin optional external reference clock input connect to gnd if unused y y aux da i c master serial data for connecting to external sensors y y aux cl i c master serial clock for connecting to external sensors y cs spi chip select spi mode y vlogic digital i o supply voltage y ad sdo i c slave address lsb ad spi serial data output sdo y ad i c slave address lsb ad y y regout regulator filter capacitor connection y y fsync frame synchronization digital input connect to gnd if unused y y int interrupt digital output totem pole or open drain y y vdd power supply voltage and digital i o supply voltage y y gnd power supply ground y y resv reserved do not connect y y cpout charge pump capacitor connection y y resv reserved do not connect y scl sclk i c serial clock scl spi serial clock sclk y scl i c serial clock scl y sda sdi i c serial data sda spi serial data input sdi y sda i c serial data sda y y nc not internally connected may be used for pcb trace routing mpu mpu z x y aux cl vlogic ad regout fsync int nc nc nc vdd nc gnd nc nc nc aux da nc clkin resv cpout resv resv scl sda mpu qfn package pin mm x mm x mm orientation of axes of sensitivity and polarity of rotation top view z y x aux cl cs ad sdo regout fsync int nc nc nc vdd nc gnd nc nc nc aux da nc clkin resv cpout resv resv scl sclk sda sdi mpu qfn package pin mm x mm x mm top view mpu mpu product specification document number ps mpu a revision release date of typical operating circuit ad sdo typical operating circuits mpu clkin cs gnd gnd gnd fsync int gnd vdd scl sclk sda sdi c nf c f c f ad mpu clkin gnd gnd gnd fsync int gnd vdd scl sda c nf c f c f gnd vlogic c nf aux cl aux da aux cl aux da bill of materials for external components component label specification quantity regulator filter capacitor pin c ceramic x r f v vdd bypass capacitor pin c ceramic x r f v charge pump capacitor pin c ceramic x r nf v vlogic bypass capacitor pin c ceramic x r nf v mpu only mpu mpu product specification document number ps mpu a revision release date of recommended power on procedure t vlgr vlogic vdd t vddr all voltages at v power up sequencing vlogic amplitude must always be vdd amplitude t vddr is vdd rise time time for vdd to rise from to of its final value t vddr is ms t vlgr is vlogic rise time time for vlogic to rise from to of its final value t vlgr is ms t vlg vdd is the delay from the start of vdd ramp to the start of vlogic rise t vlg vdd is vdd and vlogic must be monotonic ramps t vlg vdd mpu mpu product specification document number ps mpu a revision release date of block diagram clock mpu x charge pump cs ad sdo scl sclk sda sdi temp sensor adc adc z gyro adc y gyro digital motion processor dmp fsync slave i c and spi serial interface master i c serial interface clock cpout serial interface bypass mux aux cl aux da int factory calibration interrupt status register vdd bias ldo gnd regout note pin names in round brackets apply only to mpu pin names in square brackets apply only to mpu z accel y accel x accel adc adc adc clkin clkout adc x gyro signal conditioning fifo config registers sensor registers self test vlogic self test self test self test self test self test overview the mpu x is comprised of the following key blocks and functions three axis mems rate gyroscope sensor with bit adcs and signal conditioning three axis mems accelerometer sensor with bit adcs and signal conditioning digital motion processor dmp engine primary i c and spi mpu only serial communications interfaces auxiliary i c serial interface for rd party magnetometer other sensors clocking sensor data registers fifo interrupts digital output temperature sensor gyroscope accelerometer self test bias and ldo charge pump mpu mpu product specification document number ps mpu a revision release date of three axis mems gyroscope with bit adcs and signal conditioning the mpu x consists of three independent vibratory mems rate gyroscopes which detect rotation about the x y and z axes when the gyros are rotated about any of the sense axes the coriolis effect causes a vibration that is detected by a capacitive pickoff the resulting signal is amplified demodulated and filtered to produce a voltage that is proportional to the angular rate this voltage is digitized using individual on chip bit analog to digital converters adcs to sample each axis the full scale range of the gyro sensors may be digitally programmed to or degrees per second dps the adc sample rate is programmable from samples per second down to samples per second and user selectable low pass filters enable a wide range of cut off frequencies three axis mems accelerometer with bit adcs and signal conditioning the mpu x s axis accelerometer uses separate proof masses for each axis acceleration along a particular axis induces displacement on the corresponding proof mass and capacitive sensors detect the displacement differentially the mpu x s architecture reduces the accelerometers susceptibility to fabrication variations as well as to thermal drift when the device is placed on a flat surface it will measure g on the x and y axes and g on the z axis the accelerometers scale factor is calibrated at the factory and is nominally independent of supply voltage each sensor has a dedicated sigma delta adc for providing digital outputs the full scale range of the digital output can be adjusted to g g g or g digital motion processor the embedded digital motion processor dmp is located within the mpu x and offloads computation of motion processing algorithms from the host processor the dmp acquires data from accelerometers gyroscopes and additional rd party sensors such as magnetometers and processes the data the resulting data can be read from the dmp s registers or can be buffered in a fifo the dmp has access to one of the mpu s external pins which can be used for generating interrupts the purpose of the dmp is to offload both timing requirements and processing power from the host processor typically motion processing algorithms should be run at a high rate often around hz in order to provide accurate results with low latency this is required even if the application updates at a much lower rate for example a low power user interface may update as slowly as hz but the motion processing should still run at hz the dmp can be used as a tool in order to minimize power simplify timing simplify the software architecture and save valuable mips on the host processor for use in the application primary i c and spi serial communications interfaces the mpu x communicates to a system processor using either a spi mpu only or an i c serial interface the mpu x always acts as a slave when communicating to the system processor the lsb of the of the i c slave address is set by pin ad the logic levels for communications between the mpu x and its master are as follows mpu the logic level for communications with the master is set by the voltage on vdd mpu the logic level for communications with the master is set by the voltage on vlogic for further information regarding the logic levels of the mpu please refer to section mpu mpu product specification document number ps mpu a revision release date of auxiliary i c serial interface the mpu x has an auxiliary i c bus for communicating to an off chip axis digital output magnetometer or other sensors this bus has two operating modes i c master mode the mpu x acts as a master to any external sensors connected to the auxiliary i c bus pass through mode the mpu x directly connects the primary and auxiliary i c buses together allowing the system processor to directly communicate with any external sensors auxiliary i c bus modes of operation i c master mode allows the mpu x to directly access the data registers of external digital sensors such as a magnetometer in this mode the mpu x directly obtains data from auxiliary sensors allowing the on chip dmp to generate sensor fusion data without intervention from the system applications processor for example in i c master mode the mpu x can be configured to perform burst reads returning the following data from a magnetometer x magnetometer data bytes y magnetometer data bytes z magnetometer data bytes the i c master can be configured to read up to bytes from up to auxiliary sensors a fifth sensor can be configured to work single byte read write mode pass through mode allows an external system processor to act as master and directly communicate to the external sensors connected to the auxiliary i c bus pins aux da and aux cl in this mode the auxiliary i c bus control logic rd party sensor interface block of the mpu x is disabled and the auxiliary i c pins aux da and aux cl pins and are connected to the main i c bus pins and through analog switches pass through mode is useful for configuring the external sensors or for keeping the mpu x in a low power mode when only the external sensors are used in pass through mode the system processor can still access mpu x data through the i c interface auxiliary i c bus io logic levels mpu the logic level of the auxiliary i c bus is vdd mpu the logic level of the auxiliary i c bus can be programmed to be either vdd or vlogic for further information regarding the mpu s logic levels please refer to section mpu mpu product specification document number ps mpu a revision release date of self test please refer to the mpu mpu register map and register descriptions document for more details on self test self test allows for the testing of the mechanical and electrical portions of the sensors the self test for each measurement axis can be activated by means of the gyroscope and accelerometer self test registers registers to when self test is activated the electronics cause the sensors to be actuated and produce an output signal the output signal is used to observe the self test response the self test response is defined as follows self test response sensor output with self test enabled sensor output without self test enabled the self test response for each accelerometer axis is defined in the accelerometer specification table section while that for each gyroscope axis is defined in the gyroscope specification table section when the value of the self test response is within the min max limits of the product specification the part has passed self test when the self test response exceeds the min max values the part is deemed to have failed self test code for operating self test code is included within the motionapps software provided by invensense mpu mpu product specification document number ps mpu a revision release date of mpu x solution for axis sensor fusion using i c interface in the figure below the system processor is an i c master to the mpu x in addition the mpu x is an i c master to the optional external compass sensor the mpu x has limited capabilities as an i c master and depends on the system processor to manage the initial configuration of any auxiliary sensors the mpu x has an interface bypass multiplexer which connects the system processor i c bus pins and sda and scl directly to the auxiliary sensor i c bus pins and aux da and aux cl once the auxiliary sensors have been configured by the system processor the interface bypass multiplexer should be disabled so that the mpu x auxiliary i c master can take control of the sensor i c bus and gather data from the auxiliary sensors for further information regarding i c master control please refer to section mpu x ad sdo scl sclk sda sdi digital motion processor dmp sensor master i c serial interface aux cl aux da interrupt status register int vdd bias ldo gnd regout fifo config register sensor register factory calibration cs slave i c or spi serial interface compass scl sda system processor interface bypass mux scl sda vdd vdd or gnd i c processor bus for reading all sensor data from mpu and for configuring external sensors i e compass in this example interface bypass mux allows direct configuration of compass by system processor optional sensor i c bus for configuring and reading from external sensors mpu mpu product specification document number ps mpu a revision release date of mpu using spi interface in the figure below the system processor is an spi master to the mpu pins and are used to support the cs sdo sclk and sdi signals for spi communications because these spi pins are shared with the i c slave pins and the system processor cannot access the auxiliary i c bus through the interface bypass multiplexer which connects the processor i c interface pins to the sensor i c interface pins since the mpu has limited capabilities as an i c master and depends on the system processor to manage the initial configuration of any auxiliary sensors another method must be used for programming the sensors on the auxiliary sensor i c bus pins and aux da and aux cl when using spi communications between the mpu and the system processor configuration of devices on the auxiliary i c sensor bus can be achieved by using i c slaves to perform read and write transactions on any device and register on the auxiliary i c bus the i c slave interface can be used to perform only single byte read and write transactions once the external sensors have been configured the mpu can perform single or multi byte reads using the sensor i c bus the read results from the slave controllers can be written to the fifo buffer as well as to the external sensor registers for further information regarding the control of the mpu x s auxiliary i c interface please refer to the mpu mpu register map and register descriptions document mpu ad sdo scl sclk sda sdi digital motion processor dmp sensor master i c serial interface interrupt status register int vdd bias ldo gnd regout fifo config register sensor register factory calibration cs slave i c or spi serial interface system processor interface bypass mux sdi sclk sdo cs processor spi bus for reading all data from mpu and for configuring mpu and external sensors aux cl aux da compass scl sda optional i c master performs read and write transactions on sensor i c bus sensor i c bus for configuring and reading data from external sensors mpu mpu product specification document number ps mpu a revision release date of internal clock generation the mpu x has a flexible clocking scheme allowing a variety of internal or external clock sources to be used for the internal synchronous circuitry this synchronous circuitry includes the signal conditioning and adcs the dmp and various control circuits and registers an on chip pll provides flexibility in the allowable inputs for generating this clock allowable internal sources for generating the internal clock are an internal relaxation oscillator any of the x y or z gyros mems oscillators with a variation of over temperature allowable external clocking sources are khz square wave mhz square wave selection of the source for generating the internal synchronous clock depends on the availability of external sources and the requirements for power consumption and clock accuracy these requirements will most likely vary by mode of operation for example in one mode where the biggest concern is power consumption the user may wish to operate the digital motion processor of the mpu x to process accelerometer data while keeping the gyros off in this case the internal relaxation oscillator is a good clock choice however in another mode where the gyros are active selecting the gyros as the clock source provides for a more accurate clock source clock accuracy is important since timing errors directly affect the distance and angle calculations performed by the digital motion processor and by extension by any processor there are also start up conditions to consider when the mpu x first starts up the device uses its internal clock until programmed to operate from another source this allows the user for example to wait for the mems oscillators to stabilize before they are selected as the clock source sensor data registers the sensor data registers contain the latest gyro accelerometer auxiliary sensor and temperature measurement data they are read only registers and are accessed via the serial interface data from these registers may be read anytime however the interrupt function may be used to determine when new data is available for a table of interrupt sources please refer to section fifo the mpu x contains a byte fifo register that is accessible via the serial interface the fifo configuration register determines which data is written into the fifo possible choices include gyro data accelerometer data temperature readings auxiliary sensor readings and fsync input a fifo counter keeps track of how many bytes of valid data are contained in the fifo the fifo register supports burst reads the interrupt function may be used to determine when new data is available for further information regarding the fifo please refer to the mpu mpu register map and register descriptions document interrupts interrupt functionality is configured via the interrupt configuration register items that are configurable include the int pin configuration the interrupt latching and clearing method and triggers for the interrupt items that can trigger an interrupt are clock generator locked to new reference oscillator used when switching clock mpu mpu product specification document number ps mpu a revision release date of sources new data is available to be read from the fifo and data registers accelerometer event interrupts and the mpu x did not receive an acknowledge from an auxiliary sensor on the secondary i c bus the interrupt status can be read from the interrupt status register for further information regarding interrupts please refer to the mpu x register map and register descriptions document for information regarding the mpu x s accelerometer event interrupts please refer to section digital output temperature sensor an on chip temperature sensor and adc are used to measure the mpu x die temperature the readings from the adc can be read from the fifo or the sensor data registers bias and ldo the bias and ldo section generates the internal supply and the reference voltages and currents required by the mpu x its two inputs are an unregulated vdd of to v and a vlogic logic reference supply voltage of v to vdd mpu only the ldo output is bypassed by a capacitor at regout for further details on the capacitor please refer to the bill of materials for external components section charge pump an on board charge pump generates the high voltage required for the mems oscillators its output is bypassed by a capacitor at cpout for further details on the capacitor please refer to the bill of materials for external components section mpu mpu product specification document number ps mpu a revision release date of programmable interrupts the mpu x has a programmable interrupt system which can generate an interrupt signal on the int pin status flags indicate the source of an interrupt interrupt sources may be enabled and disabled individually table of interrupt sources interrupt name module fifo overflow fifo data ready sensor registers i c master errors lost arbitration nacks i c master i c slave i c master for information regarding the interrupt enable disable registers and flag registers please refer to the mpu mpu register map and register descriptions document some interrupt sources are explained below mpu mpu product specification document number ps mpu a revision release date of digital interface i c and spi mpu only serial interfaces the internal registers and memory of the mpu mpu can be accessed using either i c at khz or spi at mhz mpu only spi operates in four wire mode serial interface pin number mpu mpu pin name pin description y cs spi chip select spi enable y vlogic digital i o supply voltage vlogic must be vdd at all times y ad sdo i c slave address lsb ad spi serial data output sdo y ad i c slave address lsb y scl sclk i c serial clock scl spi serial clock sclk y scl i c serial clock y sda sdi i c serial data sda spi serial data input sdi y sda i c serial data note to prevent switching into i c mode when using spi mpu the i c interface should be disabled by setting the i c if dis configuration bit setting this bit should be performed immediately after waiting for the time specified by the start up time for register read write in section for further information regarding the i c if dis bit please refer to the mpu mpu register map and register descriptions document i c interface i c is a two wire interface comprised of the signals serial data sda and serial clock scl in general the lines are open drain and bi directional in a generalized i c interface implementation attached devices can be a master or a slave the master device puts the slave address on the bus and the slave device with the matching address acknowledges the master the mpu x always operates as a slave device when communicating to the system processor which thus acts as the master sda and scl lines typically need pull up resistors to vdd the maximum bus speed is khz the slave address of the mpu x is b x which is bits long the lsb bit of the bit address is determined by the logic level on pin ad this allows two mpu x s to be connected to the same i c bus when used in this configuration the address of the one of the devices should be b pin ad is logic low and the address of the other should be b pin ad is logic high i c communications protocol start s and stop p conditions communication on the i c bus starts when the master puts the start condition s on the bus which is defined as a high to low transition of the sda line while scl line is high see figure below the bus is considered to be busy until the master puts a stop condition p on the bus which is defined as a low to high transition on the sda line while scl is high see figure below mpu mpu product specification document number ps mpu a revision release date of additionally the bus remains busy if a repeated start sr is generated instead of a stop condition sda scl s start condition stop condition p start and stop conditions data format acknowledge i c data bytes are defined to be bits long there is no restriction to the number of bytes transmitted per data transfer each byte transferred must be followed by an acknowledge ack signal the clock for the acknowledge signal is generated by the master while the receiver generates the actual acknowledge signal by pulling down sda and holding it low during the high portion of the acknowledge clock pulse if a slave is busy and cannot transmit or receive another byte of data until some other task has been performed it can hold scl low thus forcing the master into a wait state normal data transfer resumes when the slave is ready and releases the clock line refer to the following figure data output by transmitter sda data output by receiver sda scl from master start condition clock pulse for acknowledgement acknowledge not acknowledge acknowledge on the i c bus mpu mpu product specification document number ps mpu a revision release date of communications after beginning communications with the start condition s the master sends a bit slave address followed by an th bit the read write bit the read write bit indicates whether the master is receiving data from or is writing to the slave device then the master releases the sda line and waits for the acknowledge signal ack from the slave device each byte transferred must be followed by an acknowledge bit to acknowledge the slave device pulls the sda line low and keeps it low for the high period of the scl line data transmission is always terminated by the master with a stop condition p thus freeing the communications line however the master can generate a repeated start condition sr and address another slave without first generating a stop condition p a low to high transition on the sda line while scl is high defines the stop condition all sda changes should take place when scl is low with the exception of start and stop conditions sda start condition scl address r w ack data ack data ack stop condition s p complete i c data transfer to write the internal mpu x registers the master transmits the start condition s followed by the i c address and the write bit at the th clock cycle when the clock is high the mpu x acknowledges the transfer then the master puts the register address ra on the bus after the mpu x acknowledges the reception of the register address the master puts the register data onto the bus this is followed by the ack signal and data transfer may be concluded by the stop condition p to write multiple bytes after the last ack signal the master can continue outputting data rather than transmitting a stop signal in this case the mpu x automatically increments the register address and loads the data to the appropriate register the following figures show single and two byte write sequences single byte write sequence burst write sequence master s ad w ra data p slave ack ack ack master s ad w ra data data p slave ack ack ack ack mpu mpu product specification document number ps mpu a revision release date of to read the internal mpu x registers the master sends a start condition followed by the i c address and a write bit and then the register address that is going to be read upon receiving the ack signal from the mpu x the master transmits a start signal followed by the slave address and read bit as a result the mpu x sends an ack signal and the data the communication ends with a not acknowledge nack signal and a stop bit from master the nack condition is defined such that the sda line remains high at the th clock cycle the following figures show single and two byte read sequences single byte read sequence burst read sequence i c terms signal description s start condition sda goes from high to low while scl is high ad slave i c address w write bit r read bit ack acknowledge sda line is low while the scl line is high at the th clock cycle nack not acknowledge sda line stays high at the th clock cycle ra mpu x internal register address data transmit or received data p stop condition sda going from low to high while scl is high master s ad w ra s ad r nack p slave ack ack ack data master s ad w ra s ad r ack nack p slave ack ack ack data data mpu mpu product specification document number ps mpu a revision release date of spi interface mpu only spi is a wire synchronous serial interface that uses two control lines and two data lines the mpu always operates as a slave device during standard master slave spi operation with respect to the master the serial clock output sclk the serial data output sdo and the serial data input sdi are shared among the slave devices each spi slave device requires its own chip select cs line from the master cs goes low active at the start of transmission and goes back high inactive at the end only one cs line is active at a time ensuring that only one slave is selected at any given time the cs lines of the non selected slave devices are held high causing their sdo lines to remain in a high impedance high z state so that they do not interfere with any active devices spi operational features data is delivered msb first and lsb last data is latched on the rising edge of sclk data should be transitioned on the falling edge of sclk the maximum frequency of sclk is mhz spi read and write operations are completed in or more clock cycles two or more bytes the first byte contains the spi address and the following byte s contain s the spi data the first bit of the first byte contains the read write bit and indicates the read or write operation the following bits contain the register address in cases of multiple byte read writes data is two or more bytes spi address format msb lsb r w a a a a a a a spi data format msb lsb d d d d d d d d supports single or burst read writes typical spi master slave configuration spi master spi slave spi slave cs cs sclk sdi sdo cs sclk sdi sdo cs mpu mpu product specification document number ps mpu a revision release date of serial interface considerations mpu mpu supported interfaces the mpu supports i c communications on both its primary microprocessor serial interface and its auxiliary interface logic levels the mpu s i o logic levels are set to be vlogic as shown in the table below aux vddio must be set to i o logic levels vs aux vddio aux vddio microprocessor logic levels pins sda scl ad clkin int auxillary logic levels pins aux da aux cl vlogic vlogic note the power on reset value for aux vddio is when aux vddio is set to its power on reset value vlogic is the power supply voltage for both the microprocessor system bus and the auxiliary i c bus as shown in the figure of section mpu mpu product specification document number ps mpu a revision release date of logic levels diagram for aux vddio the figure below depicts a sample circuit with a third party magnetometer attached to the auxiliary i c bus it shows logic levels and voltage connections for aux vddio note actual configuration will depend on the auxiliary sensors used mpu rd party magnetometer sda aux cl scl aux da vdd io vdd sa int int system processor io clkin system bus vlogic vlogic vlogic vdd vlogic v vlogic scl sda int fsync vlogic ad v vlogic v vlogic v vlogic v vlogic v vlogic v vlogic v vlogic v vlogic v vlogic v vlogic v vlogic cs v vlogic vdd io i o levels and connections for aux vddio notes aux vddio determines the io voltage levels of aux da and aux cl set output levels relative to vlogic all other mpu logic ios are referenced to vlogic mpu mpu product specification document number ps mpu a revision release date of assembly this section provides general guidelines for assembling invensense micro electro mechanical systems mems gyros packaged in quad flat no leads package qfn surface mount integrated circuits orientation of axes the diagram below shows the orientation of the axes of sensitivity and the polarity of rotation note the pin identifier in the figure mpu mpu z x y orientation of axes of sensitivity and polarity of rotation z y x mpu mpu product specification document number ps mpu a revision release date of package dimensions lead qfn x x mm nipdau lead frame finish symbols dimensions in millimeters min nom max a a b c ref d d e e e f e b k l l s co d d e pin identifier is a laser marked feature on top e b c a a on corners lead dimensions s s l e l f mpu mpu product specification document number ps mpu a revision release date of pcb design guidelines the pad diagram using a jedec type extension with solder rising on the outer edge is shown below the pad dimensions table shows pad sizing mean dimensions recommended for the mpu x product jedec type extension with solder rising on outer edge pcb layout diagram symbols dimensions in millimeters nom nominal package i o pad dimensions e pad pitch b pad width l pad length l pad length d package width e package length d exposed pad width e exposed pad length i o land design dimensions guidelines d i o pad extent width e i o pad extent length c land width tout outward extension tin inward extension l land length l land length pcb dimensions table for pcb lay out diagram mpu mpu product specification document number ps mpu a revision release date of assembly precautions gyroscope surface mount guidelines invensense mems gyros sense rate of rotation in addition gyroscopes sense mechanical stress coming from the printed circuit board pcb this pcb stress can be minimized by adhering to certain design rules when using mems gyroscope components in plastic packages pcb mounting and assembly can cause package stress this package stress in turn can affect the output offset and its value over a wide range of temperatures this stress is caused by the mismatch between the coefficient of linear thermal expansion cte of the package material and the pcb care must be taken to avoid package stress due to mounting traces connected to pads should be as symmetric as possible maximizing symmetry and balance for pad connection will help component self alignment and will lead to better control of solder paste reduction after reflow any material used in the surface mount assembly process of the mems gyroscope should be free of restricted rohs elements or compounds pb free solders should be used for assembly exposed die pad precautions the mpu x has very low active and standby current consumption the exposed die pad is not required for heat sinking and should not be soldered to the pcb failure to adhere to this rule can induce performance changes due to package thermo mechanical stress there is no electrical connection between the pad and the cmos trace routing routing traces or vias under the gyro package such that they run under the exposed die pad is prohibited routed active signals may harmonically couple with the gyro mems devices compromising gyro response these devices are designed with the drive frequencies as follows x khz y khz and z khz to avoid harmonic coupling don t route active signals in non shielded signal planes directly below or above the gyro package note for best performance design a ground plane under the e pad to reduce pcb signal noise from the board on which the gyro device is mounted if the gyro device is stacked under an adjacent pcb board design a ground plane directly above the gyro device to shield active signals from the adjacent pcb board component placement do not place large insertion components such as keyboard or similar buttons connectors or shielding boxes at a distance of less than mm from the mems gyro maintain generally accepted industry design practices for component placement near the mpu x to prevent noise coupling and thermo mechanical stress pcb mounting and cross axis sensitivity orientation errors of the gyroscope and accelerometer mounted to the printed circuit board can cause cross axis sensitivity in which one gyro or accel responds to rotation or acceleration about another axis respectively for example the x axis gyroscope may respond to rotation about the y or z axes the orientation mounting errors are illustrated in the figure below mpu mpu product specification document number ps mpu a revision release date of package gyro accel axes relative to pcb axes with orientation errors and mpu mpu x y z the table below shows the cross axis sensitivity as a percentage of the gyroscope or accelerometer s sensitivity for a given orientation error respectively cross axis sensitivity vs orientation error orientation error or cross axis sensitivity sin or sin the specifications for cross axis sensitivity in section and section include the effect of the die orientation error with respect to the package mems handling instructions mems micro electro mechanical systems are a time proven robust technology used in hundreds of millions of consumer automotive and industrial products mems devices consist of microscopic moving mechanical structures they differ from conventional ic products even though they can be found in similar packages therefore mems devices require different handling precautions than conventional ics prior to mounting onto printed circuit boards pcbs the mpu x has been qualified to a shock tolerance of g invensense packages its gyroscopes as it deems proper for protection against normal handling and shipping it recommends the following handling precautions to prevent potential damage do not drop individually packaged gyroscopes or trays of gyroscopes onto hard surfaces components placed in trays could be subject to g forces in excess of g if dropped printed circuit boards that incorporate mounted gyroscopes should not be separated by manually snapping apart this could also create g forces in excess of g do not clean mems gyroscopes in ultrasonic baths ultrasonic baths can induce mems damage if the bath energy causes excessive drive motion through resonant frequency coupling esd considerations establish and use esd safe handling precautions when unpacking and handling esd sensitive devices mpu mpu product specification document number ps mpu a revision release date of store esd sensitive devices in esd safe containers until ready for use the tape and reel moisture sealed bag is an esd approved barrier the best practice is to keep the units in the original moisture sealed bags until ready for assembly restrict all device handling to esd protected work areas that measure less than v static charge ensure that all workstations and personnel are properly grounded to prevent esd reflow specification qualification reflow the mpu x was qualified in accordance with ipc jedec j std d this standard classifies proper packaging storage and handling in order to avoid subsequent thermal and mechanical damage during the solder reflow attachment phase of pcb assembly the qualification preconditioning process specifies a sequence consisting of a bake cycle a moisture soak cycle in a temperature humidity oven and three consecutive solder reflow cycles followed by functional device testing the peak solder reflow classification temperature requirement for package qualification is c for lead free soldering of components measuring less than mm in thickness the qualification profile and a table explaining the set points are shown below temperature c time seconds solder reflow profile for qualification lead free ir convection preheat sec t smax t smin t liquidus t pmin t pmax liquidus sec sec t ramp up c sec t ramp down c sec t room pmax sec a b c d e f g h i mpu mpu product specification document number ps mpu a revision release date of temperature set points corresponding to reflow profile above step setting constraints temp c time sec max rate c sec a t room b t smin c t smax t bc d t liquidus r tliquidus tpmax e t pmin c c r tliquidus tpmax f t pmax c c t af r tliquidus tpmax g t pmin c c t eg r tpmax tliquidus h t liquidus t dh i t room notes customers must never exceed the classification temperature t pmax c all temperatures refer to the topside of the qfn package as measured on the package body surface production reflow check the recommendations of your solder manufacturer for optimum results use lead free solders that have lower specified temperature profiles tp max c also use lower ramp up and ramp down rates than those used in the qualification profile never exceed the maximum conditions that we used for qualification as these represent the maximum tolerable ratings for the device storage specifications the storage specification of the mpu x conforms to ipc jedec j std d moisture sensitivity level msl calculated shelf life in moisture sealed bag months storage conditions c and rh after opening moisture sealed bag hours storage conditions ambient c at rh package marking specification invensense mpu x x x x x x x x x x y y w w x lot traceability code foundry code package vendor code rev code y y year code w w work week top view part number invensense mpu x x x x x x x x x x y y w w x top view package marking specification mpu mpu product specification document number ps mpu a revision release date of tape reel specification tape dimensions reel outline drawing reel dimensions and package size package size reel mm l v w z x mpu mpu product specification document number ps mpu a revision release date of tape and reel specification reel specifications quantity per reel reels per box boxes per carton max pcs carton max label barcode label location of label on reel label reel cover tape anti static carrier tape anti static terminal tape user direction of feed invensense invensense invensense invensense pin package orientation i n ve n s ens e p b f r e e ca teg o ry e hf de v ic e p m pu p o h u b r e el qty q l ot t q r f d c d qty q lo t t q v g d c d q t y q reel d ate qc st a m p mpu mpu product specification document number ps mpu a revision release date of packaging reel with barcode vacuum sealed moisture msl label caution labels barrier bag with esd msl caution and barcode labels caution label esd label inner bubble wrap pizza box pizza boxes placed in foam outer shipper label lined shipper box mpu mpu product specification document number ps mpu a revision release date of representative shipping carton label mpu mpu product specification document number ps mpu a revision release date of reliability qualification test policy invensense s products complete a qualification test plan before being released to production the qualification test plan for the mpu x followed the jesd i standards stress test driven qualification of integrated circuits with the individual tests described below qualification test plan accelerated life tests test method condition lot quantity sample lot acc reject criteria htol lfr high temperature operating life jedec jesd a d dynamic v biased tj c read points hours hast highly accelerated stress test jedec jesd a a condition a c rh psia unbiased read point hours hts high temperature storage life jedec jesd a d cond a c non bias bake read points hours device component level tests test method condition lot quantity sample lot acc reject criteria esd hbm esd human body model jedec js kv esd mm esd machine model jedec jesd a c v lu latch up jedec jesd d class ii c ma ms mechanical shock jedec jesd b c mil std method cond e g s ms x y z directions times direction vib vibration jedec jesd b b variable frequency random cond b hz x y z times direction tc temperature cycling jedec jesd a d condition g c to c soak mode cycles board level tests test method condition lot quantity sample lot acc reject criteria bms board mechanical shock jedec jesd b c mil std method cond e g s ms x y z directions times direction btc board temperature cycling jedec jesd a d condition g c to c soak mode cycles tests are preceded by msl preconditioning in accordance with jedec jesd a f mpu mpu product specification document number ps mpu a revision release date of environmental compliance the mpu mpu is rohs and green compliant the mpu mpu is in full environmental compliance as evidenced in report hs mpu materials declaration data sheet environmental declaration disclaimer invensense believes this environmental information to be correct but cannot guarantee accuracy or completeness conformity documents for the above component constitutes are on file invensense subcontracts manufacturing and the information contained herein is based on data received from vendors and suppliers which has not been validated by invensense this information furnished by invensense is believed to be accurate and reliable however no responsibility is assumed by invensense for its use or for any infringements of patents or other rights of third parties that may result from its use specifications are subject to change without notice invensense reserves the right to make changes to this product including its circuits and software in order to improve its design and or performance without prior notice invensense makes no warranties neither expressed nor implied regarding the information and specifications contained in this document invensense assumes no responsibility for any claims or damages arising from information contained in this document or from the use of products and services detailed therein this includes but is not limited to claims or damages based on the infringement of patents copyrights mask work and or other intellectual property rights certain intellectual property owned by invensense and described in this document is patent protected no license is granted by implication or otherwise under any patent or patent rights of invensense this publication supersedes and replaces all information previously supplied trademarks that are registered trademarks are the property of their respective companies invensense sensors should not be used or sold in the development storage production or utilization of any conventional or mass destructive weapons or for any other weapons or life threatening applications as well as in any other life critical applications such as medical equipment transportation aerospace and nuclear instruments undersea equipment power plant equipment disaster prevention and crime prevention equipment invensense is a registered trademark of invensense inc mpu tm mpu tm mpu tm mpu x tm digital motion processor dmp motion processing unit motionfusion motioninterface motiontracking and motionapps are trademarks of invensense inc invensense inc all rights reserved worldwide as millions of people stay at home to minimise transmission of severe acute respiratory syndrome coronavirus health care workers prepare to do the exact opposite they will go to clinics and hospitals putting themselves at high risk from covid figures from china s national health commission show that more than health care workers have been infected as of early march and according to local media by the end of february at least had died in italy of responding health care workers were infected and some have died reports from medical staff describe physical and mental exhaustion the torment of difficult triage decisions and the pain of losing patients and colleagues all in addition to the infection risk as the pandemic accelerates access to personal protective equipment ppe for health workers is a key concern medical staff are prioritised in many countries but ppe shortages have been described in the most affected facilities some medical staff are waiting for equipment while already seeing patients who may be infected or are supplied with equipment that might not meet requirements alongside concerns for their personal safety health care workers are anxious about passing the infection to their families health care workers who care for elderly parents or young children will be drastically affected by school closures social distancing policies and disruption in the availability of food and other essentials health care systems globally could be operating at more than maximum capacity for many months but health care workers unlike ventilators or wards cannot be urgently manufactured or run at occupancy for long periods it is vital that governments see workers not simply as pawns to be deployed but as human individuals in the global response the safety of health care workers must be ensured adequate provision of ppe is just the first step other practical measures must be considered including cancelling non essential events to prioritise resources provision of food rest and family support and psychological support presently health care workers are every country s most valuable resource summary background we aimed to evaluate and improve the accuracy of the ultrasound scan in estimating gestational age in late pregnancy ie after weeks gestation in low income and middle income countries lmics where access to ultrasound in the first half of pregnancy is rare and where intrauterine growth restriction is prevalent methods this prospective population based cohort study was done in three lmics bangladesh pakistan and tanzania participating in the who alliance for maternal and newborn health improvement study women carrying a live singleton fetus dated by crown rump length crl measurements between weeks of gestation who were willing to return for two additional ultrasound scans and who planned on delivering in the study area were enrolled in the study participants underwent ultrasonography at weeks and at weeks gestation birthweights were measured within h of birth and the proportions of infants who had a small for gestational age birthweight ie a birthweight of the standard birthweight for the infant s gestational age and sex according to the intergrowth st project newborn baby reference standards and appropriate for gestational age birthweights were ascertained estimation of gestational age by standard fetal biometry measurements in addition to transcerebellar diameter tcd measurements was compared with gold standard crl measurements by use of bland altman plots to calculate the mean difference and limits of agreement statistical modelling was done to develop new gestational age prediction formulas for third trimester ultrasonography in lmics findings between feb and jan women were enrolled in the study pregnant women had an ultrasound scan at weeks of gestation and had an ultrasound scan between weeks of gestation of the unique infants whose birthweights were available infants were born with an appropriate for gestational age birthweight and infants were born with a small for gestational age birthweight the accuracy of late pregnancy ultrasound biometry using existing formulas to estimate gestational age in lmics was similar to that in high income settings with standard dating formulas late pregnancy ultrasound at weeks gestation was accurate to within approximately plus or minus weeks of the gold standard crl measurement of gestational age and late pregnancy ultrasound was accurate to within weeks of the crl measurement at weeks gestation in infants who were ultimately born small for gestational age individual parameters systematically underestimated gestational age apart from tcd which showed minimal bias by use of a novel parsimonious model formula that combined tcd with femur length gestational age at the week ultrasound scan was estimated to within days of the crl measurement and estimated to within days of the crl measurement at the week ultrasound scan similar results were observed in infants who were small for gestational age interpretation incorporation of tcd and the use of new formulas in late pregnancy ultrasound scans could improve the accuracy of gestational age estimation in both appropriate for gestational age and small for gestational age infants in lmics given the high rates of small for gestational age infants in lmics these results might be especially relevant validation of this new formula in other lmic populations is needed to establish whether the accuracy of the late pregnancy ultrasound can be narrowed to within approximately weeks funding bill melinda gates foundation view related content for this article research in context evidence before this study the performance of late pregnancy ultrasound for assessing gestational age has been understudied in low income and middle income countries lmics where access to ultrasound for gestational age dating early in pregnancy is rare and where a high proportion of infants are born small for gestational age in high income settings the transcerebellar diameter tcd has shown promise as a biometric parameter that is less affected by intrauterine growth restriction than standard ultrasound biometric measurements but this parameter is not routinely used as most women in high income settings present earlier weeks of gestation for ultrasound confirmation of gestational age added value of this study in this multicountry population based cohort study we compared the performance of standard ultrasound biometric parameters and tcd with the gold standard method of first trimester crown rump length crl measurements for estimating gestational age in late pregnancy ie after weeks gestation the accuracy of ultrasonography in estimating gestational age in late pregnancy in lmics was similar to that reported in high income settings but it was further improved when tcd was included in the combination formulas for gestational age assessment we derived a parsimonious model requiring measurement of only the tcd and the femur length that was accurate to within approximately plus or minus weeks of the gold standard crl measurement of gestational age even among infants who were ultimately born small for gestational age our study was population based enrolling an unselected group of pregnant women rather than a selected group of only the healthiest pregnant women therefore we believe our novel gestational age formula is more generalisable to real world conditions that health care practitioners in lmics face implications of all the available evidence in lmics gestational age in late pregnancy can be reliably assessed to within approximately weeks of the crl measurement by use of only two ultrasound parameters these results were consistent when our gestational age formulas were applied to pregnancies in which the infants were ultimately born small for gestational age our formulas could be most useful when measuring gestational age in pregnant women who present late to receive antenatal care in lmics where the burden of intrauterine growth restriction is high the biometric ultrasound measurements used in our study appear to be attainable by health care providers with limited sonography training accurate gestational age dating can enable providers to identify pregnancies requiring antenatal interventions such as corticosteroids or transfer to a facility that is able to handle premature infants accurate dating will also allow researchers to better estimate the global burden of preterm birth and intrauterine growth restriction introduction pregnancy dating is an essential component of antenatal care accurate estimation of gestational age is needed to optimise provision of obstetric interventions and delivery location for preterm births and it is also a prerequisite to identify and manage fetal growth abnormalities additionally accurate estimation of gestational age is required to provide reasonable global estimates of preterm birth and intrauterine growth restriction in low income and middle income countries lmics where the burden of preterm birth and intrauterine growth restriction is highest assessing gestational age accurately can be challenging because of many factors for instance last menstrual period is often unknown and menstrual cycles can vary in length symphysis fundal height can be a misleading measure of gestational age because of variation in maternal adiposity intrauterine growth restriction uterine fibroids or malpresentation the first trimester ultrasound is considered to be the gold standard method for estimating gestational age in high income settings but ultrasound early in gestation might not be routinely available in lmics in addition pregnant women in lmics might not present for antenatal care in early pregnancy as gestation advances ultrasound biometry becomes less accurate for estimating gestational age given the emergence of natural variation in fetal size and the possibility of pathological growth restriction indeed in lmics where of infants are born small for gestational age the assumption that fetal size predicts gestational age might not be valid studies suggest that measurements of the cerebellum could allow for a more accurate estimation of gestational age late in pregnancy ie from weeks gestation onwards compared with standard biometry measurements cerebellar size appears to be less affected by intrauterine growth restriction than other measures of growth there is also less natural variation in cerebellar size between fetuses transcerebellar diameter tcd nomograms have been published for several populations but they are not in mainstream use in high income settings as most women have early ultrasound scans at weeks gestation when standard biometric measurements biparietal diameter head circumference abdominal circumference and femur length are reported to provide an accurate estimation of gestational age to within plus or minus weeks of the gold standard crown rump length crl measurement of gestational age standard biometry does not perform as well in the third trimester as it does at less than weeks gestation with a reported accuracy of only or more weeks of the crl measurement one study in the usa found a strong correlation between cerebellar size and gestational age in infants born with an appropriate for gestational age birthweight and in those born small for gestational age even though a small number of studies have measured the cerebellum in specific lmics the performance of cerebellar biometry for assessing gestational age has been understudied in settings where its use might be of greater benefit the objective of the who alliance for maternal and newborn health improvement amanhi late pregnancy dating study was to evaluate the accuracy of late pregnancy ie after weeks gestation ultrasound biometry in estimating gestational age in lmic settings with a particular focus on the effect of intrauterine growth restriction on the accuracy and whether cerebellar measurements could improve performance methods study design and participants the who amanhi study cohort was established in to harmonise several large ongoing maternal and neonatal health research studies in sub saharan africa and south asia the study involved five distinct sites sylhet bangladesh karachi pakistan pemba tanzania brong ahafo gahna southern province zambia three of the five amanhi sites sylhet karachi and pemba participated in this prospective multicountry population based cohort substudy known as the who amanhi late pregnancy dating study the remaining two sites brong ahafo and the southern province were ineligible having completed amanhi enrolment amanhi study populations were predominantly rural with low levels of literacy as amanhi was an unselected population based cohort it was inclusive of both appropriately grown and growth restricted infants between feb and jan pregnant women were identified by trained field workers through home visits urine tests for human chorionic gonadotropin were used to confirm pregnancies women were eligible for the study if they were pregnant with a live singleton fetus the pregnancy had been dated by crl measurements between and weeks gestation crl of mm they were willing to return for two additional ultrasounds and they planned on delivering in the study area women pregnant with multiple fetuses or a non viable or anomalous fetus were ineligible fieldworkers obtained written informed consent from participants in their local languages and arranged study ultrasounds to coincide with standard amanhi visits ethics approval was granted by institutional review boards and ethics review committees in the participating countries the host institutions of principal investigators who and partners healthcare the boston based coordinating team procedures we considered the first trimester ultrasound scan to be the gold standard method for estimating gestational age amanhi study sonographers followed standardised procedures to obtain high quality transabdominal crl measurements three crl measurements were obtained for each participant and the median crl value and the intergrowth st equation were used to calculate gestational age first trimester crl measurements established the estimated date of delivery and were considered as the gold standard gestational age at all subsequent study visits study ultrasound procedures were standardised during a day training course in bangladesh for staff from participating amanhi sites and consisted of didactic and practical teaching methods competency was assessed with written and practical post training assessments staff from pakistan were unable to attend because of visa issues and they were therefore trained via skype conferencing no additional sonographers were recruited during the study period two ultrasound scans subsequent to the first trimester ultrasound were done for each participant the first between and weeks gestation and the second between and weeks gestation both coinciding with routine amanhi visits after study initiation the gestational age windows were extended to weeks and weeks to cover a wider range of the third trimester however only the pemba site received ethics approval for this extension before study completion at every ultrasound visit sonographers followed standardised procedures to obtain high quality measurements of the biparietal diameter head circumference abdominal circumference femur length and tcd appendix p sonographers were masked to the gold standard gestational age established by crl measurements ultrasound biometry measurements were obtained without the use of an automated biometry software package so that only absolute measurements were taken two measurements for each biometric parameter were obtained and averaged plausible measurement ranges were defined for each parameter before the analysis crl mm biparietal diameter cm head circumference cm femur length cm abdominal circumference cm and tcd cm for measures outside of these ranges data were checked for data entry errors and were assigned as missing if unresolved gestational age was calculated from each individual biometric parameter by use of standard tables hadlock and colleagues for biparietal diameter femur length and abdominal circumference chavez and colleagues for tcd and intergrowth st project for head circumference gestational age was also calculated by use of previously published formulas that combine more than one parameter hadlock and colleagues and intergrowth st project formulas and the reasonable ranges for individual parameters are detailed in the appendix p an image quality checklist provided objective guidance on appropriate image magnification ideal image plane and correct calliper placement all study images were reviewed by bjw who was masked to the gold standard gestational age values for ongoing quality control with quarterly feedback to the sonographers infants were visited within h of birth birthweights were obtained by use of digital scales small for gestational age was defined as less than of the standard birthweight for the infant s gestational age and sex according to the intergrowth st project newborn baby reference standards statistical analysis study sample size was calculated on the basis of our hypothesis that the gestational age agreement between tcd and crl would be higher than the agreement between standard biometry and crl both among infants with appropriate for gestational age birthweights and among those with small for gestational age birthweights previously published literature and professional society guidelines have shown that late pregnancy biometry combination formulas have a gestational age accuracy of within days of the gold standard first trimester crl measurements by use of overlapping bland altman plots to compare the degree of agreement between tcd versus crl with standard biometry versus crl a sample size of would be adequate to show a mean difference of and limits of agreement loa of within days tcd vs crl versus within days standard biometry vs crl of the crl estimated gestational age we aimed to enrol a minimum of infants with small for gestational age birthweights per site assuming that of infants would be small for gestational age and that of pregnant women would be lost to follow up at delivery we required infants per site therefore we had a conservative target of enrolling participants per study site the stata software programme statacorp stata statistical software release college station tx usa was used for all statistical analyses bland altman plots were used to assess the agreement between gestational age measured by gold standard crl and gestational age measured by late pregnancy ultrasound biometric parameters mean differences bias with cis and loa values were calculated for each comparison for ease of comparison an approximation of the degree of agreement was calculated as the midpoint between the unsigned loa values as an example if the loa was to days the approximation of agreement would be within days of the gestational age as determined by the gold standard first trimester crl measurement for individual biometric parameters or combinations of parameters with bias ie if the ci of the mean difference does not include the gestational age window agreement limits would be skewed in the direction of the bias for infants with available birthweights we stratified the results by infant size to compare the accuracy of late pregnancy biometry measures among infants with appropriate for gestational age birthweights and small for gestational age birthweights statistical modelling was used to develop novel equations to predict gestational age with late pregnancy biometric parameters as covariates generalised linear regression was done by use of the stata glm command accounting for clustering of multiple visits for a participant gold standard gestational age determination by crl measurement was the dependent variable covariates tested in the models included all late pregnancy biometric parameters measured biparietal diameter head circumference femur length abdominal circumference and tcd natural logarithms were used to transform continuous measures given non normal distributions models with individual and combinations of biometric parameters were tested given the performance of tcd as an individual parameter models including tcd as the main predictor were examined adding additional biometric parameters assessing for significance ie if the p value was and improvement in the adjusted r and determining the best fit model according to the akaike information criterion potential models were cross validated to compare the predictive accuracy of the different models and select biometric parameters to be included in the final model two methods were used to cross validate the models in the first method the study dataset was divided into five random subsamples one subsample was withheld and statistical models were generated with the remaining of the data the model was then used to predict gestational age in the withheld subsample and a standardised error term was calculated on the basis of the predicted gestational age calculated as observed gestational age predicted gestational age predicted gestational age this process was repeated with each successive withheld subsample and a summary measure of the prediction error was generated for the entire dataset the model with the lowest prediction error was selected as the final model in the second cross validation method the data from one study site were withheld and statistical models were generated with data from the remaining two sites the model was then fit and used to predict gestational age in the first site that had the data withheld this process was repeated twice and the standardised error was calculated role of the funding source the funder of the study had no role in the study design data collection data analysis data interpretation or writing of the report results between feb and jan pregnant women in three of the five amanhi study sites bangladesh pakistan and tanzania with documented crl assessments between and weeks gestation were enrolled in this late pregnancy ultrasound study of these women completed late pregnancy scans data from nine infants were excluded from the final analysis because of implausible dates that could not be reconciled eg date of birth before date of ultrasound or year of ultrasound or birth recorded incorrectly we determined a priori that a difference of greater than days between the gold standard crl measurement of gestational age and the gestational age predicted by late pregnancy biometry measurements was considered to be implausibly associated with the performance of the ultrasound three such extreme outliers were excluded at weeks gestation and an additional three were excluded at weeks gestation the final analysis included unique mothers of whom underwent an ultrasound scan between and weeks gestation in bangladesh in pakistan and in tanzania and underwent an ultrasound scan between and weeks gestation in bangladesh in pakistan and in tanzania figure figure thumbnail gr figure participant flowchart by ultrasound visit show full caption view large imagefigure viewerdownload hi res imagedownload ppt more than of all attempts at biometric measurements were successful of the ultrasound scans done at weeks gestation values for the biparietal diameter were missing in two scans for head circumference in three scans for femur length in two scans for abdominal circumference in three scans and for tcd in three scans of the ultrasound scans done at weeks gestation missing values for the different parameters were similar to the ultrasound scan at weeks gestation with two values missing for biparietal diameter two for head circumference none for femur length and eight for abdominal circumference even at weeks gestation tcd measurements were successfully obtained from of ultrasound scans summary measures from the individual biometric parameters mean and sd for the cohort and by site are included in the appendix p using the reference nomogram for crl by hadlock and colleagues as an alternative to the intergrowth st project nomogram no significant differences in the distribution of gestational ages estimated from either third trimester ultrasound scan were observed data not shown from the ultrasound scans done at weeks gestation the performance of individual biometric parameters showed fairly similar agreement with gold standard crl measurements approximations ranging from to days of the standard crl measurements table there was little bias as evidenced by a mean difference close to zero for all parameters a representative bland altman plot for tcd versus crl is presented in figure table degree of agreement between late pregnancy ultrasound and gold standard first trimester crown rump length measurement of gestational age ultrasound scan at weeks gestation n ultrasound scan at weeks gestation n mean difference in days ci limits of agreement in days approximation in days mean difference in days ci limits of agreement in days approximation in days individual parameters tcd to to to to bpd to to to to hc to to to to fl to to to to ac to to to to combination formulas hadlock to to to to intergrowth st project to to to to amanhi parsimonious formula to to to to the hadlock formula includes bpd ac and fl measurements intergrowth st project formula includes hc and fl measurements and the amanhi parsimonious method includes tcd and fl measurements tcd transcerebellar diameter bpd biparietal diameter hc head circumference fl femur length ac abdominal circumference amanhi alliance for maternal and newborn health improvement approximation refers to the midpoint between the unsigned limits of agreement and values represent the number of days plus or minus the gold standard first trimester crown rump length measurement of gestational age for biometric parameters or combinations with bias ie if the ci of the mean difference does not include the true value of gestational age compared with the estimated value from third trimester biometry will be skewed in the direction of the bias mean difference open table in a new tab figure thumbnail gr figure bland altman plots comparing agreement of gestational age days determied by tcd measurements with first trimester crl measurements at weeks gestation a and weeks gestation b by study site show full caption view large imagefigure viewerdownload hi res imagedownload ppt from the ultrasound scans done at weeks gestation tcd had narrower loa than the other individual biometric parameters table the agreement between tcd and gold standard crl measurements was approximated to be within days of the crl measurement with little bias mean difference days ci compared with tcd the remaining individual parameters showed less agreement with crl measurements approximations ranged between days a strong negative bias for biparietal diameter days ci to femur length days to and abdominal circumference days to was observed suggesting a systematic underestimation of gestational age by approximately week from the ultrasound scan at weeks gestation the hadlock and intergrowth st project combination formulas outperformed individual parameters by a few days approximations ranged between days and maintained little bias table from the ultrasound scan at weeks gestation tcd alone approximation days showed a similar degree of agreement to crl measurements as the hadlock formula approximation days and slightly narrower agreement with crl measurements than the intergrowth st project formula approximation days notably the hadlock formula had a strong negative bias mean difference days ci to results did not vary substantially by site data not shown and have been presented together stratification of results by infant size was done in women who were less than weeks pregnant when they gave birth with birthweights available and included of women who had an ultrasound scan at weeks gestation of women who had an ultrasound scan at weeks gestation and of all unique infants for whom the birthweights were known of the unique infants were classified as small for gestational age the prevalence of infants who were small for gestational age varied by site and was higher in asian sites of infants in bangladesh and of infants in pakistan than in the african sites of infants in tanzania tcd outperformed the other biometric parameters in predicting gestational age and showed less negative bias ie less underestimation with loa values that were similar at the week and week scans in infants who had appropriate for gestational age birthweights and small for gestational age birthweights table hadlock and intergrowth st project combination formulas had slightly narrower loa values than individual parameters at the week scan in infants who were small for gestational age table although the hadlock formula had substantial negative bias days ci to at the week scan tcd had a similar loa to the combination formulas for infants who were small for gestational age approximation days but with less bias mean difference days than both the hadlock days and intergrowth st project formulas days table table performance of late pregnancy ultrasound in estimating the gestational age of infants with small for gestational age or appropriate for gestational age birthweights birthweight appropriate for gestational age birthweight small for gestational age mean difference in days ci limits of agreement in days approximation in days mean difference in days ci limits of agreement in days approximation in days weeks gestation tcd to to to to bpd to to to to hc to to to to fl to to to to ac to to to to hadlock to to to to intergrowth st project to to to to amanhi parsimonious formula to to to to weeks gestation tcd to to to to bpd to to to to hc to to to to fl to to to to ac to to to to hadlock to to to to intergrowth st project to to to to amanhi parsimonious formula to to to to the hadlock formula includes bpd ac and fl measurements intergrowth st project formula includes hc and fl measurements and the amanhi parsimonious method includes tcd and fl measurements tcd transcerebellar diameter bpd biparietal diameter hc head circumference fl femur length ac abdominal circumference amanhi alliance for maternal and newborn health improvement approximation refers to the midpoint between the unsigned limits of agreement and values represent the number of days plus or minus the gold standard first trimester crown rump length measurement of gestational age for biometric parameters or combinations with bias ie if the ci of the mean difference does not include the true value of gestational age compared with the estimated value from third trimester biometry will be skewed in the direction of the bias mean difference open table in a new tab the four statistical models generated from the amanhi late pregnancy dating study are shown in table model was the most accurate in predicting gestational age and included four biometric parameters model included only tcd and femur length and showed the least prediction error among the three more parsimonious models combining only two parameters after both cross validation approaches were applied appendix p table performance of newly derived alliance for maternal and newborn health improvement combination formulas for determining gestational age after weeks gestation weeks gestation weeks gestation mean difference in days ci limits of agreement in days approximation in days mean difference in days ci limits of agreement in days approximation in days model lntcd lnbpd lnfl and lnac to to to to model lntcd and lnfl to to to to model lntcd and lnbpd to to to to model lntcd and lnac to to to to tcd transcerebellar diameter bpd biparietal diameter fl femur length ac abdominal circumference hc head circumference approximation refers to the midpoint between the unsigned limits of agreement and values represent the number of days plus or minus the gold standard first trimester crown rump length measurement of gestational age for biometric parameters or combinations with bias ie if the ci of the mean difference does not include the true value of gestational age compared with the estimated value from third trimester biometry will be skewed in the direction of the bias mean difference model is the complete alliance for maternal and newborn health improvement model models evaluate combinations of fewer biometric parameters with model chosen as the alliance for maternal and newborn health improvement parsimonious model open table in a new tab the final model was fit by including tcd and femur length in a regression with the entire dataset model table formula in appendix p the prediction error appendix p is on the final model involving the entire cohort data formulas for all candidate models and their out of model prediction errors are shown in the appendix p from the ultrasound scan at weeks gestation our novel amanhi combination formula combining tcd and femur length measurements showed little improvement in the accuracy of estimating gestational age when infants were stratified by birthweight appropriate for gestational age or small for gestational age compared with previous combination formulas improving estimations by only day table however from the ultrasound scan at weeks gestation the amanhi combination formula could more accurately predict gestational age for appropriate for gestational age infants and small for gestational age infants compared with the intergrowth st project combination formula narrowing the loa to approximately weeks and with minimal bias table discussion we have identified several key findings regarding the performance of ultrasound biometry in late pregnancy in a large cohort of pregnant women in three lmic settings first it was reassuring to verify that the accuracy of late pregnancy ultrasound for estimating gestational age in our study was similar to the reported results from higher income settings where sonographer training is lengthier and includes more practical training compared with sonographer training in lmic settings biometric parameters at weeks gestation and weeks gestation alone and in combination were accurate to within approximately weeks of the gold standard crl measurement of gestational age these results are consistent with previous reports of the performance of late pregnancy biometric parameters in our study the accuracy of gestational age dating with individual biometric parameters before weeks was reasonably good approximation days to days of the standard crl measurements improving even further approximation days when individual biometric parameters were combined according to previously published formulas later scans weeks had wider individual loas approximation days as hypothesised the tcd as a single biometric parameter had the narrowest loa approximation days and even outperformed the combination formulas slightly approximation days importantly tcd also performed quite well among infants who were ultimately born small for gestational age with an accuracy of approximately days of the crl measurement of gestational age at weeks and approximately days of the crl measurement at weeks with little bias mean difference of days at both gestational age windows in summary nomograms established for measuring cerebellar size in high resource settings appear to perform well in this lmic population given the initial results showing successful performance of tcd in estimating gestational age we combined tcd with standard biometric parameters and used statistical modelling to investigate the performance of different combination formulas in the lmic study sites where the prevalence of infants born small for gestational age is high our first model combining tcd with biparietal diameter femur length and abdominal circumference narrowed the loa across the two third trimester gestational age windows to less than weeks a second parsimonious model combining only tcd and femur length performed nearly as well as the first model with the added benefit of simplicity in the number of parameters included both the femur and the cerebellum are structures that are fairly easy to identify in addition the measurements of these parameters are linear and therefore require less skill in calliper placement than circumference measurements as evidenced by the observation that these measurements were obtained successfully in of ultrasound scans in our study when compared with other published combination formulas our amanhi parsimonious model formula had the narrowest loa the least bias and performed similarly among infants born appropriate for gestational age and small for gestational age in both gestational age windows as the amanhi formulas were derived from our study population it is not surprising that they performed well even after attempting to separate model development and validation through cross validation exercises our gestational age formulas should therefore be viewed as hypothesis generating and they should be validated in other lmic populations before they are used extensively it is important to emphasise that our study included an unselected and population based cohort from three lmics at the time of enrolment the cohort therefore reflects the range of morbidities associated with pregnancy maternal nutritional status and fetal sizes that would be encountered by a health care practitioner in similar settings our cohort contrasts those used in previous studies such as the intergrowth st project cohort that were designed to measure optimal fetal growth and enrolled only healthy low risk women who were less likely to carry a growth restricted fetus these differences might help to explain why our amanhi parsimonious model outperformed both the hadlock and intergrowth st project formulas among infants who were born small for gestational age even at weeks gestation the loa of our amanhi parsimonious formula was still within days of the crl measurement of gestational age and it performed similarly among infants born with small for gestational age approximation days or appropriate for gestational age approximation days birthweights an estimation of gestational age to within approximately weeks of the standard crl measurement is a remarkable achievement for lmic settings as many women do not have an ultrasonography in the first half of pregnancy if intrauterine growth restriction is suspected measurement of cerebellar size in the third trimester could help to confirm that this is the case our study has several strengths including its large sample size and the determination of gestational age by use of gold standard first trimester crl measurements that were verified by a multilayered quality control process nonetheless there are some limitations of our study we did not evaluate the feasibility of obtaining cerebellum measurements after weeks gestation with advancing gestation shadowing from the calcified skull might preclude the accurate measurement of the tcd margins limiting its use as the pregnancy nears full term the results shown in figure suggest that accurate tcd measurements might be more difficult to obtain as the pregnancy advances as several individual data points fell below the lower loa rather than the upper loa at the week gestational age window this underestimation of gestational age by tcd in this gestational age window could reflect difficulties in measuring the full size of the cerebellar hemispheres in summary if validated in other lmic populations our novel parsimonious model for estimating gestational age in late pregnancy could be useful for research public health surveillance and clinical care our study findings might be clinically relevant for health care providers tasked with determining whether a fetus is small rather than preterm and thus might limit iatrogenic harm from unnecessary preterm delivery two important messages can be concluded from our work first cerebellar measurements using previously established nomograms from high resource settings are a useful adjunct to late pregnancy biometry measurements in lmics where the burden of infants born small for gestational age is high secondly if validated in other lmic populations a parsimonious gestational age formula requiring measurement of only two biometric parameters might narrow accuracy of late pregnancy ultrasound to within approximately weeks contributors this manuscript is the product of the who alliance for maternal and newborn health improvement late pregnancy dating study group bjw rb acl ahb fj and ss acquired funding designed the study developed the protocols and were involved in implementing the study bjw and mn led the ultrasound training and standardisation and provided ongoing ultrasound quality control fj im acl ahb sd ss ud and sa supervised patient enrolment provided oversight of daily study activities and were involved in leading the collection and management of data the daily collection and management of data was done by sb ah sj fk mk um smm and mr ra ni and nn were responsible for daily ultrasound activities and local quality control data was initially analysed and interpreted by bjw acl in sd les mi and rw with additional data interpretation done by rb ahb fj and ss bjw acl les and rb drafted the initial manuscript which was further edited reviewed revised and approved by all authors bjw and rb had full access to all of the data and the final responsibility to submit the manuscript for publication additional study members who had access to the raw data included acl in sd les mi and rw alliance for maternal and newborn health improvement study group members tanzania team collaborators tanzania saikat deb mohammed said mohammed said mohammed ali mohammed hamad juma massoud juma hassan public health laboratory ivo de carneri pemba india saikat deb usha dhingra arup dutta pratibha dixit sunil sazawal centre for public health kinetics new delhi pakistan team collaborators pakistan imran nisar muhammad ilyas usma mehmood farzana kausar shamim jaweed muhammad karim atiya hussain naila nadeem fyezah jehan aga khan university karachi bangladesh team collaborators bangladesh sayedur rahman nasreen islam ruksana azad syed mamun ibne moin salahuddin ahmed johns hopkins university bangladesh dhaka mahmoodur rahman abdul quiayum maternal and child health division international center for diarrheal disease research dhaka usa rasheda khanam abdullah h baqui department of international health johns hopkins bloomberg school of public health baltimore md coordinating team switzerland sachiyo yoshida alexander manu rajiv bahl who geneva usa anne cc lee brigham and women s hospital harvard medical school boston ma lauren e schaeffer rachel whelan brigham and women s hospital boston ma mariam naqvi ceders sinai medical center los angeles ca blair j wylie department of obstetrics and gynecology beth israel deaconess medical center boston ma harvard medical school boston ma declaration of interests ud ss fj aq ra sr mr smm ni am mn les acl and bw report grants from the bill melinda gates foundation during the conduct of the study all other authors declare no competing interests acknowledgments this study was funded by the bill melinda gates foundation opp the funder had no role in study design data collection data analysis data interpretation or writing of the report bjw received funding from the national institutes of health nih k es f d in also received funding from fogarty international centre and nih d tw acl received funding from the national institute of child health and human development k hd the results of the study were presented at the annual meeting of the society for maternal fetal medicine february in dallas tx usa we are particularly grateful to the women who participated in the study and to all research staff across the three study sites who made the project possible invensense inc borregas ave sunnyvale ca u s a tel fax website www invensense com document number ps mpu a revision release date of mpu and mpu product specification revision mpu mpu product specification document number ps mpu a revision release date of contents revision history purpose and scope product overview mpu x o verview applications features g yroscope f eatures a ccelerometer f eatures a dditional f eatures m otion p rocessing c locking electrical characteristics g yroscope s pecifications a ccelerometer s pecifications e lectrical and o ther c ommon s pecifications e lectrical s pecifications c ontinued e lectrical s pecifications c ontinued e lectrical s pecifications c ontinued i c t iming c haracterization spi t iming c haracterization mpu only a bsolute m aximum r atings applications information p in o ut and s ignal d escription t ypical o perating c ircuit b ill of m aterials for e xternal c omponents r ecommended p ower on p rocedure b lock d iagram o verview t hree a xis mems g yroscope with bit adc s and s ignal c onditioning t hree a xis mems a ccelerometer with bit adc s and s ignal c onditioning d igital m otion p rocessor p rimary i c and spi s erial c ommunications i nterfaces a uxiliary i c s erial i nterface mpu mpu product specification document number ps mpu a revision release date of s elf t est mpu x s olution for axis s ensor f usion u sing i c i nterface mpu u sing spi i nterface i nternal c lock g eneration s ensor d ata r egisters fifo i nterrupts d igital o utput t emperature s ensor b ias and ldo c harge p ump programmable interrupts digital interface i c and spi mpu only s erial i nterfaces i c i nterface i c c ommunications p rotocol i c t erms spi i nterface mpu only serial interface considerations mpu mpu s upported i nterfaces l ogic l evels l ogic l evels d iagram for aux vddio assembly o rientation of a xes p ackage d imensions pcb d esign g uidelines a ssembly p recautions s torage s pecifications p ackage m arking s pecification t ape r eel s pecification l abel p ackaging r epresentative s hipping c arton l abel reliability q ualification t est p olicy mpu mpu product specification document number ps mpu a revision release date of q ualification t est p lan environmental compliance mpu mpu product specification document number ps mpu a revision release date of revision history revision date revision description initial release for rev c parts clarified wording in sections edited supply current numbers for different modes section unit of measure for accelerometer sensitivity changed from lsb mg to lsb g updated accelerometer self test specifications in table updated package dimensions section updated pcb design guidelines section for rev d parts updated accelerometer specifications in table updated accelerometer specification note sections updated qualification test plan section edits for clarity changed operating voltage range to v v added accelerometer intelligence function increment value of mg lsb section updated absolute maximum rating for acceleration any axis unpowered from ms to ms section modified absolute maximum rating for latch up to level a and ma section updated self test response specifications for revision d parts dated with date code yyww or later edits for clarity added gyro self test sections added min max limits to accel self test response section updated accelerometer low power mode operating currents section added gyro self test to block diagram section updated packaging labels and descriptions sections updated gyro and accelerometer self test information sections updated latch up information section updated programmable interrupts information section changed shipment information from maximum of reels k units per shipper box to reels k units per shipper box section updated packing shipping and label information sections updated reliability references section updates section mpu mpu product specification document number ps mpu a revision release date of purpose and scope this product specification provides advanced information regarding the electrical specification and design related information for the mpu and mpu motiontracking devices collectively called the mpu x or mpu electrical characteristics are based upon design analysis and simulation results only specifications are subject to change without notice final specifications will be updated based upon characterization of production silicon for references to register map and descriptions of individual registers please refer to the mpu mpu register map and register descriptions document the self test response specifications provided in this document pertain to revision d parts with date codes of yyww or later please see section for package marking description details mpu mpu product specification document number ps mpu a revision release date of product overview mpu x overview motioninterface is becoming a must have function being adopted by smartphone and tablet manufacturers due to the enormous value it adds to the end user experience in smartphones it finds use in applications such as gesture commands for applications and phone control enhanced gaming augmented reality panoramic photo capture and viewing and pedestrian and vehicle navigation with its ability to precisely and accurately track user motions motiontracking technology can convert handsets and tablets into powerful d intelligent devices that can be used in applications ranging from health and fitness monitoring to location based services key requirements for motioninterface enabled devices are small package size low power consumption high accuracy and repeatability high shock tolerance and application specific performance programmability all at a low consumer price point the mpu x is the world s first integrated axis motiontracking device that combines a axis gyroscope axis accelerometer and a digital motion processor dmp all in a small x x mm package with its dedicated i c sensor bus it directly accepts inputs from an external axis compass to provide a complete axis motionfusion output the mpu x motiontracking device with its axis integration on board motionfusion and run time calibration firmware enables manufacturers to eliminate the costly and complex selection qualification and system level integration of discrete devices guaranteeing optimal motion performance for consumers the mpu x is also designed to interface with multiple non inertial digital sensors such as pressure sensors on its auxiliary i c port the mpu x is footprint compatible with the mpu x family the mpu x features three bit analog to digital converters adcs for digitizing the gyroscope outputs and three bit adcs for digitizing the accelerometer outputs for precision tracking of both fast and slow motions the parts feature a user programmable gyroscope full scale range of and sec dps and a user programmable accelerometer full scale range of g g g and g an on chip byte fifo buffer helps lower system power consumption by allowing the system processor to read the sensor data in bursts and then enter a low power mode as the mpu collects more data with all the necessary on chip processing and sensor components required to support many motion based use cases the mpu x uniquely enables low power motioninterface applications in portable applications with reduced processing requirements for the system processor by providing an integrated motionfusion output the dmp in the mpu x offloads the intensive motionprocessing computation requirements from the system processor minimizing the need for frequent polling of the motion sensor output communication with all registers of the device is performed using either i c at khz or spi at mhz mpu only for applications requiring faster communications the sensor and interrupt registers may be read using spi at mhz mpu only additional features include an embedded temperature sensor and an on chip oscillator with variation over the operating temperature range by leveraging its patented and volume proven nasiri fabrication platform which integrates mems wafers with companion cmos electronics through wafer level bonding invensense has driven the mpu x package size down to a revolutionary footprint of x x mm qfn while providing the highest performance lowest noise and the lowest cost semiconductor packaging required for handheld consumer electronic devices the part features a robust g shock tolerance and has programmable low pass filters for the gyroscopes accelerometers and the on chip temperature sensor for power supply flexibility the mpu x operates from vdd power supply voltage range of v v additionally the mpu provides a vlogic reference pin in addition to its analog supply pin vdd which sets the logic levels of its i c interface the vlogic voltage may be v or vdd the mpu and mpu are identical except that the mpu supports the i c serial interface only and has a separate vlogic reference pin the mpu supports both i c and spi interfaces and has a single supply pin vdd which is both the device s logic reference supply and the analog supply for the part the table below outlines these differences mpu mpu product specification document number ps mpu a revision release date of primary differences between mpu and mpu part item mpu mpu vdd v v v v vlogic n a v to vdd serial interfaces supported i c spi i c pin cs vlogic pin ad sdo ad pin scl sclk scl pin sda sdi sda mpu mpu product specification document number ps mpu a revision release date of applications blurfree technology for video still image stabilization airsign technology for security authentication touchanywhere technology for no touch ui application control navigation motioncommand technology for gesture short cuts motion enabled game and application framework instantgesture ig gesture recognition location based services points of interest and dead reckoning handset and portable gaming motion based game controllers d remote controls for internet connected dtvs and set top boxes d mice wearable sensors for health fitness and sports toys mpu mpu product specification document number ps mpu a revision release date of features gyroscope features the triple axis mems gyroscope in the mpu x includes a wide range of features digital output x y and z axis angular rate sensors gyroscopes with a user programmable full scale range of and sec external sync signal connected to the fsync pin supports image video and gps synchronization integrated bit adcs enable simultaneous sampling of gyros enhanced bias and sensitivity temperature stability reduces the need for user calibration improved low frequency noise performance digitally programmable low pass filter gyroscope operating current ma standby current a factory calibrated sensitivity scale factor user self test accelerometer features the triple axis mems accelerometer in mpu x includes a wide range of features digital output triple axis accelerometer with a programmable full scale range of g g g and g integrated bit adcs enable simultaneous sampling of accelerometers while requiring no external multiplexer accelerometer normal operating current a low power accelerometer mode current a at hz a at hz a at hz a at hz orientation detection and signaling tap detection user programmable interrupts high g interrupt user self test additional features the mpu x includes the following additional features axis motionfusion by the on chip digital motion processor dmp auxiliary master i c bus for reading data from external sensors e g magnetometer ma operating current when all motion sensing axes and the dmp are enabled vdd supply voltage range of v v flexible vlogic reference voltage supports multiple i c interface voltages mpu only smallest and thinnest qfn package for portable devices x x mm minimal cross axis sensitivity between the accelerometer and gyroscope axes byte fifo buffer reduces power consumption by allowing host processor to read the data in bursts and then go into a low power mode as the mpu collects more data digital output temperature sensor user programmable digital filters for gyroscope accelerometer and temp sensor g shock tolerant khz fast mode i c for communicating with all registers mhz spi serial interface for communicating with all registers mpu only mhz spi serial interface for reading sensor and interrupt registers mpu only mpu mpu product specification document number ps mpu a revision release date of mems structure hermetically sealed and bonded at wafer level rohs and green compliant motionprocessing internal digital motion processing dmp engine supports d motionprocessing and gesture recognition algorithms the mpu x collects gyroscope and accelerometer data while synchronizing data sampling at a user defined rate the total dataset obtained by the mpu x includes axis gyroscope data axis accelerometer data and temperature data the mpu s calculated output to the system processor can also include heading data from a digital axis third party magnetometer the fifo buffers the complete data set reducing timing requirements on the system processor by allowing the processor burst read the fifo data after burst reading the fifo data the system processor can save power by entering a low power sleep mode while the mpu collects more data programmable interrupt supports features such as gesture recognition panning zooming scrolling tap detection and shake detection digitally programmable low pass filters low power pedometer functionality allows the host processor to sleep while the dmp maintains the step count clocking on chip timing generator frequency variation over full temperature range optional external clock inputs of khz or mhz mpu mpu product specification document number ps mpu a revision release date of electrical characteristics gyroscope specifications vdd v v vlogic mpu only v or vdd t a c parameter conditions min typ max units notes gyroscope sensitivity full scale range fs sel s fs sel s fs sel s fs sel s gyroscope adc word length bits sensitivity scale factor fs sel lsb s fs sel lsb s fs sel lsb s fs sel lsb s sensitivity scale factor tolerance c sensitivity scale factor variation over temperature nonlinearity best fit straight line c cross axis sensitivity gyroscope zero rate output zro initial zro tolerance c s zro variation over temperature c to c s power supply sensitivity hz sine wave mvpp vdd v s power supply sensitivity hz sine wave mvpp vdd v s power supply sensitivity hz khz sine wave mvpp vdd v s linear acceleration sensitivity static s g self test response relative change from factory trim gyroscope noise performance fs sel total rms noise dlpfcfg hz s rms low frequency rms noise bandwidth hz to hz s rms rate noise spectral density at hz s hz gyroscope mechanical frequencies x axis khz y axis khz z axis khz low pass filter response programmable range hz output data rate programmable hz gyroscope start up time dlpfcfg zro settling from power on to s of final ms please refer to the following document for further information on self test mpu mpu register map and descriptions mpu mpu product specification document number ps mpu a revision release date of accelerometer specifications vdd v v vlogic mpu only v or vdd t a c parameter conditions min typ max units notes accelerometer sensitivity full scale range afs sel g afs sel g afs sel g afs sel g adc word length output in two s complement format bits sensitivity scale factor afs sel lsb g afs sel lsb g afs sel lsb g afs sel lsb g initial calibration tolerance sensitivity change vs temperature afs sel c to c c nonlinearity best fit straight line cross axis sensitivity zero g output initial calibration tolerance x and y axes mg z axis mg zero g level change vs temperature x and y axes c to c z axis c to c mg self test response relative change from factory trim noise performance power spectral density hz afs sel odr khz g hz low pass filter response programmable range hz output data rate programmable range hz intelligence function increment mg lsb typical zero g initial calibration tolerance value after msl preconditioning please refer to the following document for further information on self test mpu mpu register map and descriptions mpu mpu product specification document number ps mpu a revision release date of electrical and other common specifications vdd v v vlogic mpu only v or vdd t a c parameter conditions min typ max units notes temperature sensor range to c sensitivity untrimmed lsb c temperature offset o c lsb linearity best fit straight line c to c c vdd power supply operating voltages v normal operating current gyroscope accelerometer dmp ma gyroscope accelerometer dmp disabled ma gyroscope dmp accelerometer disabled ma gyroscope only dmp accelerometer disabled ma accelerometer only dmp gyroscope disabled a accelerometer low power mode current hz update rate a hz update rate a hz update rate a hz update rate a full chip idle mode supply current a power supply ramp rate monotonic ramp ramp rate is to of the final value ms vlogic reference voltage mpu only voltage range vlogic must be vdd at all times vdd v power supply ramp rate monotonic ramp ramp rate is to of the final value ms normal operating current a temperature range specified temperature range performance parameters are not applicable beyond specified temperature range c mpu mpu product specification document number ps mpu a revision release date of electrical specifications continued vdd v v vlogic mpu only v or vdd t a c parameter conditions min typ max units notes serial interface spi operating frequency all registers read write mpu only low speed characterization khz mpu only high speed characterization mhz spi operating frequency sensor and interrupt registers read only mpu only mhz i c operating frequency all registers fast mode khz all registers standard mode khz i c address ad ad digital inputs sdi sda ad sclk scl fsync cs clkin v ih high level input voltage mpu vdd v mpu vlogic v v il low level input voltage mpu vdd v mpu vlogic v c i input capacitance pf digital output sdo int v oh high level output voltage r load m mpu vdd v r load m mpu vlogic v v ol low level output voltage r load m mpu vdd v r load m mpu vlogic v v ol int int low level output voltage open ma sink current v output leakage current open na t int int pulse width latch int en s mpu mpu product specification document number ps mpu a revision release date of electrical specifications continued typical operating circuit of section vdd v v vlogic mpu only v or vdd t a c parameters conditions typical units notes primary i c i o scl sda v il low level input voltage mpu to vdd v v ih high level input voltage mpu vdd to vdd v v v hys hysteresis mpu vdd v vil low level input voltage mpu v to vlogic v vih high level input voltage mpu vlogic to vlogic v v vhys hysteresis mpu vlogic v v ol low level output voltage ma sink current to v i ol low level output current v ol v ma v ol v ma output leakage current na t of output fall time from v ihmax to v ilmax c b bus capacitance in pf c b to ns c i capacitance for each i o pin pf auxiliary i c i o aux cl aux da mpu aux vddio v il low level input voltage v to vlogic v v ih high level input voltage vlogic to vlogic v v v hys hysteresis vlogic v v ol low level output voltage vlogic v ma sink current to v v ol low level output voltage vlogic v ma sink current to vlogic v i ol low level output current v ol v v ol v ma ma output leakage current na t of output fall time from v ihmax to v ilmax c b bus capacitance in pf c b to ns c i capacitance for each i o pin pf mpu mpu product specification document number ps mpu a revision release date of electrical specifications continued typical operating circuit of section vdd v v vlogic mpu only v or vdd t a c parameters conditions min typical max units notes internal clock source clk sel gyroscope sample rate fast dlpfcfg sampleratediv khz gyroscope sample rate slow dlpfcfg or sampleratediv khz accelerometer sample rate khz clock frequency initial tolerance clk sel c clk sel c frequency variation over temperature clk sel to clk sel pll settling time clk sel ms external khz clock clk sel external clock frequency khz external clock allowable jitter cycle to cycle rms to s gyroscope sample rate fast dlpfcfg sampleratediv khz gyroscope sample rate slow dlpfcfg or sampleratediv khz accelerometer sample rate khz pll settling time ms external mhz clock clk sel external clock frequency mhz gyroscope sample rate full programmable range hz gyroscope sample rate fast mode dlpfcfg sampleratediv khz gyroscope sample rate slow mode dlpfcfg or sampleratediv khz accelerometer sample rate khz pll settling time ms mpu mpu product specification document number ps mpu a revision release date of i c timing characterization typical operating circuit of section vdd v v vlogic mpu only v or vdd t a c parameters conditions min typical max units notes i c timing i c fast mode f scl scl clock frequency khz t hd sta repeated start condition hold time s t low scl low period s t high scl high period s t su sta repeated start condition setup time s t hd dat sda data hold time s t su dat sda data setup time ns t r sda and scl rise time c b bus cap from to pf c b ns t f sda and scl fall time c b bus cap from to pf c b ns t su sto stop condition setup time s t buf bus free time between stop and start condition s c b capacitive load for each bus line pf t vd dat data valid time s t vd ack data valid acknowledge time s note timing characteristics apply to both primary and auxiliary i c bus i c bus timing diagram mpu mpu product specification document number ps mpu a revision release date of spi timing characterization mpu only typical operating circuit of section vdd v v vlogic mpu only v or vdd t a c unless otherwise noted parameters conditions min typical max units notes spi timing f sclk sclk clock frequency mhz t low sclk low period ns t high sclk high period ns t su cs cs setup time ns t hd cs cs hold time ns t su sdi sdi setup time ns t hd sdi sdi hold time ns t vd sdo sdo valid time c load pf ns t hd sdo sdo hold time c load pf ns t dis sdo sdo output disable time ns spi bus timing diagram mpu mpu product specification document number ps mpu a revision release date of absolute maximum ratings stress above those listed as absolute maximum ratings may cause permanent damage to the device these are stress ratings only and functional operation of the device at these conditions is not implied exposure to the absolute maximum ratings conditions for extended periods may affect device reliability parameter rating supply voltage vdd v to v vlogic input voltage level mpu v to vdd v regout v to v input voltage level clkin aux da ad fsync int scl sda v to vdd v cpout v vdd v v to v acceleration any axis unpowered g for ms operating temperature range c to c storage temperature range c to c electrostatic discharge esd protection kv hbm v mm latch up jedec class ii c ma mpu mpu product specification document number ps mpu a revision release date of applications information pin out and signal description pin number mpu mpu pin name pin description y y clkin optional external reference clock input connect to gnd if unused y y aux da i c master serial data for connecting to external sensors y y aux cl i c master serial clock for connecting to external sensors y cs spi chip select spi mode y vlogic digital i o supply voltage y ad sdo i c slave address lsb ad spi serial data output sdo y ad i c slave address lsb ad y y regout regulator filter capacitor connection y y fsync frame synchronization digital input connect to gnd if unused y y int interrupt digital output totem pole or open drain y y vdd power supply voltage and digital i o supply voltage y y gnd power supply ground y y resv reserved do not connect y y cpout charge pump capacitor connection y y resv reserved do not connect y scl sclk i c serial clock scl spi serial clock sclk y scl i c serial clock scl y sda sdi i c serial data sda spi serial data input sdi y sda i c serial data sda y y nc not internally connected may be used for pcb trace routing mpu mpu z x y aux cl vlogic ad regout fsync int nc nc nc vdd nc gnd nc nc nc aux da nc clkin resv cpout resv resv scl sda mpu qfn package pin mm x mm x mm orientation of axes of sensitivity and polarity of rotation top view z y x aux cl cs ad sdo regout fsync int nc nc nc vdd nc gnd nc nc nc aux da nc clkin resv cpout resv resv scl sclk sda sdi mpu qfn package pin mm x mm x mm top view mpu mpu product specification document number ps mpu a revision release date of typical operating circuit ad sdo typical operating circuits mpu clkin cs gnd gnd gnd fsync int gnd vdd scl sclk sda sdi c nf c f c f ad mpu clkin gnd gnd gnd fsync int gnd vdd scl sda c nf c f c f gnd vlogic c nf aux cl aux da aux cl aux da bill of materials for external components component label specification quantity regulator filter capacitor pin c ceramic x r f v vdd bypass capacitor pin c ceramic x r f v charge pump capacitor pin c ceramic x r nf v vlogic bypass capacitor pin c ceramic x r nf v mpu only mpu mpu product specification document number ps mpu a revision release date of recommended power on procedure t vlgr vlogic vdd t vddr all voltages at v power up sequencing vlogic amplitude must always be vdd amplitude t vddr is vdd rise time time for vdd to rise from to of its final value t vddr is ms t vlgr is vlogic rise time time for vlogic to rise from to of its final value t vlgr is ms license copyright c invensense corporation all rights reserved see included license txt for license information defgroup data builder data builder brief motion library data builder constructs and creates the data for mpl file data builder c brief data builder undef mpl log ndebug define mpl log ndebug use to turn on mpl logv output include string h include ml math func h include data builder h include mlmath h include storage manager h include message layer h include results holder h include log h undef mpl log tag define mpl log tag mpl typedef inv error t inv process cb func struct inv sensor cal t data struct process t inv process cb func func int priority int data required struct inv db save t compass bias in chip frame in hardware units scaled by long compass bias gyro bias in chip frame in hardware units scaled by long gyro bias temperature when gyro bias was stored long gyro temp flag to indicate temperature compensation that biases where stored int gyro bias tc set accel bias in chip frame in hardware units scaled by long accel bias temperature when accel bias was stored long accel temp long gyro temp slope sensor accuracy int gyro accuracy int accel accuracy int compass accuracy struct inv data builder t int num cb struct process t process inv max data cb struct inv db save t save int compass disturbance ifdef inv playback dbg int debug mode int last mode file file endif void inv apply calibration struct inv single sensor t sensor const long bias static void inv set contiguous void static struct inv data builder t inv data builder static struct inv sensor cal t sensors change this key if the data being stored by this file changes define inv db save key ifdef inv playback dbg turn on data logging to allow playback of same scenario at a later time param in file file to write to must be open void inv turn on data logging file file mpl logv input data logging started n inv data builder file file inv data builder debug mode rd record turn off data logging to allow playback of same scenario at a later time file passed to inv turn on data logging must be closed after calling this void inv turn off data logging mpl logv input data logging stopped n inv data builder debug mode rd no debug inv data builder file null endif this function receives the data that was stored in non volatile memory between power off static inv error t inv db load func const unsigned char data memcpy inv data builder save data sizeof inv data builder save copy in the saved accuracy in the actual sensors accuracy sensors gyro accuracy inv data builder save gyro accuracy sensors accel accuracy inv data builder save accel accuracy sensors compass accuracy inv data builder save compass accuracy todo if sensors compass accuracy inv set compass bias found return inv success this function returns the data to be stored in non volatile memory between power off static inv error t inv db save func unsigned char data memcpy data inv data builder save sizeof inv data builder save return inv success initialize the data builder inv error t inv init data builder void todo hardcode temperature scale offset here memset inv data builder sizeof inv data builder memset sensors sizeof sensors disable the soft iron transform process inv reset compass soft iron matrix return inv register load store inv db load func inv db save func sizeof inv data builder save inv db save key gyro sensitivity return a scale factor to convert device units to degrees per second scaled by such that degrees per second device units sensitivity typically it works out to be the maximum rate long inv get gyro sensitivity return sensors gyro sensitivity accel sensitivity return a scale factor to convert device units to g s scaled by such that g s device units sensitivity typically it works out to be the maximum accel value in g s long inv get accel sensitivity void return sensors accel sensitivity compass sensitivity return a scale factor to convert device units to micro tesla scaled by such that ut device units sensitivity typically it works out to be the maximum ut long inv get compass sensitivity void return sensors compass sensitivity sets orientation and sensitivity field for a sensor param out sensor structure to apply settings to param in orientation orientation description of how part is mounted param in sensitivity a scale factor to convert from hardware units to standard units dps ut g void set sensor orientation and scale struct inv single sensor t sensor int orientation long sensitivity sensor sensitivity sensitivity sensor orientation orientation sets the orientation and sensitivity of the gyro data param in orientation a scalar defining the transformation from chip mounting to the body frame the function inv orientation matrix to scalar can convert the transformation matrix to this scalar and describes the scalar in further detail param in sensitivity a scale factor to convert device units to degrees per second scaled by such that degrees per second device units sensitivity typically it works out to be the maximum rate void inv set gyro orientation and scale int orientation long sensitivity ifdef inv playback dbg if inv data builder debug mode rd record int type playback dbg type g orient fwrite type sizeof type inv data builder file fwrite orientation sizeof orientation inv data builder file fwrite sensitivity sizeof sensitivity inv data builder file endif set sensor orientation and scale sensors gyro orientation sensitivity set gyro sample rate in micro seconds param in sample rate us set gyro sample rate in us void inv set gyro sample rate long sample rate us ifdef inv playback dbg if inv data builder debug mode rd record int type playback dbg type g sample rate fwrite type sizeof type inv data builder file fwrite sample rate us sizeof sample rate us inv data builder file endif sensors gyro sample rate us sample rate us sensors gyro sample rate ms sample rate us if sensors gyro bandwidth sensors gyro bandwidth int l sample rate us set accel sample rate in micro seconds param in sample rate us set accel sample rate in us void inv set accel sample rate long sample rate us ifdef inv playback dbg if inv data builder debug mode rd record int type playback dbg type a sample rate fwrite type sizeof type inv data builder file fwrite sample rate us sizeof sample rate us inv data builder file endif sensors accel sample rate us sample rate us sensors accel sample rate ms sample rate us if sensors accel bandwidth sensors accel bandwidth int l sample rate us set compass sample rate in micro seconds param in sample rate us set gyro sample rate in micro seconds void inv set compass sample rate long sample rate us ifdef inv playback dbg if inv data builder debug mode rd record int type playback dbg type c sample rate fwrite type sizeof type inv data builder file fwrite sample rate us sizeof sample rate us inv data builder file endif sensors compass sample rate us sample rate us sensors compass sample rate ms sample rate us if sensors compass bandwidth sensors compass bandwidth int l sample rate us void inv get gyro sample rate ms long sample rate ms sample rate ms sensors gyro sample rate ms void inv get accel sample rate ms long sample rate ms sample rate ms sensors accel sample rate ms void inv get compass sample rate ms long sample rate ms sample rate ms sensors compass sample rate ms set quat sample rate in micro seconds param in sample rate us set quat sample rate in us void inv set quat sample rate long sample rate us ifdef inv playback dbg if inv data builder debug mode rd record int type playback dbg type q sample rate fwrite type sizeof type inv data builder file fwrite sample rate us sizeof sample rate us inv data builder file endif sensors quat sample rate us sample rate us sensors quat sample rate ms sample rate us set gyro bandwidth in hz param in bandwidth hz gyro bandwidth in hz void inv set gyro bandwidth int bandwidth hz sensors gyro bandwidth bandwidth hz set accel bandwidth in hz param in bandwidth hz gyro bandwidth in hz void inv set accel bandwidth int bandwidth hz sensors accel bandwidth bandwidth hz set compass bandwidth in hz param in bandwidth hz gyro bandwidth in hz void inv set compass bandwidth int bandwidth hz sensors compass bandwidth bandwidth hz helper function stating whether the compass is on or off return true if compass if on if compass if off int inv get compass on return sensors compass status inv sensor on inv sensor on helper function stating whether the gyro is on or off return true if gyro if on if gyro if off int inv get gyro on return sensors gyro status inv sensor on inv sensor on helper function stating whether the acceleromter is on or off return true if accel if on if accel if off int inv get accel on return sensors accel status inv sensor on inv sensor on get last timestamp across all sensors that are on this find out which timestamp has the largest value for sensors that are on return returns inv success if successful or an error code if not inv time t inv get last timestamp inv time t timestamp if sensors accel status inv sensor on timestamp sensors accel timestamp if sensors gyro status inv sensor on if timestamp sensors gyro timestamp timestamp sensors gyro timestamp if sensors compass status inv sensor on if timestamp sensors compass timestamp timestamp sensors compass timestamp if sensors temp status inv sensor on if timestamp sensors temp timestamp timestamp sensors temp timestamp return timestamp sets the orientation and sensitivity of the gyro data param in orientation a scalar defining the transformation from chip mounting to the body frame the function inv orientation matrix to scalar can convert the transformation matrix to this scalar and describes the scalar in further detail param in sensitivity a scale factor to convert device units to g s such that g s device units sensitivity typically it works out to be the maximum g value void inv set accel orientation and scale int orientation long sensitivity ifdef inv playback dbg if inv data builder debug mode rd record int type playback dbg type a orient fwrite type sizeof type inv data builder file fwrite orientation sizeof orientation inv data builder file fwrite sensitivity sizeof sensitivity inv data builder file endif set sensor orientation and scale sensors accel orientation sensitivity sets the orientation and sensitivity of the gyro data param in orientation a scalar defining the transformation from chip mounting to the body frame the function inv orientation matrix to scalar can convert the transformation matrix to this scalar and describes the scalar in further detail param in sensitivity a scale factor to convert device units to ut such that ut device units sensitivity typically it works out to be the maximum ut value void inv set compass orientation and scale int orientation long sensitivity ifdef inv playback dbg if inv data builder debug mode rd record int type playback dbg type c orient fwrite type sizeof type inv data builder file fwrite orientation sizeof orientation inv data builder file fwrite sensitivity sizeof sensitivity inv data builder file endif set sensor orientation and scale sensors compass orientation sensitivity void inv matrix vector mult const long a const long x long y y inv q mult a x inv q mult a x inv q mult a x y inv q mult a x inv q mult a x inv q mult a x y inv q mult a x inv q mult a x inv q mult a x takes raw data stored in the sensor removes bias and converts it to calibrated data in the body frame also store raw data for body frame param in out sensor structure to modify param in bias bias in the mounting frame in hardware units scaled by length void inv apply calibration struct inv single sensor t sensor const long bias long raw convert raw to calibrated raw long sensor raw raw long sensor raw raw long sensor raw inv convert to body with scale sensor orientation sensor sensitivity raw sensor raw scaled raw bias raw bias raw bias inv convert to body with scale sensor orientation sensor sensitivity raw sensor calibrated sensor status inv calibrated returns the current bias for the compass param out bias compass bias in hardware units scaled by in mounting frame length void inv get compass bias long bias if bias null memcpy bias inv data builder save compass bias sizeof inv data builder save compass bias void inv set compass bias const long bias int accuracy if memcmp inv data builder save compass bias bias sizeof inv data builder save compass bias memcpy inv data builder save compass bias bias sizeof inv data builder save compass bias inv apply calibration sensors compass inv data builder save compass bias sensors compass accuracy accuracy inv data builder save compass accuracy accuracy inv set message inv msg new cb event inv msg new cb event set the state of a compass disturbance param in dist disturbance no disturbance void inv set compass disturbance int dist inv data builder compass disturbance dist int inv get compass disturbance void return inv data builder compass disturbance sets the accel bias param in bias accel bias length in hw units scaled by in body frame param in accuracy accuracy rating from to with being most accurate void inv set accel bias const long bias int accuracy if bias if memcmp inv data builder save accel bias bias sizeof inv data builder save accel bias memcpy inv data builder save accel bias bias sizeof inv data builder save accel bias inv apply calibration sensors accel inv data builder save accel bias sensors accel accuracy accuracy inv data builder save accel accuracy accuracy inv set message inv msg new ab event inv msg new ab event sets the accel accuracy param in accuracy accuracy rating from to with being most accurate void inv set accel accuracy int accuracy sensors accel accuracy accuracy inv data builder save accel accuracy accuracy inv set message inv msg new ab event inv msg new ab event sets the accel bias with control over which axis param in bias accel bias length in hw units scaled by in body frame param in accuracy accuracy rating from to with being most accurate param in mask mask to select axis to apply bias set void inv set accel bias mask const long bias int accuracy int mask if bias if mask inv data builder save accel bias bias if mask inv data builder save accel bias bias if mask inv data builder save accel bias bias inv apply calibration sensors accel inv data builder save accel bias sensors accel accuracy accuracy inv data builder save accel accuracy accuracy inv set message inv msg new ab event inv msg new ab event sets the gyro bias param in bias gyro bias in hardware units scaled by in chip mounting frame length param in accuracy accuracy of bias least accurate most accurate void inv set gyro bias const long bias int accuracy if bias null if memcmp inv data builder save gyro bias bias sizeof inv data builder save gyro bias memcpy inv data builder save gyro bias bias sizeof inv data builder save gyro bias inv apply calibration sensors gyro inv data builder save gyro bias sensors gyro accuracy accuracy inv data builder save gyro accuracy accuracy todo what should we do if there s no temperature data if sensors temp calibrated inv data builder save gyro temp sensors temp calibrated else set to deg c for now until we ve got a better solution inv data builder save gyro temp l inv set message inv msg new gb event inv msg new gb event todo this flag works around the synchronization problem seen with using the user exposed message layer to signal the temperature compensation module that gyro biases were set a better cleaner method is certainly needed inv data builder save gyro bias tc set true internal brief return whether gyro biases were set to signal the temperature compensation algorithm that it can collect a data point to build the temperature slope while in no motion state the flag clear automatically after is read return true if the flag was set indicating gyro biases were set false if the flag was not set int inv get gyro bias tc set void int flag inv data builder save gyro bias tc set true inv data builder save gyro bias tc set false return flag todo add this information to inv sensor cal t get the gyro biases and temperature record from mpl param in bias gyro bias in hardware units scaled by in chip mounting frame length param in temp tempearature in degrees c void inv get gyro bias long bias long temp if bias null memcpy bias inv data builder save gyro bias sizeof inv data builder save gyro bias if temp null temp inv data builder save gyro temp get accel bias param out bias accel bias where param out temp temperature where c void inv get accel bias long bias long temp if bias null memcpy bias inv data builder save accel bias sizeof inv data builder save accel bias if temp null temp inv data builder save accel temp record new accel data for use when inv execute on data is called param in accel accel data length calibrated data is in m s scaled by in body frame raw data is in device units in chip mounting frame param in status lower bits are the accuracy with being inaccurate and being most accurate the upper bit inv calibrated is set if the data was calibrated outside mpl and it is not set if the data being passed is raw raw data should be in device units typically in a bit range param in timestamp monotonic time stamp for android it s in nanoseconds return returns inv success if successful or an error code if not inv error t inv build accel const long accel int status inv time t timestamp ifdef inv playback dbg if inv data builder debug mode rd record int type playback dbg type accel fwrite type sizeof type inv data builder file fwrite accel sizeof accel inv data builder file fwrite timestamp sizeof timestamp inv data builder file endif if status inv calibrated sensors accel raw short accel sensors accel raw short accel sensors accel raw short accel sensors accel status inv raw data inv apply calibration sensors accel inv data builder save accel bias else sensors accel calibrated accel sensors accel calibrated accel sensors accel calibrated accel sensors accel status inv calibrated sensors accel accuracy status inv data builder save accel accuracy status sensors accel status inv new data inv sensor on sensors accel timestamp prev sensors accel timestamp sensors accel timestamp timestamp return inv success record new gyro data and calls inv execute on data if previous sample has not been processed param in gyro data is in device units length param in timestamp monotonic time stamp for android it s in nanoseconds param out executed set to if data processing was done return returns inv success if successful or an error code if not inv error t inv build gyro const short gyro inv time t timestamp ifdef inv playback dbg if inv data builder debug mode rd record int type playback dbg type gyro fwrite type sizeof type inv data builder file fwrite gyro sizeof gyro inv data builder file fwrite timestamp sizeof timestamp inv data builder file endif memcpy sensors gyro raw gyro sizeof short sensors gyro status inv new data inv raw data inv sensor on sensors gyro timestamp prev sensors gyro timestamp sensors gyro timestamp timestamp inv apply calibration sensors gyro inv data builder save gyro bias return inv success record new compass data for use when inv execute on data is called param in compass compass data if it was calibrated outside mpl the units are ut scaled by length param in status lower bits are the accuracy with being inaccurate and being most accurate the upper bit inv calibrated is set if the data was calibrated outside mpl and it is not set if the data being passed is raw raw data should be in device units typically in a bit range param in timestamp monotonic time stamp for android it s in nanoseconds param out executed set to if data processing was done return returns inv success if successful or an error code if not inv error t inv build compass const long compass int status inv time t timestamp ifdef inv playback dbg if inv data builder debug mode rd record int type playback dbg type compass fwrite type sizeof type inv data builder file fwrite compass sizeof compass inv data builder file fwrite timestamp sizeof timestamp inv data builder file endif if status inv calibrated long data inv set compass soft iron input data compass inv get compass soft iron output data data sensors compass raw short data sensors compass raw short data sensors compass raw short data inv apply calibration sensors compass inv data builder save compass bias sensors compass status inv raw data else sensors compass calibrated compass sensors compass calibrated compass sensors compass calibrated compass sensors compass status inv calibrated sensors compass accuracy status inv data builder save compass accuracy status sensors compass timestamp prev sensors compass timestamp sensors compass timestamp timestamp sensors compass status inv new data inv sensor on return inv success record new temperature data for use when inv execute on data is called param in temp temperature data in q format param in timestamp monotonic time stamp for android it s in nanoseconds return returns inv success if successful or an error code if not inv error t inv build temp const long temp inv time t timestamp ifdef inv playback dbg if inv data builder debug mode rd record int type playback dbg type temperature fwrite type sizeof type inv data builder file fwrite temp sizeof temp inv data builder file fwrite timestamp sizeof timestamp inv data builder file endif sensors temp calibrated temp sensors temp status inv new data inv raw data inv sensor on sensors temp timestamp prev sensors temp timestamp sensors temp timestamp timestamp todo apply scale remove offset return inv success quaternion data param in quat quaternion data or for bit data real part first length param in status number of axis bit or bit param in timestamp param in timestamp monotonic time stamp for android it s in nanoseconds param out executed set to if data processing was done return returns inv success if successful or an error code if not inv error t inv build quat const long quat int status inv time t timestamp ifdef inv playback dbg if inv data builder debug mode rd record int type playback dbg type quat fwrite type sizeof type inv data builder file fwrite quat sizeof quat inv data builder file fwrite timestamp sizeof timestamp inv data builder file endif memcpy sensors quat raw quat sizeof sensors quat raw sensors quat timestamp timestamp sensors quat status inv new data inv raw data inv sensor on sensors quat status inv bias applied status return inv success this should be called when the accel has been turned off this is so that we will know if the data is contiguous void inv accel was turned off sensors accel status this should be called when the compass has been turned off this is so that we will know if the data is contiguous void inv compass was turned off sensors compass status this should be called when the quaternion data from the dmp has been turned off this is so that we will know if the data is contiguous void inv quaternion sensor was turned off void sensors quat status this should be called when the gyro has been turned off this is so that we will know if the data is contiguous void inv gyro was turned off sensors gyro status this should be called when the temperature sensor has been turned off this is so that we will know if the data is contiguous void inv temperature was turned off sensors temp status registers to receive a callback when there is new sensor data internal param in func function pointer to receive callback when there is new sensor data param in priority lower priority numbers receive a callback before larger numbers all priority numbers must be unique param in sensor type sets the type of data that triggers the callback must be non zero may be a combination inv accel new accel data inv gyro new gyro data inv mag new compass data so passing in inv accel new inv mag new a callback would be generated if there was new magnetomer data or new accel data inv error t inv register data cb inv error t func struct inv sensor cal t data int priority int sensor type inv error t result inv success int kk nn make sure we haven t registered this function already or used the same priority for kk kk inv data builder num cb kk if inv data builder process kk func func inv data builder process kk priority priority return inv error invalid parameter fixme give a warning make sure we have not filled up our number of allowable callbacks if inv data builder num cb inv max data cb kk if inv data builder num cb set kk to be where this new callback goes in the array while kk inv data builder num cb inv data builder process kk priority priority kk if kk inv data builder num cb we need to move the others for nn inv data builder num cb nn kk nn inv data builder process nn inv data builder process nn add new callback inv data builder process kk func func inv data builder process kk priority priority inv data builder process kk data required sensor type inv data builder num cb else mpl loge unable to add feature callback as too many were already registered n result inv error memory exausted return result unregisters the callback that happens when new sensor data is received internal param in func function pointer to receive callback when there is new sensor data param in priority lower priority numbers receive a callback before larger numbers all priority numbers must be unique param in sensor type sets the type of data that triggers the callback must be non zero may be a combination inv accel new accel data inv gyro new gyro data inv mag new compass data so passing in inv accel new inv mag new a callback would be generated if there was new magnetomer data or new accel data inv error t inv unregister data cb inv error t func struct inv sensor cal t data int kk nn for kk kk inv data builder num cb kk if inv data builder process kk func func delete this callback for nn kk nn inv data builder num cb nn inv data builder process nn inv data builder process nn inv data builder num cb return inv success return inv success we did not find the callback after at least one of inv build gyro inv build accel or inv build compass has been called this function should be called it will process the data it has received and update all the internal states and features that have been turned on return returns inv success if successful or an error code if not inv error t inv execute on data void inv error t result first error int kk int mode ifdef inv playback dbg if inv data builder debug mode rd record int type playback dbg type execute fwrite type sizeof type inv data builder file endif determine what new data we have mode if sensors gyro status inv new data mode inv gyro new if sensors accel status inv new data mode inv accel new if sensors compass status inv new data mode inv mag new if sensors temp status inv new data mode inv temp new if sensors quat status inv new data mode inv quat new first error inv success for kk kk inv data builder num cb kk if mode inv data builder process kk data required result inv data builder process kk func sensors if result first error first error result inv set contiguous return first error cleans up status bits after running all the callbacks it sets the contiguous flag static void inv set contiguous void inv time t current time if sensors gyro status inv new data sensors gyro status inv contiguous current time sensors gyro timestamp if sensors accel status inv new data sensors accel status inv contiguous current time max current time sensors accel timestamp if sensors compass status inv new data sensors compass status inv contiguous current time max current time sensors compass timestamp if sensors temp status inv new data sensors temp status inv contiguous current time max current time sensors temp timestamp if sensors quat status inv new data sensors quat status inv contiguous current time max current time sensors quat timestamp if see if sensors are still on these should be turned off by inv was turned off type functions this is just in case that breaks down we make sure all the data is within seconds of the newest piece of data if inv delta time ms current time sensors gyro timestamp inv gyro was turned off if inv delta time ms current time sensors accel timestamp inv accel was turned off if inv delta time ms current time sensors compass timestamp inv compass was turned off todo temperature might not need to be read this quickly if inv delta time ms current time sensors temp timestamp inv temperature was turned off endif clear bits sensors gyro status inv new data sensors accel status inv new data sensors compass status inv new data sensors temp status inv new data sensors quat status inv new data gets a whole set of accel data including data accuracy and timestamp param out data accel data where g param out accuracy accuracy being not accurate and being most accurate param out timestamp the timestamp of the data sample void inv get accel set long data int t accuracy inv time t timestamp if data null memcpy data sensors accel calibrated sizeof sensors accel calibrated if timestamp null timestamp sensors accel timestamp if accuracy null accuracy sensors accel accuracy gets a whole set of gyro data including data accuracy and timestamp param out data gyro data where dps param out accuracy accuracy being not accurate and being most accurate param out timestamp the timestamp of the data sample void inv get gyro set long data int t accuracy inv time t timestamp memcpy data sensors gyro calibrated sizeof sensors gyro calibrated if timestamp null timestamp sensors gyro timestamp if accuracy null accuracy sensors gyro accuracy gets a whole set of gyro raw data including data accuracy and timestamp param out data gyro data where dps param out accuracy accuracy being not accurate and being most accurate param out timestamp the timestamp of the data sample void inv get gyro set raw long data int t accuracy inv time t timestamp memcpy data sensors gyro raw scaled sizeof sensors gyro raw scaled if timestamp null timestamp sensors gyro timestamp if accuracy null accuracy sensors gyro accuracy get s latest gyro data param out gyro gyro data length dps void inv get gyro long gyro memcpy gyro sensors gyro calibrated sizeof sensors gyro calibrated gets a whole set of compass data including data accuracy and timestamp param out data compass data where ut param out accuracy accuracy being not accurate and being most accurate param out timestamp the timestamp of the data sample void inv get compass set long data int t accuracy inv time t timestamp memcpy data sensors compass calibrated sizeof sensors compass calibrated if timestamp null timestamp sensors compass timestamp if accuracy null if inv data builder compass disturbance accuracy else accuracy sensors compass accuracy gets a whole set of temperature data including data accuracy and timestamp param out data temperature data where degree c param out accuracy to where is most accurate param out timestamp the timestamp of the data sample void inv get temp set long data int accuracy inv time t timestamp data sensors temp calibrated if timestamp timestamp sensors temp timestamp if accuracy accuracy sensors temp accuracy returns accuracy of gyro return accuracy of gyro with being not accurate and being most accurate int inv get gyro accuracy void return sensors gyro accuracy returns accuracy of compass return accuracy of compass with being not accurate and being most accurate int inv get mag accuracy void if inv data builder compass disturbance return return sensors compass accuracy returns accuracy of accel return accuracy of accel with being not accurate and being most accurate int inv get accel accuracy void return sensors accel accuracy inv error t inv get gyro orient int orient orient sensors gyro orientation return inv error t inv get accel orient int orient orient sensors accel orientation return compass soft iron module gets the x compass transform matrix in bit q fixed point format param out the pointer of the x matrix in q format void inv get compass soft iron matrix d long matrix int i for i i i matrix i sensors soft iron matrix d i sets the x compass transform matrix in bit q fixed point format param in the pointer of the x matrix in q format void inv set compass soft iron matrix d long matrix int i for i i i set the floating point matrix sensors soft iron matrix d i matrix i convert to q format sensors soft iron matrix f i inv q to float matrix i gets the x compass transform matrix in bit floating point format param out the pointer of the x matrix in floating point format void inv get compass soft iron matrix f float matrix int i for i i i matrix i sensors soft iron matrix f i sets the x compass transform matrix in bit floating point format param in the pointer of the x matrix in floating point format void inv set compass soft iron matrix f float matrix int i for i i i set the floating point matrix sensors soft iron matrix f i matrix i convert to q format sensors soft iron matrix d i long matrix i rot matrix scale long this subroutine gets the fixed point q compass data after the soft iron transformation param out the pointer of the x vector compass data in mpl format void inv get compass soft iron output data long data int i for i i i data i sensors soft iron trans i this subroutine gets the fixed point q compass data before the soft iron transformation param out the pointer of the x vector compass data in mpl format void inv get compass soft iron input data long data int i for i i i data i sensors soft iron raw i this subroutine sets the compass raw data for the soft iron transformation param int the pointer of the x vector compass raw data in mpl format void inv set compass soft iron input data const long data int i for i i i sensors soft iron raw i data i if sensors soft iron enable mlmatrixvectormult sensors soft iron matrix d data sensors soft iron trans else for i i i sensors soft iron trans i data i this subroutine resets the the soft iron transformation to unity matrix and disable the soft iron transformation process by default void inv reset compass soft iron matrix void int i for i i i sensors soft iron matrix f i f memset sensors soft iron matrix d sizeof sensors soft iron matrix d for i i i set the floating point matrix sensors soft iron matrix f i set the fixed point matrix sensors soft iron matrix d i rot matrix scale long inv disable compass soft iron matrix this subroutine enables the the soft iron transformation process void inv enable compass soft iron matrix void sensors soft iron enable this subroutine disables the the soft iron transformation process void inv disable compass soft iron matrix void sensors soft iron enable v was turned off type functions this is just in case that breaks down we make sure all the data is within seconds of the newest piece of data if inv delta time ms current time sensors gyro timestamp inv gyro was turned off if inv delta time ms current time sensors accel timestamp inv accel was turned off if inv delta time ms current time sensors compass timestamp inv compass was turned off todo temperature might not need to be read this quickly if inv delta time ms current time sensors temp timestamp inv temperature was turned off endif clear bits sensors gyro status inv new data sensors accel status inv new data sensors compass status inv new data sensors temp status inv new data sensors quat status inv new data gets a whole set of accel data including data accuracy and timestamp param out data accel data where g param out accuracy accuracy being not accurate and being most accurate param out timestamp the timestamp of the data sample void inv get accel set long data int t accuracy inv time t timestamp if data null memcpy data sensors accel calibrated sizeof sensors accel calibrated if timestamp null timestamp sensors accel timestamp if accuracy null accuracy sensors accel accuracy gets a whole set of gyro data including data accuracy and timestamp param out data gyro data where dps param out accuracy accuracy being not accurate and being most accurate param out timestamp the timestamp of the data sample void inv get gyro set long data int t accuracy inv time t timestamp memcpy data sensors gyro calibrated sizeof sensors gyro calibrated if timestamp null timestamp sensors gyro timestamp if accuracy null accuracy sensors gyro accuracy gets a whole set of gyro raw data including data accuracy and timestamp param out data gyro data where dps param out accuracy accuracy being not accurate and being most accurate param out timestamp the timestamp of the data sample void inv get gyro set raw long data int t accuracy inv time t timestamp memcpy data sensors gyro raw scaled sizeof sensors gyro raw scaled if timestamp null timestamp sensors gyro timestamp if accuracy null accuracy sensors gyro accuracy get s latest gyro data param out gyro gyro data length dps void inv get gyro long gyro memcpy gyro sensors gyro calibrated sizeof sensors gyro calibrated gets a whole set of compass data including data accuracy and timestamp param out data compass data where ut param out accuracy accuracy being not accurate and being most accurate param out timestamp the timestamp of the data sample void inv get compass set long data int t accuracy inv time t timestamp memcpy data sensors compass calibrated sizeof sensors compass calibrated if timestamp null timestamp sensors compass timestamp if accuracy null if inv data builder compass disturbance accuracy else accuracy sensors compass accuracy gets a whole set of temperature data including data accuracy and timestamp param out data temperature data where degree c param out accuracy to where is most accurate param out timestamp the timestamp of the data sample void inv get temp set long data int accuracy inv time t timestamp data sensors temp calibrated if timestamp timestamp sensors temp timestamp if accuracy accuracy sensors temp accuracy returns accuracy of gyro return accuracy of gyro with being not accurate and being most accurate int inv get gyro accuracy void return sensors gyro accuracy returns accuracy of compass return accuracy of compass with being not accurate and being most accurate int inv get mag accuracy void if inv data builder compass disturbance return return sensors compass accuracy returns accuracy of accel return accuracy of accel with being not accurate and being most accurate int inv get accel accuracy void return sensors accel accuracy inv error t inv get gyro orient int orient orient sensors gyro orientation return inv error t inv get accel orient int orient orient sensors accel orientation return compass soft iron module gets the x compass transform matrix in bit q fixed point format param out the pointer of the x matrix in q format void inv get compass soft iron matrix d long matrix int i for i i i matrix i sensors soft iron matrix d i sets the x compass transform matrix in bit q fixed point format param in the pointer of the x matrix in q format void inv set compass soft iron matrix d long matrix int i for i i i set the floating point matrix sensors soft iron matrix d i matrix i convert to q format sensors soft iron matrix f i inv q to float matrix i gets the x compass transform matrix in bit floating point format param out the pointer of the x matrix in floating point format void inv get compass soft iron matrix f float matrix int i for i i i matrix i sensors soft iron matrix f i sets the x compass transform matrix in bit floating point format param in the pointer of the x matrix in floating point format void inv set compass soft iron matrix f float matrix int i for i i i set the floating point matrix sensors soft iron matrix f i matrix i convert to q format sensors soft iron matrix d i long matrix i rot matrix scale long this subroutine gets the fixed point q compass data after the soft iron transformation param out the pointer of the x vector compass data in mpl format void inv get compass soft iron output data long data int i for i i i data i sensors soft iron trans i this subroutine gets the fixed point q compass data before the soft iron transformation param out the pointer of the x vector compass data in mpl format void inv get compass soft iron input data long data int i for i i i data i sensors soft iron raw i this subroutine sets the compass raw data for the soft iron transformation param int the pointer of the x vector compass raw data in mpl format void inv set compass soft iron input data const long data int i for i i i sensors soft iron raw i data i if sensors soft iron enable mlmatrixvectormult sensors soft iron matrix d data sensors soft iron trans else for i i i sensors soft iron trans i data i this subroutine resets the the soft iron transformation to unity matrix and disable the soft iron transformation process by default void inv reset compass soft iron matrix void int i for i i i sensors soft iron matrix f i f memset sensors soft iron matrix d sizeof sensors soft iron matrix d for i i i set the floating point matrix sensors soft iron matrix f i set the fixed point matrix sensors soft iron matrix d i rot matrix scale long inv disable compass soft iron matrix this subrou 